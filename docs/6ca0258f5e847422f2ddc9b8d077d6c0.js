require=function(r,e,n){function t(n,o){function i(r){return t(i.resolve(r))}function f(e){return r[n][1][e]||e}if(!e[n]){if(!r[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(u)return u(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}i.resolve=f;var s=e[n]=new t.Module(n);r[n][0].call(s.exports,i,s,s.exports)}return e[n].exports}function o(r){this.id=r,this.bundle=t,this.exports={}}var u="function"==typeof require&&require;t.isParcelRequire=!0,t.Module=o,t.modules=r,t.cache=e,t.parent=u;for(var i=0;i<n.length;i++)t(n[i]);return t}({7:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=c,exports.__awaiter=i,exports.__generator=u,exports.__exportStar=f,exports.__values=l,exports.__read=s,exports.__spread=p,exports.__await=y,exports.__asyncGenerator=_,exports.__asyncDelegator=h,exports.__asyncValues=b,exports.__makeTemplateObject=v,exports.__importStar=d,exports.__importDefault=w;var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=exports.__assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,c=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(c=(a<3?o(c):a>3?o(e,r,c):o(e,r))||c);return a>3&&c&&Object.defineProperty(e,r,c),c}function a(t,e){return function(r,n){e(r,n,t)}}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function i(t,e,r,n){return new(r||(r=Promise))(function(o,a){function c(t){try{u(n.next(t))}catch(t){a(t)}}function i(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(c,i)}u((n=n.apply(t,e||[])).next())})}function u(t,e){var r,n,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(o=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,n=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}function f(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function l(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),c=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)c.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return c}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function _(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},c("next"),c("throw"),c("return"),n[Symbol.asyncIterator]=function(){return this},n;function c(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||i(t,e)})})}function i(t,e){try{(r=o[t](e)).value instanceof y?Promise.resolve(r.value.v).then(u,f):l(a[0][2],r)}catch(t){l(a[0][3],t)}var r}function u(t){i("next",t)}function f(t){i("throw",t)}function l(t,e){t(e),a.shift(),a.length&&i(a[0][0],a[0][1])}}function h(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){t[n]&&(e[n]=function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:o?o(e):e})}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator];return e?e.call(t):"function"==typeof l?l(t):t[Symbol.iterator]()}function v(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function w(t){return t&&t.__esModule?t:{default:t}}
},{}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=224;function e(t){var e=new FaceDetector,n=5*Math.PI/180,r=Math.pow(Math.pow(t.width,2)+Math.pow(t.height,2),.5);return Promise.all(Array.from(Array(19)).map(function(a,o){var i=Math.round(o/2)*(o%2==0?1:-1)*n,c=document.createElement("canvas");c.width=r,c.height=r;var u=c.getContext("2d");return u.translate(r/2,r/2),u.rotate(i),u.drawImage(t,-t.width/2,-t.height/2),e.detect(c).then(function(t){return{rotationCanvas:c,faces:t.filter(function(t){return 2===t.landmarks.filter(function(t){return"eye"===t.type}).length})}})})).then(function(t){return t.reduce(function(t,e){return e.faces.length>t.faces.length?e:t},{faces:[]})}).then(function(t){var e=t.rotationCanvas,n=t.faces;return e?Promise.all(n.map(function(t){return a(e,t).canvas.toDataURL()})):[]})}function n(e){return(new FaceDetector).detect(e).then(function(n){return n.map(function(n){var r=a(e,n),o=r.ctx,i=r.usedBoundingBox;return{boundingBox:n.boundingBox,landmarks:n.landmarks,imageData:o.getImageData(0,0,t,t),usedBoundingBox:i}})})}function a(e,n){var a=n.boundingBox,r=n.landmarks,o=a.x,i=a.y,c=a.width,u=a.height,h=r.filter(function(t){return"eye"===t.type}),s=h[0],d=h[1],f=r.filter(function(t){return"mouth"===t.type})[0];if(c<u)i+=(u-c)/2,u=c,f&&f.location.y>i+u&&(o-=.3*c,i-=.3*u,c*=1.6,u*=1.6);else if(c>u)throw new Error("Unknown FaceDetector implementation");var l=s&&d?Math.atan((s.location.y-d.location.y)/(s.location.x-d.location.x)):0,g=Math.abs(Math.cos(l))+Math.abs(Math.sin(l)),m=c*g,x=t*g,w=document.createElement("canvas"),v=w.getContext("2d");return w.width=t,w.height=t,v.translate(t/2,t/2),v.rotate(-l),v.drawImage(e,o-(m-c)/2,i-(m-u)/2,m,m,-x/2,-x/2,x,x),{canvas:w,ctx:v,usedBoundingBox:{x:o,y:i,width:c,height:u}}}exports.detectFacesDataURL=e,exports.detectFacesImageData=n;
},{}],44:[function(require,module,exports) {
"use strict";function e(e){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.doc=e;
},{}],9:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(c=(i<3?o(c):i>3?o(t,r,c):o(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./doc"),r=function(){function r(){}return r.nextFrame=function(){return new Promise(function(e){return requestAnimationFrame(function(){return e()})})},e([t.doc({heading:"Performance",subheading:"Timing"})],r,"nextFrame",null),r}();exports.BrowserUtil=r;
},{"./doc":44}],153:[function(require,module,exports) {
!function(n,t,e){function s(n,t){return t.c=n.c,t.s0=n.s0,t.s1=n.s1,t.s2=n.s2,t}function r(n,t){var e=new function(n){var t,e=this,s=(t=4022871197,function(n){n=n.toString();for(var e=0;e<n.length;e++){var s=.02519603282416938*(t+=n.charCodeAt(e));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)});e.next=function(){var n=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=n-(e.c=0|n)},e.c=1,e.s0=s(" "),e.s1=s(" "),e.s2=s(" "),e.s0-=s(n),e.s0<0&&(e.s0+=1),e.s1-=s(n),e.s1<0&&(e.s1+=1),e.s2-=s(n),e.s2<0&&(e.s2+=1),s=null}(n),r=t&&t.state,o=e.next;return o.int32=function(){return 4294967296*e.next()|0},o.double=function(){return o()+1.1102230246251565e-16*(2097152*o()|0)},o.quick=o,r&&("object"==typeof r&&s(r,e),o.state=function(){return s(e,{})}),o}t&&t.exports?t.exports=r:e&&e.amd?e(function(){return r}):this.alea=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);
},{}],154:[function(require,module,exports) {
!function(t,n,e){function o(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n}function r(t,n){var e=new function(t){var n=this,e="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var t=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^t^t>>>8},t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),n.next()}(t),r=n&&n.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},u.int32=e.next,u.quick=u,r&&("object"==typeof r&&o(r,e),u.state=function(){return o(e,{})}),u}n&&n.exports?n.exports=r:e&&e.amd?e(function(){return r}):this.xor128=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);
},{}],155:[function(require,module,exports) {
!function(t,n,e){function o(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n.v=t.v,n.d=t.d,n}function r(t,n){var e=new function(t){var n=this,e="";n.next=function(){var t=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^t^t<<1)|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),o==e.length&&(n.d=n.x<<10^n.x>>>4),n.next()}(t),r=n&&n.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},u.int32=e.next,u.quick=u,r&&("object"==typeof r&&o(r,e),u.state=function(){return o(e,{})}),u}n&&n.exports?n.exports=r:e&&e.amd?e(function(){return r}):this.xorwow=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);
},{}],156:[function(require,module,exports) {
!function(n,t,e){function r(n,t){return t.x=n.x.slice(),t.i=n.i,t}function i(n,t){null==n&&(n=+new Date);var e=new function(n){var t=this;t.next=function(){var n,e,r=t.x,i=t.i;return n=r[i],e=(n^=n>>>7)^n<<24,e^=(n=r[i+1&7])^n>>>10,e^=(n=r[i+3&7])^n>>>3,e^=(n=r[i+4&7])^n<<7,n=r[i+7&7],e^=(n^=n<<13)^n<<9,r[i]=e,t.i=i+1&7,e},function(n,t){var e,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,e=0;e<t.length;++e)r[7&e]=r[7&e]<<15^t.charCodeAt(e)+r[e+1&7]<<13;for(;r.length<8;)r.push(0);for(e=0;e<8&&0===r[e];++e);for(8==e?r[7]=-1:r[e],n.x=r,n.i=0,e=256;e>0;--e)n.next()}(t,n)}(n),i=t&&t.state,o=function(){return(e.next()>>>0)/4294967296};return o.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},o.int32=e.next,o.quick=o,i&&(i.x&&r(i,e),o.state=function(){return r(e,{})}),o}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i}(0,"object"==typeof module&&module,"function"==typeof define&&define);
},{}],157:[function(require,module,exports) {
!function(n,t,e){function r(n,t){return t.i=n.i,t.w=n.w,t.X=n.X.slice(),t}function i(n,t){null==n&&(n=+new Date);var e=new function(n){var t=this;t.next=function(){var n,e,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,e=i[o+34&127],n=i[o=o+1&127],e^=e<<13,n^=n<<17,e^=e>>>15,n^=n>>>12,e=i[o]=e^n,t.i=o,e+(r^r>>>16)|0},function(n,t){var e,r,i,o,u,f=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),i=0,o=-32;o<c;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(u=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(u=u+1640531527|0,i=0==(e=f[127&o]^=r+u)?i+1:0);for(i>=128&&(f[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=f[i+34&127],e=f[i=i+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,f[i]=r^e;n.w=u,n.X=f,n.i=i}(t,n)}(n),i=t&&t.state,o=function(){return(e.next()>>>0)/4294967296};return o.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},o.int32=e.next,o.quick=o,i&&(i.X&&r(i,e),o.state=function(){return r(e,{})}),o}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i}(0,"object"==typeof module&&module,"function"==typeof define&&define);
},{}],158:[function(require,module,exports) {
!function(t,n,e){function o(t,n){return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n}function r(t,n){var e=new function(t){var n=this,e="";n.next=function(){var t=n.b,e=n.c,o=n.d,r=n.a;return t=t<<25^t>>>7^e,e=e-o|0,o=o<<24^o>>>8^r,r=r-t|0,n.b=t=t<<20^t>>>12^e,n.c=e=e-o|0,n.d=o<<16^e>>>16^r,n.a=r-t|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,t===Math.floor(t)?(n.a=t/4294967296|0,n.b=0|t):e+=t;for(var o=0;o<e.length+20;o++)n.b^=0|e.charCodeAt(o),n.next()}(t),r=n&&n.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},u.int32=e.next,u.quick=u,r&&("object"==typeof r&&o(r,e),u.state=function(){return o(e,{})}),u}n&&n.exports?n.exports=r:e&&e.amd?e(function(){return r}):this.tychei=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);
},{}],159:[function(require,module,exports) {

},{}],152:[function(require,module,exports) {
var global = (1,eval)("this");
var n=(0,eval)("this");!function(n,r){var t,e=this,o=256,i=6,u="random",a=r.pow(o,i),f=r.pow(2,52),c=2*f,s=o-1;function l(l,h,y){var v=[],m=d(function n(r,t){var e,o=[],i=typeof r;if(t&&"object"==i)for(e in r)try{o.push(n(r[e],t-1))}catch(n){}return o.length?o:"string"==i?r:r+"\0"}((h=1==h?{entropy:!0}:h||{}).entropy?[l,g(n)]:null==l?function(){try{var r;return t&&(r=t.randomBytes)?r=r(o):(r=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(r)),g(r)}catch(r){var i=e.navigator,u=i&&i.plugins;return[+new Date,e,u,e.screen,g(n)]}}():l,3),v),j=new function(n){var r,t=n.length,e=this,i=0,u=e.i=e.j=0,a=e.S=[];t||(n=[t++]);for(;i<o;)a[i]=i++;for(i=0;i<o;i++)a[i]=a[u=s&u+n[i%t]+(r=a[i])],a[u]=r;(e.g=function(n){for(var r,t=0,i=e.i,u=e.j,a=e.S;n--;)r=a[i=s&i+1],t=t*o+a[s&(a[i]=a[u=s&u+r])+(a[u]=r)];return e.i=i,e.j=u,t})(o)}(v),S=function(){for(var n=j.g(i),r=a,t=0;n<f;)n=(n+t)*o,r*=o,t=j.g(1);for(;n>=c;)n/=2,r/=2,t>>>=1;return(n+t)/r};return S.int32=function(){return 0|j.g(4)},S.quick=function(){return j.g(4)/4294967296},S.double=S,d(g(j.S),n),(h.pass||y||function(n,t,e,o){return o&&(o.S&&p(o,j),n.state=function(){return p(j,{})}),e?(r[u]=n,t):n})(S,m,"global"in h?h.global:this==r,h.state)}function p(n,r){return r.i=n.i,r.j=n.j,r.S=n.S.slice(),r}function d(n,r){for(var t,e=n+"",o=0;o<e.length;)r[s&o]=s&(t^=19*r[s&o])+e.charCodeAt(o++);return g(r)}function g(n){return String.fromCharCode.apply(0,n)}if(r["seed"+u]=l,d(r.random(),n),"object"==typeof module&&module.exports){module.exports=l;try{t=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd&&define(function(){return l})}([],Math);
},{"crypto":159}],151:[function(require,module,exports) {
var r=require("./lib/alea"),e=require("./lib/xor128"),i=require("./lib/xorwow"),o=require("./lib/xorshift7"),l=require("./lib/xor4096"),x=require("./lib/tychei"),u=require("./seedrandom");u.alea=r,u.xor128=e,u.xorwow=i,u.xorshift7=o,u.xor4096=l,u.tychei=x,module.exports=u;
},{"./lib/alea":153,"./lib/xor128":154,"./lib/xorwow":155,"./lib/xorshift7":156,"./lib/xor4096":157,"./lib/tychei":158,"./seedrandom":152}],45:[function(require,module,exports) {
"use strict";function i(){var i=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobile=i;
},{}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./tensor");function t(r){for(var t=r.length,n=0,e=0;t>0;)e=Math.random()*t|0,n=r[--t],r[t]=r[e],r[e]=n}function n(r,t,n){return Math.max(r,Math.min(t,n))}function e(r,t){return Math.random()*(t-r)+r}function o(r,t){for(var n=0,e=0;e<r.length;e++){var o=Number(r[e])-Number(t[e]);n+=o*o}return n}function a(r,t){if(!r)throw new Error(t)}function i(r,t,n){void 0===n&&(n=""),a(h(r,t),n+"Shapes "+r+" and "+t+" must match")}function u(r,t){a(r.dtype===t.dtype,"The dtypes of the first ("+r.dtype+") and second ("+t.dtype+") input must match")}function s(r,t){if(void 0===t&&(t=[]),Array.isArray(r))for(var n=0;n<r.length;++n)s(r[n],t);else t.push(r);return t}function f(r){if(O(r))return[r.length];if(!Array.isArray(r))return[];for(var t=[];r instanceof Array;)t.push(r.length),r=r[0];return t}function p(r){if(0===r.length)return 1;for(var t=r[0],n=1;n<r.length;n++)t*=r[n];return t}function l(r){return 0===r.length}function h(r,t){if(r.length!==t.length)return!1;for(var n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}function c(r){return r%1==0}function y(r){if(null!=Math.tanh)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var t=Math.exp(2*r);return(t-1)/(t+1)}function x(r){for(var t=Math.floor(Math.sqrt(r));t>1;--t)if(r%t==0)return[t,r/t];return[1,r]}function d(r){for(var n=new Uint32Array(r),e=0;e<r;++e)n[e]=e;return t(n),n}function m(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function v(r,t,n){return void 0===t&&(t=function(r){return 0}),new Promise(function(e,o){var a=0,i=function(){if(r())e();else{var u=t(++a);null!=n&&a>=n?o():setTimeout(i,u)}};setTimeout(i,0)})}function w(r){var t={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(r){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return N(t,n[0],n[1]),n.join("=")}),t}function N(r,t,n){r[decodeURIComponent(t)]=decodeURIComponent(n||"")}function g(r,t){for(var n=1,e=-1,o=0;o<r.length;++o)if(r[o]>0)n*=r[o];else if(-1===r[o]){if(-1!==e)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+e+" and dim "+o);e=o}else if(r[o]<=0)throw Error("Shapes can not be <= 0. Found "+r[o]+" at dim "+o);if(-1===e){if(t>0&&t!==n)throw Error("Size ("+t+") must match the product of shape "+r);return r}if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=r.slice();return a[e]=t/n,a}function A(r){if("float32"===r)return exports.NAN_FLOAT32;if("int32"===r)return exports.NAN_INT32;if("bool"===r)return exports.NAN_BOOL;throw new Error("Unknown dtype "+r)}function T(r,t){if(isNaN(r))return!0;if("float32"===t)return!1;if("int32"===t)return r===exports.NAN_INT32;if("bool"===t)return r===exports.NAN_BOOL;throw new Error("Unknown dtype "+t)}function b(r,t){for(var n=[],e=[],o=0,a=0;a<r.length;++a){if(null!=t){if(t[o]===a&&r[a]>1)throw new Error("Can't squeeze axis "+a+" since its dim '"+r[a]+"' is not 1");(null==t[o]||t[o]>a)&&1===r[a]&&(n.push(r[a]),e.push(a)),t[o]<=a&&o++}r[a]>1&&(n.push(r[a]),e.push(a))}return{newShape:n,keptDims:e}}function E(r,t){var n=null;if(null==r||"float32"===r)n=new Float32Array(t);else if("int32"===r)n=new Int32Array(t);else{if("bool"!==r)throw new Error("Unknown data type "+r);n=new Uint8Array(t)}return n}function S(r,t){for(var n=0;n<t.length;n++)if(t[n].id===r.id)return!0;return!1}function M(r,t,n){for(var e=0;e<r.length;e++)if(T(r[e],t))throw Error("The result of the '"+n+"' has NaNs.")}function F(t,n){var e=[];if(t instanceof r.Tensor)e.push(t);else for(var o=t,a=0;a<n.length;a++)e.push(o[n[a]]);return e}function I(r,t){if(r.length!==t.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var n={},e=0;e<r.length;e++)n[r[e]]=t[e];return n}function U(r,t){return"float32"!==t&&(("int32"!==t||"float32"===r)&&("bool"!==t||"bool"!==r))}function _(r,t){if(null==t||"float32"===t)return new Float32Array(r);if("int32"===t){for(var n=new Int32Array(r.length),e=0;e<n.length;++e){T(a=r[e],"int32")?n[e]=A("int32"):n[e]=a}return n}if("bool"===t){var o=new Uint8Array(r.length);for(e=0;e<o.length;++e){var a;T(a=r[e],"bool")?o[e]=A("bool"):0!==Math.round(a)&&(o[e]=1)}return o}throw new Error("Unknown data type "+t)}function O(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function k(r){if("float32"===r||"int32"===r)return 4;if("bool"===r)return 1;throw new Error("Unknown dtype "+r)}function q(r){return!!(r&&r.constructor&&r.call&&r.apply)}function L(r){return z(r)}function z(t){if(null==t)return[];if(t instanceof r.Tensor)return[t];var n=[],e=t;if(!C(e))return[];for(var o in e){var a=s(e[o]).filter(function(t){return t instanceof r.Tensor});n.push.apply(n,a)}return n}function C(r){return Array.isArray(r)||"object"==typeof r}exports.shuffle=t,exports.clamp=n,exports.randUniform=e,exports.distSquared=o,exports.assert=a,exports.assertShapesMatch=i,exports.assertTypesMatch=u,exports.flatten=s,exports.inferShape=f,exports.sizeFromShape=p,exports.isScalarShape=l,exports.arraysEqual=h,exports.isInt=c,exports.tanh=y,exports.sizeToSquarishShape=x,exports.createShuffledIndices=d,exports.rightPad=m,exports.repeatedTry=v,exports.getQueryParams=w,exports.inferFromImplicitShape=g,exports.NAN_INT32=1<<31,exports.NAN_BOOL=255,exports.NAN_FLOAT32=NaN,exports.getNaN=A,exports.isValNaN=T,exports.squeezeShape=b,exports.getTypedArrayFromDType=E,exports.isTensorInList=S,exports.checkForNaN=M,exports.flattenNameArrayMap=F,exports.unflattenToNameArrayMap=I,exports.hasEncodingLoss=U,exports.copyTypedArray=_,exports.isTypedArray=O,exports.bytesPerElement=k,exports.isFunction=q,exports.extractTensorsFromContainer=L,exports.extractTensorsFromAny=z;
},{"./tensor":15}],48:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./util"),n=20,a=3,t=7;function e(r,n){var a=r.dataSync(),t=u(r),e=i(a,r.shape,r.strides,t),s=["Tensor"];return n&&(s.push("  dtype: "+r.dtype),s.push("  rank: "+r.rank),s.push("  shape: ["+r.shape+"]"),s.push("  values:")),s.push(e.map(function(r){return"    "+r}).join("\n")),s.join("\n")}function u(r){var n=r.dataSync(),a=r.size,t=r.strides[r.strides.length-1],e=new Array(t).fill(0);if(r.rank>1)for(var u=0;u<a/t;u++)for(var i=u*t,o=0;o<t;o++)e[o]=Math.max(e[o],s(n[i+o],0).length);return e}function s(n,a){return r.rightPad(parseFloat(n.toFixed(t)).toString(),a)}function i(r,t,e,u,o){void 0===o&&(o=!0);var p=t[0],f=t.length;if(0===f)return[r[0].toString()];if(1===f){if(p>n){var h=Array.from(r.subarray(0,a)),l=Array.from(r.subarray(p-a,p));return["["+h.map(function(r,n){return s(r,u[n])}).join(", ")+", ..., "+l.map(function(r,n){return s(r,u[p-a+n])}).join(", ")+"]"]}return["["+Array.from(r).map(function(r,n){return s(r,u[n])}).join(", ")+"]"]}var y=t.slice(1),v=e.slice(1),c=e[0],d=[];if(p>n){for(var g=0;g<a;g++){var m=(b=g*c)+c;d.push.apply(d,i(r.subarray(b,m),y,v,u,!1))}d.push("...");for(g=p-a;g<p;g++){m=(b=g*c)+c;d.push.apply(d,i(r.subarray(b,m),y,v,u,g===p-1))}}else for(g=0;g<p;g++){var b;m=(b=g*c)+c;d.push.apply(d,i(r.subarray(b,m),y,v,u,g===p-1))}var j=2===f?",":"";d[0]="["+d[0]+j;for(g=1;g<d.length-1;g++)d[g]=" "+d[g]+j;var S=",\n";for(g=2;g<f;g++)S+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(o?"":S),d}exports.tensorToString=e;
},{"./util":12}],15:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),e=this&&this.__decorate||function(t,e,o,r){var s,n=arguments.length,i=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,r);else for(var h=t.length-1;h>=0;h--)(s=t[h])&&(i=(n<3?s(i):n>3?s(e,o,i):s(e,o))||i);return n>3&&i&&Object.defineProperty(e,o,i),i},o=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(s,n){function i(t){try{p(r.next(t))}catch(t){n(t)}}function h(t){try{p(r.throw(t))}catch(t){n(t)}}function p(t){t.done?s(t.value):new o(function(e){e(t.value)}).then(i,h)}p((r=r.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var o,r,s,n,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function h(n){return function(h){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,r&&(s=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,r=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){i=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){i.label=n[1];break}if(6===n[0]&&i.label<s[1]){i.label=s[1],s=n;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(n);break}s[2]&&i.ops.pop(),i.trys.pop();continue}n=e.call(t,i)}catch(t){n=[6,t],r=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,h])}}};Object.defineProperty(exports,"__esModule",{value:!0});var s=require("./doc"),n=require("./environment"),i=require("./ops/ops"),h=require("./tensor_util"),p=require("./util"),u=function(){function t(t,e,o){if(this.shape=t,this.dtype=e,this.values=o,null!=o){var r=o.length,s=p.sizeFromShape(t);p.assert(r===s,"Length of values '"+r+"' does not match the size inferred by the shape '"+s+"'")}this.values=o||p.getTypedArrayFromDType(e,p.sizeFromShape(t)),this.strides=v(t),this.size=p.sizeFromShape(t)}return t.prototype.set=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];0===e.length&&(e=[0]),p.assert(e.length===this.rank,"The number of provided coordinates ("+e.length+") must match the rank ("+this.rank+")");var r=this.locToIndex(e);this.values[r]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var o=t[t.length-1],r=0;r<t.length-1;++r)o+=this.strides[r]*t[r];return this.values[o]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],o=0;o<t.length-1;++o)e+=this.strides[o]*t[o];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),o=0;o<e.length-1;++o)e[o]=Math.floor(t/this.strides[o]),t-=e[o]*this.strides[o];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return a.make(this.shape,{values:this.values},this.dtype)},e([s.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"set",null),e([s.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"get",null),e([s.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"toTensor",null),t=e([s.doc({heading:"Tensors",subheading:"Classes"})],t)}();exports.TensorBuffer=u;var a=function(){function t(t,e,o,r){this.isDisposed=!1,this.size=p.sizeFromShape(t),null!=o&&p.assert(this.size===o.length,"Constructing tensor of shape ("+this.size+") should match the length of values ("+o.length+")"),this.shape=t,this.dtype=e||"float32",this.strides=v(t),this.dataId=null!=r?r:{},this.id=u.nextId++,this.rankType=this.rank<5?this.rank.toString():"higher",n.ENV.engine.registerTensor(this),null!=o&&n.ENV.engine.write(this.dataId,o)}return u=t,t.ones=function(t,e){return i.ones(t,e)},t.zeros=function(t,e){return i.zeros(t,e)},t.onesLike=function(t){return i.onesLike(t)},t.zerosLike=function(t){return i.zerosLike(t)},t.like=function(t){return i.clone(t)},t.make=function(t,e,o){return new u(t,o,e.values,e.dataId)},t.fromPixels=function(t,e){return void 0===e&&(e=3),i.fromPixels(t,e)},t.rand=function(t,e,o){return i.rand(t,e,o)},t.randNormal=function(t,e,o,r,s){return void 0===e&&(e=0),void 0===o&&(o=1),i.randomNormal(t,e,o,r,s)},t.randTruncatedNormal=function(t,e,o,r,s){return void 0===e&&(e=0),void 0===o&&(o=1),i.truncatedNormal(t,e,o,r,s)},t.randUniform=function(t,e,o,r){return i.randomUniform(t,e,o,r)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),p.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,o){return this.throwIfDisposed(),this.reshape([t,e,o])},t.prototype.as4D=function(t,e,o,r){return this.throwIfDisposed(),this.reshape([t,e,o,r])},t.prototype.asType=function(t){return this.throwIfDisposed(),i.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.throwIfDisposed(),0===t.length&&(t=[0]);for(var o=t[t.length-1],r=0;r<t.length-1;++r)o+=this.strides[r]*t[r];return this.dataSync()[o]},t.prototype.val=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return 0===t.length&&(t=[0]),this.throwIfDisposed(),[4,this.data()];case 1:return e.sent(),[2,this.get.apply(this,t)]}})})},t.prototype.locToIndex=function(t){if(this.throwIfDisposed(),0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],o=0;o<t.length-1;++o)e+=this.strides[o]*t[o];return e},t.prototype.indexToLoc=function(t){if(this.throwIfDisposed(),0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),o=0;o<e.length-1;++o)e[o]=Math.floor(t/this.strides[o]),t-=e[o]*this.strides[o];return e[e.length-1]=t,e},t.prototype.getValues=function(){return this.dataSync()},t.prototype.getValuesAsync=function(){return this.data()},t.prototype.buffer=function(){return i.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.data=function(){return o(this,void 0,void 0,function(){return r(this,function(t){return this.throwIfDisposed(),[2,n.ENV.engine.read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),n.ENV.engine.readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,n.ENV.engine.disposeTensor(this))},t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),i.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),i.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),i.expandDims(this,t)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),i.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),i.clone(this)},t.prototype.toString=function(){return h.tensorToString(this,!0)},t.prototype.tile=function(t){return this.throwIfDisposed(),i.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),i.gather(this,t)},t.prototype.matMul=function(t,e,o){return void 0===e&&(e=!1),void 0===o&&(o=!1),this.throwIfDisposed(),i.matMul(this,t,e,o)},t.prototype.norm=function(t,e,o){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===o&&(o=!1),this.throwIfDisposed(),i.norm(this,t,e,o)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),i.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),i.reverse(this,t)},t.prototype.concat=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),i.concat([this,t],e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),i.stack([this,t],e)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),i.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,o,r,s){return void 0===o&&(o=.001),this.throwIfDisposed(),i.batchNormalization(this,t,e,o,r,s)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),i.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),i.sum(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),i.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),i.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),i.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),i.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),i.argMax(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),i.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),i.addStrict(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),i.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),i.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),i.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),i.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),i.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),i.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),i.div(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),i.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),i.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),i.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),i.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),i.maximumStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),i.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),i.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),i.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),i.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),i.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),i.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),i.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),i.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),i.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),i.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),i.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),i.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),i.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),i.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),i.logicalOr(this,t)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),i.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),i.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),i.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),i.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),i.floor(this)},t.prototype.exp=function(){return this.throwIfDisposed(),i.exp(this)},t.prototype.log=function(){return this.throwIfDisposed(),i.log(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),i.sqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),i.square(this)},t.prototype.abs=function(){return this.throwIfDisposed(),i.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),i.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),i.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),i.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),i.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),i.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),i.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),i.sigmoid(this)},t.prototype.sin=function(){return this.throwIfDisposed(),i.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),i.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),i.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),i.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),i.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),i.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),i.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),i.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),i.tanh(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),i.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),i.softmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),i.image.resizeBilinear(this,t,e)},t.prototype.conv1d=function(t,e,o,r){return this.throwIfDisposed(),i.conv1d(this,t,e,o,r)},t.prototype.conv2d=function(t,e,o,r){return this.throwIfDisposed(),i.conv2d(this,t,e,o,r)},t.prototype.conv2dTranspose=function(t,e,o,r,s){return this.throwIfDisposed(),i.conv2dTranspose(this,t,e,o,r,s)},t.prototype.depthwiseConv2D=function(t,e,o,r,s){return void 0===r&&(r=[1,1]),this.throwIfDisposed(),i.depthwiseConv2d(this,t,e,o,r,s)},t.prototype.avgPool=function(t,e,o,r){return this.throwIfDisposed(),i.avgPool(this,t,e,o,r)},t.prototype.maxPool=function(t,e,o,r){return this.throwIfDisposed(),i.maxPool(this,t,e,o,r)},t.prototype.minPool=function(t,e,o,r){return this.throwIfDisposed(),i.minPool(this,t,e,o,r)},t.prototype.localResponseNormalization=function(t,e,o,r,s){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===o&&(o=1),void 0===r&&(r=.5),void 0===s&&(s="acrossChannels"),i.localResponseNormalization(this,t,e,o,r,s)},t.prototype.variable=function(t,e,o){return void 0===t&&(t=!0),this.throwIfDisposed(),g.variable(this,t,e,o)},t.nextId=0,e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"flatten",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"asScalar",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as1D",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as2D",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as3D",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as4D",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"asType",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"buffer",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"data",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"dataSync",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"dispose",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toFloat",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toInt",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toBool",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"print",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"reshape",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"reshapeAs",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"expandDims",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"squeeze",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"clone",null),e([s.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toString",null),t=u=e([s.doc({heading:"Tensors",subheading:"Classes"})],t);var u}();exports.Tensor=a,exports.NDArray=a;var d=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return t(o,e),o.new=function(t,e){return i.scalar(t,e)},o}(a);exports.Scalar=d;var f=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return t(o,e),o.new=function(t,e){return i.tensor1d(t,e)},o}(a);exports.Tensor1D=f,exports.Array1D=f;var l=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return t(o,e),o.new=function(t,e,o){return i.tensor2d(e,t,o)},o}(a);exports.Tensor2D=l,exports.Array2D=l;var c=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return t(o,e),o.new=function(t,e,o){return i.tensor3d(e,t,o)},o}(a);exports.Tensor3D=c,exports.Array3D=c;var y=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return t(o,e),o.new=function(t,e,o){return i.tensor4d(e,t,o)},o}(a);exports.Tensor4D=y,exports.Array4D=y;var g=function(o){function r(t,e,r){void 0===e&&(e=!0);var s=o.call(this,t.shape,t.dtype,null,t.dataId)||this;return s.trainable=e,s.name=r,null==s.name&&(s.name=i.nextVarId.toString(),i.nextVarId++),n.ENV.engine.registerVariable(s),s}return t(r,o),i=r,r.variable=function(t,e,o,r){return void 0===e&&(e=!0),null!=r&&r!==t.dtype&&(t=t.asType(r)),new i(t,e,o)},r.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!p.arraysEqual(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");n.ENV.engine.disposeTensor(this),this.dataId=t.dataId,n.ENV.engine.registerTensor(this)},r.nextVarId=0,e([s.doc({heading:"Tensors",subheading:"Classes"})],r.prototype,"assign",null),e([s.doc({heading:"Tensors",subheading:"Creation"})],r,"variable",null),r=i=e([s.doc({heading:"Tensors",subheading:"Classes"})],r);var i}(a);exports.Variable=g;var w=g.variable;function v(t){var e=t.length;if(e<2)return[];var o=new Array(e-1);o[e-2]=t[e-1];for(var r=e-3;r>=0;--r)o[r]=o[r+1]*t[r+1];return o}exports.variable=w;
},{"./doc":44,"./environment":10,"./ops/ops":40,"./tensor_util":48,"./util":12}],72:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../util");function e(n,e){for(var r=0;r<n.length;++r)if(n[n.length-r-1]!==e-1-r)return!1;return!0}function r(n,e,r){for(var t=n.length+e.length,u=[],o=0,s=0,i=0;i<t;i++)-1===r.indexOf(i)?u.push(n[o++]):u.push(e[s++]);return u}function t(n,e){for(var r=[],t=n.length,u=0;u<t;u++)-1===e.indexOf(u)&&r.push(n[u]);return[r,e.map(function(e){return n[e]})]}function u(n,e){return r(n,e.map(function(n){return 1}),e)}function o(e,r){var t=r.length;return e=null==e?r.map(function(n,e){return e}):[].concat(e),n.assert(e.every(function(n){return n>=-t&&n<t}),"All values in axis param must be in range [-"+t+", "+t+") but got axis "+e),n.assert(e.every(function(e){return n.isInt(e)}),"All values in axis param must be integers but got axis "+e),e.map(function(n){return n<0?t+n:n})}function s(r,t,u){n.assert(e(t,u),r+" supports only inner-most axes for now. Got axes "+t+" and rank-"+u+" input.")}function i(n,r){if(e(n,r))return null;for(var t=[],u=0;u<r;++u)-1===n.indexOf(u)&&t.push(u);return n.forEach(function(n){return t.push(n)}),t}function a(n){return n.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function p(n,e){for(var r=[],t=e-n;t<e;++t)r.push(t);return r}exports.axesAreInnerMostDims=e,exports.combineLocations=r,exports.computeOutAndReduceShapes=t,exports.expandShapeToKeepDim=u,exports.parseAxisParam=o,exports.assertAxesAreInnerMostDims=s,exports.getAxesPermutation=i,exports.getUndoAxesPermutation=a,exports.getInnerMostAxes=p;
},{"../util":12}],68:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../util");function t(t,r,n){var a=t.length,s=r.length;e.assert(t.length===r.length,"Error in concat"+a+"D: rank of x1 ("+a+") and x2 ("+s+") must be the same."),e.assert(n>=0&&n<a,"Error in concat"+a+"D: axis must be between 0 and "+(a-1)+".");for(var o=0;o<a;o++)e.assert(o===n||t[o]===r[o],"Error in concat"+a+"D: Shape ("+t+") does not match ("+r+") along the non-concatenated axis "+o+".")}function r(t,r){e.assert(1===t.length&&1===r.length,"x1 and x2 should be 1d array.");var n=t.slice();return n[0]+=r[0],n}function n(t,r,n){e.assert(t.length===r.length,"x1 and x2 should have the same rank.");var a=t.slice();return a[n]+=r[n],a}function a(e,t){return{aBegin:[0,0],aSize:e,bBegin:[0,e[1]],bSize:t}}exports.assertParams=t,exports.computeOutShape1D=r,exports.computeOutShape=n,exports.computeGradientSliceShapes=a;
},{"../util":12}],75:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../globals");function r(r,t,n){var o=n.value;return n.value=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.tidy(t,function(){return o.apply(void 0,r)})},n}exports.operation=r;
},{"../globals":19}],77:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,n,r){var c,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(c=e[i])&&(o=(a<3?c(o):a>3?c(t,n,o):c(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../doc"),n=require("../environment"),r=require("../util"),c=require("./axis_util"),a=require("./concat_util"),o=require("./operation"),i=function(){function n(){}return n.concat1d=function(e){return n.concat(e,0)},n.concat2d=function(e,t){return n.concat(e,t)},n.concat3d=function(e,t){return n.concat(e,t)},n.concat4d=function(e,t){return n.concat(e,t)},n.concat=function(e,t){void 0===t&&(t=0),r.assert(e.length>=2,"Pass at least two tensors to concat");for(var n=e[0],a=c.parseAxisParam(t,n.shape),o=1;o<e.length;++o)n=s(n,e[o],a[0]);return n},e([t.doc({heading:"Tensors",subheading:"Slicing and Joining"}),o.operation],n,"concat",null),n}();function s(e,t,c){a.assertParams(e.shape,t.shape,c);var o=a.computeOutShape(e.shape,t.shape,c),i=e.as2D(-1,r.sizeFromShape(e.shape.slice(c))),s=t.as2D(-1,r.sizeFromShape(t.shape.slice(c))),u=a.computeGradientSliceShapes(i.shape,s.shape),p=u.aBegin,l=u.aSize,f=u.bBegin,h=u.bSize;return n.ENV.engine.runKernel(function(e){return e.concat(i,s)},{a:i,b:s},function(e){return{a:function(){return e.slice(p,l)},b:function(){return e.slice(f,h)}}}).reshape(o)}exports.ConcatOps=i;
},{"../doc":44,"../environment":10,"../util":12,"./axis_util":72,"./concat_util":68,"./operation":75}],110:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("seedrandom"),e=function(){function e(e,i,s,r,a){this.mean=e,this.stdDev=i,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var n=a||Math.random();this.random=t.alea(n.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,i,s=!1;!s;){var r=void 0,a=void 0,n=void 0;do{n=(r=2*this.random()-1)*r+(a=2*this.random()-1)*a}while(n>=1||0===n);var h=Math.sqrt(-2*Math.log(n)/n);e=this.mean+this.stdDev*r*h,i=this.mean+this.stdDev*a*h,this.truncated&&!this.isValidTruncated(e)||(s=!0)}return this.truncated&&!this.isValidTruncated(i)||(this.nextVal=this.convertValue(i)),this.convertValue(e)},e.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}();exports.MPRandGauss=e;
},{"seedrandom":151}],50:[function(require,module,exports) {
"use strict";var n=this&&this.__decorate||function(n,e,r,o){var a,t=arguments.length,i=t<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(n,e,r,o);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(t<3?a(i):t>3?a(e,r,i):a(e,r))||i);return t>3&&i&&Object.defineProperty(e,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../doc"),r=require("../environment"),o=require("../tensor"),a=require("../tensor_util"),t=require("../util"),i=require("./axis_util"),s=require("./concat"),u=require("./operation"),d=require("./rand"),l=function(){function l(){}return l.tensor=function(n,e,r){void 0===r&&(r="float32");var a=t.inferShape(n);return null!=e&&1!==a.length&&t.assertShapesMatch(e,a,"Error creating a new Tensor. Inferred shape ("+a+") does not match the provided shape ("+e+"). "),t.isTypedArray(n)||Array.isArray(n)||(n=[n]),e=e||a,o.Tensor.make(e,{values:c(n,r)},r)},l.scalar=function(n,e){if(void 0===e&&(e="float32"),t.isTypedArray(n)||Array.isArray(n))throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return l.tensor(n,[],e)},l.tensor1d=function(n,e){void 0===e&&(e="float32");var r=t.inferShape(n);if(1!==r.length)throw new Error("Error creating a new Tensor1D: values must be a flat/TypedArray");return l.tensor(n,r,e)},l.tensor2d=function(n,e,r){void 0===r&&(r="float32");var o=t.inferShape(n);if(2!==o.length&&1!==o.length)throw new Error("Error creating a new Tensor2D: values must be number[][] or flat/TypedArray");return e=e||o,l.tensor(n,e,r)},l.tensor3d=function(n,e,r){void 0===r&&(r="float32");var o=t.inferShape(n);if(3!==o.length&&1!==o.length)throw new Error("Error creating a new Tensor3D: values must be number[][][]or flat/TypedArray");return e=e||o,l.tensor(n,e,r)},l.tensor4d=function(n,e,r){void 0===r&&(r="float32");var o=t.inferShape(n);if(4!==o.length&&1!==o.length)throw new Error("Error creating a new Tensor4D: values must be number[][][][]or flat/TypedArray");return e=e||o,l.tensor(n,e,r)},l.ones=function(n,e){void 0===e&&(e="float32");var r=f(t.sizeFromShape(n),e);return o.Tensor.make(n,{values:r},e)},l.zeros=function(n,e){void 0===e&&(e="float32");var r=h(t.sizeFromShape(n),e);return o.Tensor.make(n,{values:r},e)},l.fill=function(n,e,r){void 0===r&&(r="float32");var a=t.getTypedArrayFromDType(r,t.sizeFromShape(n));return a.fill(e),o.Tensor.make(n,{values:a},r)},l.onesLike=function(n){return l.ones(n.shape,n.dtype)},l.zerosLike=function(n){return l.zeros(n.shape,n.dtype)},l.clone=function(n){return o.Tensor.make(n.shape,{dataId:n.dataId},n.dtype)},l.randomNormal=function(n,e,r,a,t){if(void 0===e&&(e=0),void 0===r&&(r=1),null!=a&&"bool"===a)throw new Error("Unsupported data type "+a);var i=new d.MPRandGauss(e,r,a,!1,t);return o.Tensor.rand(n,function(){return i.nextValue()},a)},l.truncatedNormal=function(n,e,r,a,t){if(void 0===e&&(e=0),void 0===r&&(r=1),null!=a&&"bool"===a)throw new Error("Unsupported data type "+a);var i=new d.MPRandGauss(e,r,a,!0,t);return o.Tensor.rand(n,function(){return i.nextValue()},a)},l.randomUniform=function(n,e,r,a){return void 0===e&&(e=0),void 0===r&&(r=1),void 0===a&&(a="float32"),o.Tensor.rand(n,function(){return t.randUniform(e,r)},a)},l.rand=function(n,e,r){var a=t.sizeFromShape(n),i=null;if(null==r||"float32"===r)i=new Float32Array(a);else if("int32"===r)i=new Int32Array(a);else{if("bool"!==r)throw new Error("Unknown data type "+r);i=new Uint8Array(a)}for(var s=0;s<a;s++)i[s]=e();return o.Tensor.make(n,{values:i},r)},l.multinomial=function(n,e,o){var a=n.size,t=n.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(t>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+t);o=o||Math.random();var i=1===t?n.as2D(1,-1):n,s=r.ENV.engine.runKernel(function(n){return n.multinomial(i,e,o)},{prob2D:i});return 1===t?s.as1D():s},l.oneHot=function(n,e,o,a){if(void 0===o&&(o=1),void 0===a&&(a=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);return r.ENV.engine.runKernel(function(r){return r.oneHot(n,e,o,a)},{indices:n})},l.fromPixels=function(n,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return r.ENV.engine.fromPixels(n,e)},l.reshape=function(n,e){e=t.inferFromImplicitShape(e,n.size),t.assert(n.size===t.sizeFromShape(e),"new shape and old shape must have the same number of elements.");return r.ENV.engine.runKernel(function(r){return o.Tensor.make(e,{dataId:n.dataId},n.dtype)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}})},l.squeeze=function(n,e){return l.reshape(n,t.squeezeShape(n.shape,e).newShape)},l.cast=function(n,e){return r.ENV.engine.runKernel(function(r){if(!t.hasEncodingLoss(n.dtype,e))return o.Tensor.make(n.shape,{dataId:n.dataId},e);if("int32"===e)return r.int(n);if("bool"===e)return r.notEqual(n,l.scalar(0,n.dtype));throw new Error("Error in Cast: unknown dtype argument ("+e+")")},{x:n},function(n){return{x:function(){return n.clone()}}})},l.tile=function(n,e){t.assert(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+".");return r.ENV.engine.runKernel(function(r){return r.tile(n,e)},{x:n},function(r){return{x:function(){var o=l.zerosLike(n);if(1===n.rank)for(var a=0;a<e[0];++a)o=o.add(r.slice([a*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(a=0;a<e[0];++a)for(var t=0;t<e[1];++t)o=o.add(r.slice([a*n.shape[0],t*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(a=0;a<e[0];++a)for(t=0;t<e[1];++t)for(var i=0;i<e[2];++i)o=o.add(r.slice([a*n.shape[0],t*n.shape[1],i*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(a=0;a<e[0];++a)for(t=0;t<e[1];++t)for(i=0;i<e[2];++i)for(var s=0;s<e[3];++s)o=o.add(r.slice([a*n.shape[0],t*n.shape[1],i*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return o}}})},l.gather=function(n,e,o){void 0===o&&(o=0);var a=i.parseAxisParam(o,n.shape);return r.ENV.engine.runKernel(function(r){return r.gather(n,e,a[0])},{x:n,indices:e})},l.pad1d=function(n,e,r){return void 0===r&&(r=0),t.assert(2===e.length,"Invalid number of paddings. Must be length of 2."),l.pad(n,[e],r)},l.pad2d=function(n,e,r){return void 0===r&&(r=0),t.assert(2===e.length&&2===e[0].length&&2===e[1].length,"Invalid number of paddings. Must be length of 2 each."),l.pad(n,e,r)},l.pad3d=function(n,e,r){return void 0===r&&(r=0),t.assert(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,"Invalid number of paddings. Must be length of 2 each."),l.pad(n,e,r)},l.pad4d=function(n,e,r){return void 0===r&&(r=0),t.assert(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,"Invalid number of paddings. Must be length of 2 each."),l.pad(n,e,r)},l.pad=function(n,e,o){if(void 0===o&&(o=0),0===n.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a=e.map(function(n){return n[0]});return r.ENV.engine.runKernel(function(r){return r.pad(n,e,o)},{x:n},function(e){return{x:function(){return e.slice(a,n.shape)}}})},l.stack=function(n,e){void 0===e&&(e=0),t.assert(n.length>=2,"Pass at least two tensors to dl.stack");var r=n[0].rank,o=n[0].shape,a=n[0].dtype;t.assert(e<=r,"Axis must be <= rank of the tensor"),n.forEach(function(n){t.assertShapesMatch(o,n.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(n){t.assert(a===n.dtype,"All tensors passed to stack must have matching dtypes")});var i=n.map(function(n){return n.expandDims(e)});return s.ConcatOps.concat(i,e)},l.expandDims=function(n,e){void 0===e&&(e=0),t.assert(e<=n.rank,"Axis must be <= rank of the tensor");var r=n.shape.slice();return r.splice(e,0,1),l.reshape(n,r)},l.linspace=function(n,e,r){if(0===r)throw new Error("Cannot request zero samples");var a=(e-n)/(r-1),t=h(r,"float32");t[0]=n;for(var i=1;i<t.length;i++)t[i]=t[i-1]+a;return o.Tensor1D.new(t,"float32")},l.range=function(n,e,r,o){if(void 0===r&&(r=1),void 0===o&&(o="float32"),0===r)throw new Error("Cannot have a step of zero");if(n===e||n<e&&r<0||e<n&&r>1)return l.zeros([0],o);var a=h(Math.abs(Math.ceil((e-n)/r)),o);e<n&&1===r&&(r=-1),a[0]=n;for(var t=1;t<a.length;t++)a[t]=a[t-1]+r;return l.tensor1d(a,o)},l.buffer=function(n,e,r){return void 0===e&&(e="float32"),new o.TensorBuffer(n,e,r)},l.print=function(n,e){void 0===e&&(e=!1),console.log(a.tensorToString(n,e))},n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"tensor",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"scalar",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"tensor1d",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"tensor2d",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"tensor3d",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"tensor4d",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"ones",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"zeros",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"fill",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"onesLike",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"zerosLike",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"clone",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"randomNormal",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"truncatedNormal",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"randomUniform",null),n([u.operation],l,"rand",null),n([u.operation],l,"multinomial",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"oneHot",null),n([e.doc({heading:"Tensors",subheading:"Creation"}),u.operation],l,"fromPixels",null),n([e.doc({heading:"Tensors",subheading:"Transformations"}),u.operation],l,"reshape",null),n([e.doc({heading:"Tensors",subheading:"Transformations"})],l,"squeeze",null),n([e.doc({heading:"Tensors",subheading:"Transformations"}),u.operation],l,"cast",null),n([e.doc({heading:"Tensors",subheading:"Slicing and Joining"}),u.operation],l,"tile",null),n([e.doc({heading:"Tensors",subheading:"Slicing and Joining"}),u.operation],l,"gather",null),n([e.doc({heading:"Tensors",subheading:"Transformations"}),u.operation],l,"pad",null),n([e.doc({heading:"Tensors",subheading:"Slicing and Joining"}),u.operation],l,"stack",null),n([e.doc({heading:"Tensors",subheading:"Transformations"}),u.operation],l,"expandDims",null),n([u.operation,e.doc({heading:"Tensors",subheading:"Creation"})],l,"linspace",null),n([u.operation,e.doc({heading:"Tensors",subheading:"Creation"})],l,"range",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"buffer",null),n([e.doc({heading:"Tensors",subheading:"Creation"})],l,"print",null),l}();function h(n,e){if(null==e||"float32"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e)return new Uint8Array(n);throw new Error("Unknown data type $ {dtype}")}function f(n,e){for(var r=h(n,e),o=0;o<r.length;o++)r[o]=1;return r}function c(n,e){return p(n,e)?n:(Array.isArray(n)&&(n=t.flatten(n)),t.copyTypedArray(n,e))}function p(n,e){return n instanceof Float32Array&&"float32"===e||n instanceof Int32Array&&"int32"===e||n instanceof Uint8Array&&"bool"===e}exports.ArrayOps=l;
},{"../doc":44,"../environment":10,"../tensor":15,"../tensor_util":48,"../util":12,"./axis_util":72,"./concat":77,"./operation":75,"./rand":110}],51:[function(require,module,exports) {
"use strict";var r=this&&this.__decorate||function(r,a,n,t){var o,e=arguments.length,i=e<3?a:null===t?t=Object.getOwnPropertyDescriptor(a,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(r,a,n,t);else for(var k=r.length-1;k>=0;k--)(o=r[k])&&(i=(e<3?o(i):e>3?o(a,n,i):o(a,n))||i);return e>3&&i&&Object.defineProperty(a,n,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("../doc"),n=require("../environment"),t=require("../util"),o=require("./operation"),e=function(){function e(){}return e.batchNormalization2d=function(r,a,n,o,i,k){return void 0===o&&(o=.001),t.assert(2===r.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+r.rank+"."),t.assert(2===a.rank||1===a.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+a.rank+"."),t.assert(2===n.rank||1===n.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+n.rank+"."),null!=i&&t.assert(2===i.rank||1===i.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."),null!=k&&t.assert(2===k.rank||1===k.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+k.rank+"."),e.batchNormalization(r,a,n,o,i,k)},e.batchNormalization3d=function(r,a,n,o,i,k){return void 0===o&&(o=.001),t.assert(3===r.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+r.rank+"."),t.assert(3===a.rank||1===a.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+a.rank+"."),t.assert(3===n.rank||1===n.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+n.rank+"."),null!=i&&t.assert(3===i.rank||1===i.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."),null!=k&&t.assert(3===k.rank||1===k.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+k.rank+"."),e.batchNormalization(r,a,n,o,i,k)},e.batchNormalization4d=function(r,a,n,o,i,k){return void 0===o&&(o=.001),t.assert(4===r.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+r.rank+"."),t.assert(4===a.rank||1===a.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+a.rank+"."),t.assert(4===n.rank||1===n.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+n.rank+"."),null!=i&&t.assert(4===i.rank||1===i.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."),null!=k&&t.assert(4===k.rank||1===k.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+k.rank+"."),e.batchNormalization(r,a,n,o,i,k)},e.batchNormalization=function(r,a,t,o,e,k){var s;return void 0===o&&(o=.001),s=0===r.rank||1===r.rank?r.as4D(1,1,1,r.size):2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r,n.ENV.engine.runKernel(function(r){return r.batchNormalization4D(s,i(a),i(t),o,i(e),i(k))},{x:r,mean:a,variance:t}).reshape(r.shape)},r([o.operation],e,"batchNormalization2d",null),r([o.operation],e,"batchNormalization3d",null),r([o.operation],e,"batchNormalization4d",null),r([a.doc({heading:"Operations",subheading:"Normalization"})],e,"batchNormalization",null),e}();function i(r){return null==r?null:0===r.rank?r.as1D():1===r.rank?r:2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}exports.BatchNormOps=e;
},{"../doc":44,"../environment":10,"../util":12,"./operation":75}],73:[function(require,module,exports) {
"use strict";function t(t,e){for(var r=t.length,n=[],a=0;a<r;a++){var o=r-1-a,s=t[o]||1;(e[e.length-1-a]||1)>1&&1===s&&n.unshift(o)}return n}function e(t,e){for(var r=[],n=0;n<e.length;n++){var a=t[t.length-n-1],o=e.length-n-1,s=e[o];(null==a||1===a&&s>1)&&r.unshift(o)}return r}function r(t){for(var e=0;e<t.length;e++)if(t[e]!==e)return!1;return!0}function n(t,e){for(var r=[],n="Operands could not be broadcast together with shapes "+t+" and "+e+".",a=Math.max(t.length,e.length),o=0;o<a;o++){var s=t[t.length-o-1]||1,h=e[e.length-o-1]||1;if(s>1&&h>1&&s!==h)throw Error(n);r.unshift(Math.max(s,h))}return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBroadcastDims=t,exports.getReductionAxes=e,exports.broadcastDimsAreOuter=r,exports.assertAndGetBroadcastShape=n;
},{}],52:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,n){var a,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(u=(i<3?a(u):i>3?a(t,r,u):a(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../doc"),r=require("../environment"),n=require("../util"),a=require("./broadcast_util"),i=require("./operation"),u=require("./ops"),s=function(){function s(){}return s.add=function(e,t){n.assertTypesMatch(e,t);var i=a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.add(e,t)},{a:e,b:t},function(r){return{a:function(){var t=r,n=a.getReductionAxes(e.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(e.shape)},b:function(){var e=r,n=a.getReductionAxes(t.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(t.shape)}}})},s.addStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in addStrict: "),e.add(t)},s.sub=function(e,t){n.assertTypesMatch(e,t);var i=a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.subtract(e,t)},{a:e,b:t},function(r){return{a:function(){var t=r,n=a.getReductionAxes(e.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(e.shape)},b:function(){var e=r,n=a.getReductionAxes(t.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(t.shape)}}})},s.subStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in subStrict: "),e.sub(t)},s.pow=function(e,t){a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.pow(e,t)},{base:e},function(r){if(!n.arraysEqual(e.shape,t.shape)&&!n.isScalarShape(t.shape))throw new Error("Gradient of pow not yet supported for broadcasted shapes.");return{base:function(){var n=t.toFloat(),a=n.mul(e.toFloat().pow(n.sub(u.scalar(1))));return r.mulStrict(a)}}})},s.powStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)},s.mul=function(e,t){n.assertTypesMatch(e,t);var i=a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.multiply(e,t)},{a:e,b:t},function(r){return{a:function(){var n=r.mul(t.toFloat()),u=a.getReductionAxes(e.shape,i);return u.length>0?n.sum(u).reshape(e.shape):n},b:function(){var n=r.mul(e.toFloat()),u=a.getReductionAxes(t.shape,i);return u.length>0?n.sum(u).reshape(t.shape):n}}})},s.mulStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)},s.div=function(e,t){var n=a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.divide(e,t)},{a:e,b:t},function(r){return{a:function(){var i=r.div(t.toFloat()),u=a.getReductionAxes(e.shape,n);return u.length>0?i.sum(u).reshape(e.shape):i},b:function(){var i=r.mul(e.toFloat()),u=a.getReductionAxes(t.shape,n);u.length>0&&(i=i.sum(u).reshape(t.shape));var s=t.square();return i.div(s.toFloat()).neg()}}})},s.divStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in divideStrict: "),e.div(t)},s.minimum=function(e,t){n.assertTypesMatch(e,t),a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.minimum(e,t)},{a:e,b:t},function(r){return{a:function(){return r.mul(e.lessEqual(t).toFloat())},b:function(){return r.mul(e.greater(t).toFloat())}}})},s.minimumStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)},s.maximum=function(e,t){n.assertTypesMatch(e,t),a.assertAndGetBroadcastShape(e.shape,t.shape);return r.ENV.engine.runKernel(function(r){return r.maximum(e,t)},{a:e,b:t},function(r){return{a:function(){return r.mul(e.greaterEqual(t).toFloat())},b:function(){return r.mul(e.less(t).toFloat())}}})},s.maximumStrict=function(e,t){return n.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.maximum(t)},e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"add",null),e([i.operation],s,"addStrict",null),e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"sub",null),e([i.operation],s,"subStrict",null),e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"pow",null),e([i.operation],s,"powStrict",null),e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"mul",null),e([i.operation],s,"mulStrict",null),e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"div",null),e([i.operation],s,"divStrict",null),e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"minimum",null),e([i.operation],s,"minimumStrict",null),e([t.doc({heading:"Operations",subheading:"Arithmetic"}),i.operation],s,"maximum",null),e([i.operation],s,"maximumStrict",null),s}();exports.BinaryOps=s;
},{"../doc":44,"../environment":10,"../util":12,"./broadcast_util":73,"./operation":75,"./ops":40}],53:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,a){var n,s=arguments.length,u=s<3?r:null===a?a=Object.getOwnPropertyDescriptor(r,t):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,r,t,a);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(u=(s<3?n(u):s>3?n(r,t,u):n(r,t))||u);return s>3&&u&&Object.defineProperty(r,t,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),t=require("../environment"),a=require("../util"),n=require("./broadcast_util"),s=require("./operation"),u=function(){function u(){}return u.notEqual=function(e,r){return a.assertTypesMatch(e,r),n.assertAndGetBroadcastShape(e.shape,r.shape),t.ENV.engine.runKernel(function(t){return t.notEqual(e,r)},{a:e,b:r})},u.notEqualStrict=function(e,r){return a.assertShapesMatch(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)},u.less=function(e,r){return a.assertTypesMatch(e,r),n.assertAndGetBroadcastShape(e.shape,r.shape),t.ENV.engine.runKernel(function(t){return t.less(e,r)},{a:e,b:r})},u.lessStrict=function(e,r){return a.assertShapesMatch(e.shape,r.shape,"Error in lessStrict: "),e.less(r)},u.equal=function(e,r){return a.assertTypesMatch(e,r),n.assertAndGetBroadcastShape(e.shape,r.shape),t.ENV.engine.runKernel(function(t){return t.equal(e,r)},{a:e,b:r})},u.equalStrict=function(e,r){return a.assertShapesMatch(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)},u.lessEqual=function(e,r){return a.assertTypesMatch(e,r),n.assertAndGetBroadcastShape(e.shape,r.shape),t.ENV.engine.runKernel(function(t){return t.lessEqual(e,r)},{a:e,b:r})},u.lessEqualStrict=function(e,r){return a.assertShapesMatch(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)},u.greater=function(e,r){return a.assertTypesMatch(e,r),n.assertAndGetBroadcastShape(e.shape,r.shape),t.ENV.engine.runKernel(function(t){return t.greater(e,r)},{a:e,b:r})},u.greaterStrict=function(e,r){return a.assertShapesMatch(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)},u.greaterEqual=function(e,r){return a.assertTypesMatch(e,r),n.assertAndGetBroadcastShape(e.shape,r.shape),t.ENV.engine.runKernel(function(t){return t.greaterEqual(e,r)},{a:e,b:r})},u.greaterEqualStrict=function(e,r){return a.assertShapesMatch(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)},e([r.doc({heading:"Operations",subheading:"Logical"}),s.operation],u,"notEqual",null),e([s.operation],u,"notEqualStrict",null),e([r.doc({heading:"Operations",subheading:"Logical"}),s.operation],u,"less",null),e([s.operation],u,"lessStrict",null),e([r.doc({heading:"Operations",subheading:"Logical"}),s.operation],u,"equal",null),e([s.operation],u,"equalStrict",null),e([r.doc({heading:"Operations",subheading:"Logical"}),s.operation],u,"lessEqual",null),e([s.operation],u,"lessEqualStrict",null),e([r.doc({heading:"Operations",subheading:"Logical"}),s.operation],u,"greater",null),e([s.operation],u,"greaterStrict",null),e([r.doc({heading:"Operations",subheading:"Logical"}),s.operation],u,"greaterEqual",null),e([s.operation],u,"greaterEqualStrict",null),u}();exports.CompareOps=u;
},{"../doc":44,"../environment":10,"../util":12,"./broadcast_util":73,"./operation":75}],21:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../util");function e(t,e,n,o,a,i){void 0===i&&(i="channelsLast");var s,h=u(e),l=h[0],f=h[1];if("channelsLast"===i)s=[l,f,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,f,t[1],t[1]]}return r(t,s,n,1,o,a,!1,i)}function r(t,e,r,n,o,a,i,l){void 0===i&&(i=!1),void 0===l&&(l="channelsLast");var f=[-1,-1,-1,-1],c=f[0],p=f[1],d=f[2],m=f[3];if("channelsLast"===l)c=t[0],p=t[1],d=t[2],m=t[3];else{if("channelsFirst"!==l)throw new Error("Unknown dataFormat "+l);c=t[0],m=t[1],p=t[2],d=t[3]}var g,v=e[0],w=e[1],M=e[3],b=u(r),x=b[0],I=b[1],W=u(n),C=W[0],D=W[1],F=h(o,p,d,x,I,s(v,C),s(w,D),a),H=F.padInfo,S=F.outHeight,L=F.outWidth,k=i?M*m:M;return"channelsFirst"===l?g=[c,k,S,L]:"channelsLast"===l&&(g=[c,S,L,k]),{batchSize:c,dataFormat:l,inHeight:p,inWidth:d,inChannels:m,outHeight:S,outWidth:L,outChannels:k,padInfo:H,strideHeight:x,strideWidth:I,filterHeight:v,filterWidth:w,inShape:t,outShape:g,filterShape:e}}function n(e,r,n,a,i,u){null==i&&(i=o(e,r,a));var s=e[0],h=e[1],f=l((s-r+2*i)/a+1,u);t.assert(t.isInt(f),"The output # of rows ("+f+") must be an integer. Change the stride and/or zero pad parameters");var c=l((h-r+2*i)/a+1,u);return t.assert(t.isInt(c),"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"),[f,c,n]}function o(t,e,r){return Math.floor((t[0]*(r-1)-r+e)/2)}function a(t,e,r,n){return[r,n,t,e]}function i(t,e){return[(t[0]-1)*e+1,(t[1]-1)*e+1]}function u(t){return"number"==typeof t?[t,t]:t}function s(t,e){return e<=1?t:t+(t-1)*(e-1)}function h(t,e,r,o,a,i,u,s){var h,l,f;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t};var c=n([e,r,1],i,1,o,t,s);l=c[0],f=c[1]}else if("same"===t){var p=((l=Math.ceil(e/o))-1)*o+i-e,d=((f=Math.ceil(r/a))-1)*a+u-r,m=Math.floor(p/2),g=p-m,v=Math.floor(d/2);h={top:m,bottom:g,left:v,right:d-v}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);h={top:0,bottom:0,left:0,right:0},l=Math.ceil((e-i+1)/o),f=Math.ceil((r-u+1)/a)}return{padInfo:h,outHeight:l,outWidth:f}}function l(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}exports.computePool2DInfo=e,exports.computeConv2DInfo=r,exports.computeOutputShape3D=n,exports.computeDefaultPad=o,exports.computeWeightsShape4D=a,exports.computeDilatedRC=i;
},{"../util":12}],54:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,n,r,t){var a,o=arguments.length,s=o<3?n:null===t?t=Object.getOwnPropertyDescriptor(n,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,n,r,t);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(n,r,s):a(n,r))||s);return o>3&&s&&Object.defineProperty(n,r,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../doc"),r=require("../environment"),t=require("../util"),a=require("./conv_util"),o=require("./operation"),s=function(){function s(){}return s.conv1d=function(e,n,r,a,o){var i=e,p=!1;2===e.rank&&(p=!0,i=e.as3D(1,e.shape[0],e.shape[1])),t.assert(3===i.rank,"Error in conv1d: input must be rank 3, but got rank "+i.rank+"."),t.assert(3===n.rank,"Error in conv1d: filter must be rank 3, but got rank "+n.rank+"."),null!=o&&t.assert(t.isInt(a),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."),t.assert(i.shape[2]===n.shape[1],"Error in conv1d: depth of input ("+i.shape[2]+") must match  input depth for filter "+n.shape[1]+".");var u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),h=i.as4D(i.shape[0],1,i.shape[1],i.shape[2]),d=[1,r],c=s.conv2d(h,u,d,a,o);return p?c.as2D(c.shape[2],c.shape[3]):c.as3D(c.shape[0],c.shape[2],c.shape[3])},s.conv2d=function(e,n,o,i,p){var u=e,h=!1;3===e.rank&&(h=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),t.assert(4===u.rank,"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."),t.assert(4===n.rank,"Error in conv2d: filter must be rank 4, but got rank "+n.rank+"."),null!=p&&t.assert(t.isInt(i),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+p+" but got pad "+i+"."),t.assert(u.shape[3]===n.shape[2],"Error in conv2d: depth of input ("+u.shape[3]+") must match  input depth for filter "+n.shape[2]+".");var d=a.computeConv2DInfo(u.shape,n.shape,o,1,i,p),c=r.ENV.engine.runKernel(function(e){return e.conv2d(u,n,d)},{x:u,filter:n},function(e){return{x:function(){return s.conv2dDerInput(u.shape,e,n,o,i)},filter:function(){return s.conv2dDerFilter(u,e,n.shape,o,i)}}});return h?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c},s.conv2dDerInput=function(e,n,o,s,i,p){t.assert(e.length===n.rank,"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match");var u=e,h=n,d=!1;3===n.rank&&(d=!0,h=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),u=[1,e[0],e[1],e[2]]);var c=u[3],l=h.shape[3];t.assert(4===u.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."),t.assert(4===h.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+h.rank),t.assert(4===o.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+o.rank),t.assert(c===o.shape[2],"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+o.shape[2]+"."),t.assert(l===o.shape[3],"Error in conv2dDerInput: depth of output ("+l+") mustmatch output depth for filter "+o.shape[3]+"."),null!=p&&t.assert(t.isInt(i),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+p+" but got pad "+i+".");var v=a.computeConv2DInfo(u,o.shape,s,1,i,p),f=r.ENV.engine.runKernel(function(e){return e.conv2dDerInput(h,o,v)},{dy4D:h});return d?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f},s.conv2dDerFilter=function(e,n,o,s,i,p){var u=e;3===e.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var h=n;3===h.rank&&(h=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),t.assert(4===u.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."),t.assert(4===h.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+h.shape+"."),t.assert(4===o.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+o+"."),t.assert(u.shape[3]===o[2],"Error in conv2dDerFilter: depth of input "+u.shape[3]+") must match input depth in filter ("+o[2]+"."),t.assert(h.shape[3]===o[3],"Error in conv2dDerFilter: depth of dy ("+h.shape[3]+") must match output depth for filter ("+o[3]+")."),null!=p&&t.assert(t.isInt(i),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+p+" but got pad "+i+".");var d=a.computeConv2DInfo(u.shape,o,s,1,i,p);return r.ENV.engine.runKernel(function(e){return e.conv2dDerFilter(u,h,d)},{x4D:u,dy4D:h})},s.conv2dTranspose=function(e,n,r,t,a,o){return s.conv2dDerInput(r,e,n,t,a,o)},s.depthwiseConv2d=function(e,n,o,s,p,u){void 0===p&&(p=[1,1]);var h=e,d=!1;3===e.rank&&(d=!0,h=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),t.assert(4===h.rank,"Error in depthwiseConv2D: input must be rank 4, but got rank "+h.rank+"."),t.assert(4===n.rank,"Error in depthwiseConv2D: filter must be rank 4, but got rank "+n.rank+"."),t.assert(h.shape[3]===n.shape[2],"Error in depthwiseConv2D: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+n.shape[2]+"."),null==p&&(p=[1,1]);var c=i(p),l=c[0],v=c[1];t.assert(1===l&&1===v,"Error in depthwiseConv2D: dilation rates greater than 1 are not yet supported. Got dilations '"+p+"'"),null!=u&&t.assert(t.isInt(s),"Error in depthwiseConv2D: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+".");var f=a.computeConv2DInfo(h.shape,n.shape,o,p,s,u,!0),g=r.ENV.engine.runKernel(function(e){return e.depthwiseConv2D(h,n,f)},{input4D:h,filter:n});return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g},e([n.doc({heading:"Operations",subheading:"Convolution"}),o.operation],s,"conv1d",null),e([n.doc({heading:"Operations",subheading:"Convolution"}),o.operation],s,"conv2d",null),e([o.operation],s,"conv2dDerInput",null),e([o.operation],s,"conv2dDerFilter",null),e([n.doc({heading:"Operations",subheading:"Convolution"}),o.operation],s,"conv2dTranspose",null),e([n.doc({heading:"Operations",subheading:"Convolution"}),o.operation],s,"depthwiseConv2d",null),s}();function i(e){return"number"==typeof e?[e,e]:e}exports.ConvOps=s;
},{"../doc":44,"../environment":10,"../util":12,"./conv_util":21,"./operation":75}],55:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,n,t){var a,i=arguments.length,s=i<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,n,t);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(i<3?a(s):i>3?a(r,n,s):a(r,n))||s);return i>3&&s&&Object.defineProperty(r,n,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),n=require("../environment"),t=require("../util"),a=require("./operation"),i=function(){function i(){}return i.resizeBilinear=function(e,r,a){void 0===a&&(a=!1),t.assert(3===e.rank||4===e.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+e.rank+"."),t.assert(2===r.length,"Error in resizeBilinear: new shape must 2D, but got shape "+r+".");var i=e,s=!1;3===e.rank&&(s=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=r[0],u=r[1],c=n.ENV.engine.runKernel(function(e){return e.resizeBilinear(i,o,u,a)},{batchImages:i});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c},e([r.doc({heading:"Operations",subheading:"Images",namespace:"image"}),a.operation],i,"resizeBilinear",null),i}();exports.ImageOps=i;
},{"../doc":44,"../environment":10,"../util":12,"./operation":75}],16:[function(require,module,exports) {
"use strict";var t,o,n,e,l;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(t=exports.DType||(exports.DType={})),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4"}(o=exports.Rank||(exports.Rank={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32"}(n||(n={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(e||(e={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32"}(l||(l={}));var f={float32:l,int32:n,bool:e};function i(t,o){return f[t][o]}function a(t){return i(t,"int32")}exports.upcastType=i,exports.sumOutType=a;
},{}],56:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,o,t){var n,a=arguments.length,i=a<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,o):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,o,t);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(i=(a<3?n(i):a>3?n(r,o,i):n(r,o))||i);return a>3&&i&&Object.defineProperty(r,o,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),o=require("../environment"),t=require("../types"),n=require("../util"),a=require("./broadcast_util"),i=require("./operation"),l=function(){function l(){}return l.logicalNot=function(e){return n.assert("bool"===e.dtype,"Error Array must be of type bool."),o.ENV.engine.runKernel(function(r){return r.logicalNot(e)},{x:e})},l.logicalAnd=function(e,r){return n.assert("bool"===e.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),a.assertAndGetBroadcastShape(e.shape,r.shape),o.ENV.engine.runKernel(function(o){return o.logicalAnd(e,r)},{a:e,b:r})},l.logicalOr=function(e,r){return n.assert("bool"===e.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),a.assertAndGetBroadcastShape(e.shape,r.shape),o.ENV.engine.runKernel(function(o){return o.logicalOr(e,r)},{a:e,b:r})},l.logicalXor=function(e,r){return n.assert("bool"===e.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),a.assertAndGetBroadcastShape(e.shape,r.shape),o.ENV.engine.runKernel(function(o){return o.logicalXor(e,r)},{a:e,b:r})},l.where=function(e,r,a){n.assert("bool"===e.dtype||"bool"===r.dtype||"bool"===a.dtype,"Error Array must be of type bool."),n.assertShapesMatch(r.shape,a.shape,"Error in where: "),1===e.rank?n.assert(e.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):n.assertShapesMatch(e.shape,a.shape,"Error in where: ");var i=t.upcastType(r.dtype,a.dtype);return o.ENV.engine.runKernel(function(o){return o.where(e,r,a,i)},{condition:e,a:r,b:a})},e([r.doc({heading:"Operations",subheading:"Logical"}),i.operation],l,"logicalNot",null),e([r.doc({heading:"Operations",subheading:"Logical"}),i.operation],l,"logicalAnd",null),e([r.doc({heading:"Operations",subheading:"Logical"}),i.operation],l,"logicalOr",null),e([r.doc({heading:"Operations",subheading:"Logical"}),i.operation],l,"logicalXor",null),e([r.doc({heading:"Operations",subheading:"Logical"}),i.operation],l,"where",null),l}();exports.LogicalOps=l;
},{"../doc":44,"../environment":10,"../types":16,"../util":12,"./broadcast_util":73,"./operation":75}],57:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,n,o){var t,a=arguments.length,i=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,n,o);else for(var s=e.length-1;s>=0;s--)(t=e[s])&&(i=(a<3?t(i):a>3?t(r,n,i):t(r,n))||i);return a>3&&i&&Object.defineProperty(r,n,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),n=require("../environment"),o=require("../util"),t=require("./operation"),a=function(){function a(){}return a.localResponseNormalization=function(e,r,t,a,i,s){void 0===r&&(r=5),void 0===t&&(t=1),void 0===a&&(a=1),void 0===i&&(i=.5),void 0===s&&(s="acrossChannels"),o.assert(4===e.rank||3===e.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+e.rank+"."),o.assert(o.isInt(r),"Error in localResponseNormalization3D: radius must be an integer\n                     but got radius "+r+".");var l=e,u=!1;3===e.rank&&(u=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=n.ENV.engine.runKernel(function(e){return e.localResponseNormalization4D(l,r,t,a,i,s)},{x4D:l});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c},e([r.doc({heading:"Operations",subheading:"Normalization"}),t.operation],a,"localResponseNormalization",null),a}();exports.LRNOps=a;
},{"../doc":44,"../environment":10,"../util":12,"./operation":75}],58:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,l=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(l=(o<3?n(l):o>3?n(t,r,l):n(t,r))||l);return o>3&&l&&Object.defineProperty(t,r,l),l};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../doc"),r=require("./operation"),i=function(){function i(){}return i.multiRNNCell=function(e,t,r,i){for(var n=t,o=[],l=0;l<e.length;l++){var c=e[l](n,r[l],i[l]);o.push(c[0]),o.push(c[1]),n=c[1]}var a=[],u=[];for(l=0;l<o.length;l+=2)a.push(o[l]),u.push(o[l+1]);return[a,u]},i.basicLSTMCell=function(e,t,r,i,n,o){var l=i.concat(o,1).matMul(t).add(r),c=l.shape[0],a=l.shape[1]/4,u=[c,a],s=l.slice([0,0],u),d=l.slice([0,a],u),p=l.slice([0,2*a],u),h=l.slice([0,3*a],u),f=s.sigmoid().mulStrict(d.tanh()).addStrict(n.mulStrict(e.add(p).sigmoid()));return[f,f.tanh().mulStrict(h.sigmoid())]},e([t.doc({heading:"Operations",subheading:"RNN"}),r.operation],i,"multiRNNCell",null),e([t.doc({heading:"Operations",subheading:"RNN"}),r.operation],i,"basicLSTMCell",null),i}();exports.LSTMOps=i;
},{"../doc":44,"./operation":75}],31:[function(require,module,exports) {
"use strict";var r=this&&this.__decorate||function(r,t,e,n){var a,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(r,t,e,n);else for(var i=r.length-1;i>=0;i--)(a=r[i])&&(s=(o<3?a(s):o>3?a(t,e,s):a(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("../doc"),n=require("../environment"),a=require("../util"),o=require("./operation");!function(r){r[r.REGULAR=0]="REGULAR",r[r.TRANSPOSED=1]="TRANSPOSED"}(t=exports.MatrixOrientation||(exports.MatrixOrientation={}));var s=function(){function t(){}return t.matMul=function(r,t,e,o){void 0===e&&(e=!1),void 0===o&&(o=!1),c=[i(e),i(o)],o=c[1];var s=(e=c[0])?r.shape[0]:r.shape[1],u=o?t.shape[1]:t.shape[0];a.assert(2===r.rank&&2===t.rank,"Error in matMul: inputs must be rank 2, got ranks "+r.rank+" and "+t.rank+"."),a.assert(s===u,"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+r.shape+" and "+t.shape+" and transposeA="+e+" and transposeB="+o+" must match.");var c;return n.ENV.engine.runKernel(function(n){return n.matMul(r,t,e,o)},{a:r,b:t},function(n){if(e||o)throw new Error("Backprop for transposed MatMul not yet implemented.");return{a:function(){return n.matMul(t.toFloat(),!1,!0)},b:function(){return r.toFloat().matMul(n,!0,!1)}}})},t.vectorTimesMatrix=function(r,t){return a.assert(1===r.rank,"Error in vectorTimesMatrix: first input must be rank 1, but got rank "+r.rank+"."),a.assert(2===t.rank,"Error in vectorTimesMatrix: second input must be rank 2, but got rank "+t.rank+"."),a.assert(r.size===t.shape[0],"Error in vectorTimesMatrix: size of vector ("+r.size+") must match first dimension of matrix ("+t.shape[0]+")"),r.as2D(1,-1).matMul(t).as1D()},t.matrixTimesVector=function(r,t){return a.assert(1===t.rank,"Error in matrixTimesVector: second input must rank 1, but got rank "+t.rank+"."),a.assert(2===r.rank,"Error in matrixTimesVector: first input must be a rank 2, but got rank "+r.rank+"."),a.assert(t.size===r.shape[1],"Error in matrixTimesVector: size of first rank 1 input "+t.size+" must match inner dimension of second rank 2 input, but got shape "+r.shape+"."),r.matMul(t.as2D(-1,1)).as1D()},t.dotProduct=function(r,t){return a.assert(1===r.rank&&1===t.rank,"Error in dotProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+t.rank+"."),a.assert(r.size===t.size,"Error in dotProduct: size of inputs ("+r.size+") and ("+t.size+") must match."),r.as2D(1,-1).matMul(t.as2D(-1,1)).asScalar()},t.outerProduct=function(r,t){return a.assert(1===r.rank&&1===t.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+t.rank+"."),r.as2D(-1,1).matMul(t.as2D(1,-1))},r([e.doc({heading:"Operations",subheading:"Matrices"}),o.operation],t,"matMul",null),r([o.operation],t,"vectorTimesMatrix",null),r([o.operation],t,"matrixTimesVector",null),r([o.operation],t,"dotProduct",null),r([e.doc({heading:"Operations",subheading:"Matrices"}),o.operation],t,"outerProduct",null),t}();function i(r){return r!==t.REGULAR&&(r===t.TRANSPOSED||r)}exports.MatmulOps=s;
},{"../doc":44,"../environment":10,"../util":12,"./operation":75}],59:[function(require,module,exports) {
"use strict";var r=this&&this.__decorate||function(r,e,n,i){var t,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(r,e,n,i);else for(var u=r.length-1;u>=0;u--)(t=r[u])&&(o=(a<3?t(o):a>3?t(e,n,o):t(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../doc"),n=require("./axis_util"),i=require("./operation"),t=require("./ops"),a=function(){function t(){}return t.norm=function(r,e,i,t){void 0===e&&(e="euclidean"),void 0===i&&(i=null),void 0===t&&(t=!1);var a=o(r,e,i),u=a.shape;if(t){var s=n.parseAxisParam(i,r.shape);u=n.expandShapeToKeepDim(a.shape,s)}return a.reshape(u)},r([e.doc({heading:"Operations",subheading:"Matrices"}),i.operation],t,"norm",null),t}();function o(r,e,n){if(void 0===n&&(n=null),0===r.rank)return r.abs();if(1!==r.rank&&null===n)return o(r.reshape([-1]),e,n);if(1===r.rank||"number"==typeof n||n instanceof Array&&1===n.length){if(1===e)return r.abs().sum(n);if(e===1/0)return r.abs().max(n);if(e===-1/0)return r.abs().min(n);if("euclidean"===e||2===e)return r.abs().pow(t.scalar(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(n instanceof Array&&2===n.length){if(1===e)return r.abs().sum(n[0]).max(n[1]-1);if(e===1/0)return r.abs().sum(n[1]).max(n[0]);if(e===-1/0)return r.abs().sum(n[1]).min(n[0]);if("fro"===e||"euclidean"===e)return r.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+n)}exports.NormOps=a;
},{"../doc":44,"./axis_util":72,"./operation":75,"./ops":40}],60:[function(require,module,exports) {
"use strict";var n=this&&this.__decorate||function(n,r,a,o){var e,t=arguments.length,s=t<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(n,r,a,o);else for(var u=n.length-1;u>=0;u--)(e=n[u])&&(s=(t<3?e(s):t>3?e(r,a,s):e(r,a))||s);return t>3&&s&&Object.defineProperty(r,a,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),a=require("../environment"),o=require("../util"),e=require("./conv_util"),t=require("./operation"),s=function(){function s(){}return s.maxPool=function(n,r,t,u,p){var i=n,l=!1;3===n.rank&&(l=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),o.assert(4===i.rank,"Error in maxPool: input must be rank 4 but got rank "+i.rank+"."),null!=p&&o.assert(o.isInt(u),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+p+" but got pad "+u+".");var k=e.computePool2DInfo(i.shape,r,t,u,p),h=a.ENV.engine.runKernel(function(n){return n.maxPool(i,k)},{x:i},function(n){return{x:function(){return s.maxPoolBackprop(n,i,r,t,u)}}});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h},s.maxPoolBackprop=function(n,r,t,s,u,p){o.assert(r.rank===n.rank,"Rank of input ("+r.rank+") does not match rank of dy ("+n.rank+")");var i=r,l=n,k=!1;3===r.rank&&(k=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]),l=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),o.assert(4===l.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."),o.assert(4===i.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+i.rank+"."),null!=p&&o.assert(o.isInt(u),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+p+" but got pad "+u+".");var h=e.computePool2DInfo(i.shape,t,s,u,p),c=a.ENV.engine.runKernel(function(n){return n.maxPoolBackprop(l,i,h)},{dy4D:l,input4D:i});return k?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c},s.minPool=function(n,r,t,s,u){var p=n,i=!1;3===n.rank&&(i=!0,p=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),o.assert(4===p.rank,"Error in minPool: x must be rank 4 but got rank "+p.rank+"."),null!=u&&o.assert(o.isInt(s),"Error in minPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+".");var l=e.computePool2DInfo(p.shape,r,t,s,u),k=a.ENV.engine.runKernel(function(n){return n.minPool(p,l)},{input4D:p});return i?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k},s.avgPool=function(n,r,t,u,p){var i=n,l=!1;3===n.rank&&(l=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),o.assert(4===i.rank,"Error in avgPool: x must be rank 4 but got rank "+i.rank+"."),null!=p&&o.assert(o.isInt(u),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+p+" but got pad "+u+".");var k=e.computePool2DInfo(i.shape,r,t,u),h=a.ENV.engine.runKernel(function(n){return n.avgPool(i,k)},{x:i},function(n){return{x:function(){return s.avgPoolBackprop(n,i,r,t,u)}}});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h},s.avgPoolBackprop=function(n,r,t,s,u){o.assert(r.rank===n.rank,"Rank of input ("+r.rank+") does not match rank of dy ("+n.rank+")");var p=r,i=n,l=!1;3===r.rank&&(l=!0,p=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]),i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),o.assert(4===i.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+i.rank+"."),o.assert(4===p.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+p.rank+".");var k=e.computePool2DInfo(p.shape,t,s,u),h=a.ENV.engine.runKernel(function(n){return n.avgPoolBackprop(i,p,k)},{dy4D:i,input4D:p});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h},n([r.doc({heading:"Operations",subheading:"Convolution"}),t.operation],s,"maxPool",null),n([t.operation],s,"maxPoolBackprop",null),n([r.doc({heading:"Operations",subheading:"Convolution"}),t.operation],s,"minPool",null),n([r.doc({heading:"Operations",subheading:"Convolution"}),t.operation],s,"avgPool",null),n([t.operation],s,"avgPoolBackprop",null),s}();exports.PoolOps=s;
},{"../doc":44,"../environment":10,"../util":12,"./conv_util":21,"./operation":75}],61:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,n,r,a){var t,o=arguments.length,i=o<3?n:null===a?a=Object.getOwnPropertyDescriptor(n,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,n,r,a);else for(var u=e.length-1;u>=0;u--)(t=e[u])&&(i=(o<3?t(i):o>3?t(n,r,i):t(n,r))||i);return o>3&&i&&Object.defineProperty(n,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../doc"),r=require("../environment"),a=require("../globals"),t=require("../tensor"),o=require("../util"),i=require("./axis_util"),u=require("./operation"),s=require("./ops"),p=function(){function p(){}return p.logSumExp=function(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=i.parseAxisParam(n,e.shape),t=e.max(a,!0),o=e.sub(t).exp().sum(a).log(),u=t.reshape(o.shape).add(o);if(r){var s=i.expandShapeToKeepDim(u.shape,a);return u.reshape(s)}return u},p.sum=function(e,n,o){void 0===n&&(n=null),void 0===o&&(o=!1);var u=i.parseAxisParam(n,e.shape);return a.customGrad(function(e){var n=i.getAxesPermutation(u,e.rank),a=u,s=e;null!=n&&(s=e.transpose(n),a=i.getInnerMostAxes(a.length,e.rank));var p=r.ENV.engine.runKernel(function(e){return e.sum(s,a)},{permutedX:s});if(o){var l=i.expandShapeToKeepDim(p.shape,u);p=p.reshape(l)}return{value:p,gradFunc:function(n){var r=e.shape.slice();return u.forEach(function(e){r[e]=1}),n.reshape(r).mul(t.Tensor.ones(e.shape,"float32"))}}})(e)},p.mean=function(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var u=i.parseAxisParam(n,e.shape),p=i.computeOutAndReduceShapes(e.shape,u)[1],l=o.sizeFromShape(p);return a.customGrad(function(e){var a=s.scalar(l);return{value:e.div(a).sum(n,r),gradFunc:function(n){var r=e.shape.slice();return u.forEach(function(e){r[e]=1}),n.reshape(r).mul(t.Tensor.ones(e.shape,"float32")).div(a)}}})(e)},p.min=function(e,n,a){void 0===n&&(n=null),void 0===a&&(a=!1);var t=i.parseAxisParam(n,e.shape),o=t,u=i.getAxesPermutation(o,e.rank);null!=u&&(e=e.transpose(u),o=i.getInnerMostAxes(o.length,e.rank));var s=r.ENV.engine.runKernel(function(n){return n.min(e,o)},{x:e});if(a){var p=i.expandShapeToKeepDim(s.shape,t);return s.reshape(p)}return s},p.max=function(e,n,a){void 0===n&&(n=null),void 0===a&&(a=!1);var t=i.parseAxisParam(n,e.shape),o=t,u=i.getAxesPermutation(o,e.rank);null!=u&&(e=e.transpose(u),o=i.getInnerMostAxes(o.length,e.rank));var s=r.ENV.engine.runKernel(function(n){return n.max(e,o)},{x:e});if(a){var p=i.expandShapeToKeepDim(s.shape,t);return s.reshape(p)}return s},p.argMin=function(e,n){void 0===n&&(n=null);var a=i.parseAxisParam(n,e.shape),t=i.getAxesPermutation(a,e.rank);return null!=t&&(e=e.transpose(t),a=i.getInnerMostAxes(a.length,e.rank)),r.ENV.engine.runKernel(function(n){return n.argMin(e,a)},{x:e})},p.argMax=function(e,n){void 0===n&&(n=null);var a=i.parseAxisParam(n,e.shape),t=i.getAxesPermutation(a,e.rank);return null!=t&&(e=e.transpose(t),a=i.getInnerMostAxes(a.length,e.rank)),r.ENV.engine.runKernel(function(n){return n.argMax(e,a)},{x:e})},p.moments=function(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=i.parseAxisParam(n,e.shape),t=e.mean(a,r),o=t.shape;return r||(o=i.expandShapeToKeepDim(t.shape,a)),{mean:t,variance:e.toFloat().sub(t.reshape(o)).square().mean(a,r)}},e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"logSumExp",null),e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"sum",null),e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"mean",null),e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"min",null),e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"max",null),e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"argMin",null),e([n.doc({heading:"Operations",subheading:"Reduction"}),u.operation],p,"argMax",null),e([n.doc({heading:"Operations",subheading:"Normalization"}),u.operation],p,"moments",null),p}();exports.ReductionOps=p;
},{"../doc":44,"../environment":10,"../globals":19,"../tensor":15,"../util":12,"./axis_util":72,"./operation":75,"./ops":40}],62:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,n,t){var s,u=arguments.length,o=u<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,r,n,t);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(o=(u<3?s(o):u>3?s(r,n,o):s(r,n))||o);return u>3&&o&&Object.defineProperty(r,n,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),n=require("../environment"),t=require("../util"),s=require("./axis_util"),u=require("./operation"),o=function(){function o(){}return o.reverse1d=function(e){return t.assert(1===e.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+e.rank+"."),o.reverse(e,0)},o.reverse2d=function(e,r){return t.assert(2===e.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+e.rank+"."),o.reverse(e,r)},o.reverse3d=function(e,r){return t.assert(3===e.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+e.rank+"."),o.reverse(e,r)},o.reverse4d=function(e,r){return t.assert(4===e.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+e.rank+"."),o.reverse(e,r)},o.reverse=function(e,r){if(0===e.rank)return e.clone();var t=s.parseAxisParam(r,e.shape);return n.ENV.engine.runKernel(function(r){return r.reverse(e,t)},{x:e},function(e){return{x:function(){return e.reverse(t)}}}).reshapeAs(e)},e([r.doc({heading:"Tensors",subheading:"Slicing and Joining"}),u.operation],o,"reverse",null),o}();exports.ReverseOps=o;
},{"../doc":44,"../environment":10,"../util":12,"./axis_util":72,"./operation":75}],111:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../util");function e(e,a,t){r.assert(e.rank===a.length,"Error in slice"+e.rank+"D: Length of begin "+a+" must match the rank of the array ("+e.rank+")."),r.assert(e.rank===t.length,"Error in slice"+e.rank+"D: Length of size "+t+" must match the rank of the array ("+e.rank+").");for(var s=0;s<e.rank;++s)r.assert(a[s]+t[s]<=e.shape[s],"Error in slice"+e.rank+"D: begin["+s+"] + size["+s+"] ("+(a[s]+t[s])+") would overflow input.shape["+s+"] ("+e.shape[s]+")")}exports.assertParamsValid=e;
},{"../util":12}],63:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,n,t){var i,s=arguments.length,a=s<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,r,n,t);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(r,n,a):i(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),n=require("../environment"),t=require("../util"),i=require("./operation"),s=require("./slice_util"),a=function(){function a(){}return a.slice1d=function(e,r,n){return t.assert(1===e.rank,"slice1d expects a rank-1 tensor, but got a rank-"+e.rank+" tensor"),a.slice(e,[r],[n])},a.slice2d=function(e,r,n){return t.assert(2===e.rank,"slice1d expects a rank-2 tensor, but got a rank-"+e.rank+" tensor"),a.slice(e,r,n)},a.slice3d=function(e,r,n){return t.assert(3===e.rank,"slice1d expects a rank-3 tensor, but got a rank-"+e.rank+" tensor"),a.slice(e,r,n)},a.slice4d=function(e,r,n){return t.assert(4===e.rank,"slice1d expects a rank-4 tensor, but got a rank-"+e.rank+" tensor"),a.slice(e,r,n)},a.slice=function(e,r,t){if(s.assertParamsValid(e,r,t),0===e.rank)throw new Error("Slicing scalar is not possible");var i=e.shape;return n.ENV.engine.runKernel(function(n){return n.slice(e,r,t)},{x:e},function(e){for(var n=[],s=0;s<e.rank;s++)n.push([r[s],i[s]-r[s]-t[s]]);return{x:function(){return e.pad(n)}}})},e([r.doc({heading:"Tensors",subheading:"Slicing and Joining"}),i.operation],a,"slice",null),a}();exports.SliceOps=a;
},{"../doc":44,"../environment":10,"../util":12,"./operation":75,"./slice_util":111}],64:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,o,t){var a,n=arguments.length,s=n<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,o):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,o,t);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(n<3?a(s):n>3?a(r,o,s):a(r,o))||s);return n>3&&s&&Object.defineProperty(r,o,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),o=require("../globals"),t=require("../util"),a=require("./axis_util"),n=require("./operation"),s=require("./ops"),i=function(){function i(){}return i.softmax=function(e,r){if(void 0===r&&(r=-1),-1===r&&(r=e.rank-1),r!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+r);return o.customGrad(function(e){var o=e.logSumExp([r],!0),t=e.toFloat().sub(o).exp();return{value:t,gradFunc:function(e){var o=e.mul(t);return o.sub(o.sum([r],!0).mul(t))}}})(e)},i.softmaxCrossEntropy=function(e,r,n){if(void 0===n&&(n=-1),t.assertShapesMatch(e.shape,r.shape,"Error in softmaxCrossEntropy: "),-1===n&&(n=r.rank-1),n!==r.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+r.rank+" and dim was "+n);return o.customGrad(function(e,r){var o=r.softmax(n);return{value:s.scalar(1e-5).add(o).log().mul(e).neg().sum([n]),gradFunc:function(r){var t=a.expandShapeToKeepDim(r.shape,[n]);return[r.reshape(t).mul(e.toFloat().sub(o)),r.reshape(t).mul(o.sub(e.toFloat()))]}}})(e,r)},e([r.doc({heading:"Operations",subheading:"Normalization"}),n.operation],i,"softmax",null),e([r.doc({heading:"Training",subheading:"Losses",namespace:"losses"}),n.operation],i,"softmaxCrossEntropy",null),i}();exports.SoftmaxOps=i;
},{"../doc":44,"../globals":19,"../util":12,"./axis_util":72,"./operation":75,"./ops":40}],65:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,n){var o,i=arguments.length,u=i<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,r,t,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(u=(i<3?o(u):i>3?o(r,t,u):o(r,t))||u);return i>3&&u&&Object.defineProperty(r,t,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../doc"),t=require("../environment"),n=require("../util"),o=require("./axis_util"),i=require("./operation"),u=function(){function u(){}return u.transpose=function(e,r){null==r&&(r=e.shape.map(function(e,r){return r}).reverse());return n.assert(e.rank===r.length,"Error in transpose: rank of input "+e.rank+" must match length of perm "+r+"."),t.ENV.engine.runKernel(function(t){return t.transpose(e,r)},{x:e},function(e){var t=o.getUndoAxesPermutation(r);return{x:function(){return e.transpose(t)}}})},e([r.doc({heading:"Operations",subheading:"Matrices"}),i.operation],u,"transpose",null),u}();exports.TransposeOps=u;
},{"../doc":44,"../environment":10,"../util":12,"./axis_util":72,"./operation":75}],74:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SELU_SCALEALPHA=1.7580993408473768,exports.SELU_SCALE=1.0507009873554805;
},{}],66:[function(require,module,exports) {
"use strict";var n=this&&this.__decorate||function(n,e,r,t){var u,i=arguments.length,o=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(n,e,r,t);else for(var a=n.length-1;a>=0;a--)(u=n[a])&&(o=(i<3?u(o):i>3?u(e,r,o):u(e,r))||o);return i>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../doc"),r=require("../environment"),t=require("../util"),u=require("./operation"),i=require("./ops"),o=require("./ops"),a=require("./selu_util"),c=function(){function c(){}return c.neg=function(n){return r.ENV.engine.runKernel(function(e){return e.neg(n)},{x:n},function(n){return{x:function(){return n.neg()}}})},c.ceil=function(n){return r.ENV.engine.runKernel(function(e){return e.ceil(n)},{x:n},function(n){return{x:function(){return i.zerosLike(n)}}})},c.floor=function(n){return r.ENV.engine.runKernel(function(e){return e.floor(n)},{x:n},function(n){return{x:function(){return i.zerosLike(n)}}})},c.exp=function(n){return r.ENV.engine.runKernel(function(e,r){return r(e.exp(n))},{x:n},function(n,e){var r=e[0];return{x:function(){return n.mulStrict(r)}}})},c.log=function(n){return r.ENV.engine.runKernel(function(e){return e.log(n)},{x:n},function(e){return{x:function(){return e.divStrict(n.toFloat())}}})},c.sqrt=function(n){return r.ENV.engine.runKernel(function(e){return e.sqrt(n)},{x:n},function(e){return{x:function(){return e.divStrict(n.toFloat().sqrt().mul(i.scalar(2)))}}})},c.square=function(n){return r.ENV.engine.runKernel(function(e){return e.square(n)},{x:n},function(e){return{x:function(){return e.mulStrict(n.toFloat().mul(i.scalar(2)))}}})},c.abs=function(n){return r.ENV.engine.runKernel(function(e){return e.abs(n)},{x:n},function(e){return{x:function(){return e.mulStrict(n.toFloat().step(-1))}}})},c.clipByValue=function(n,e,u){t.assert(e<=u,"Error in clip: min ("+e+") must beless than or equal to max ("+u+").");return r.ENV.engine.runKernel(function(r){return r.clip(n,e,u)},{x:n},function(r){return{x:function(){return r.where(n.greater(i.scalar(e)).logicalAnd(n.less(i.scalar(u))),o.zerosLike(r))}}})},c.relu=function(n){return r.ENV.engine.runKernel(function(e){return e.relu(n)},{x:n},function(e){var r=n.step();return{x:function(){return e.mulStrict(r.toFloat())}}})},c.elu=function(n){return r.ENV.engine.runKernel(function(e){return e.elu(n)},{x:n},function(e){return{x:function(){return e.mulStrict(s(n))}}})},c.selu=function(n){return r.ENV.engine.runKernel(function(e){return e.selu(n)},{x:n},function(e){return{x:function(){var r=n.greater(i.scalar(0)),t=i.scalar(a.SELU_SCALEALPHA),u=i.scalar(a.SELU_SCALE),o=e.mul(u),c=e.mul(t).mul(n.toFloat().exp());return i.where(r,o,c)}}})},c.leakyRelu=function(n,e){void 0===e&&(e=.2);return r.ENV.engine.runKernel(function(r){return r.leakyRelu(n,e)},{x:n},function(r){return{x:function(){return r.mulStrict(n.step(e))}}})},c.prelu=function(n,e){return r.ENV.engine.runKernel(function(r){return r.prelu(n,e)},{x:n},function(r){return{x:function(){return r.mulStrict(l(n,e))}}})},c.sigmoid=function(n){return r.ENV.engine.runKernel(function(e,r){return r(e.sigmoid(n))},{x:n},function(n,e){var r=e[0];return{x:function(){return n.mulStrict(r.mul(i.scalar(1).sub(r)))}}})},c.sin=function(n){return r.ENV.engine.runKernel(function(e){return e.sin(n)},{x:n},function(e){return{x:function(){return n.toFloat().cos().mulStrict(e)}}})},c.cos=function(n){return r.ENV.engine.runKernel(function(e){return e.cos(n)},{x:n},function(e){return{x:function(){return n.toFloat().sin().neg().mulStrict(e)}}})},c.tan=function(n){return r.ENV.engine.runKernel(function(e){return e.tan(n)},{x:n},function(e){return{x:function(){return e.divStrict(n.cos().square())}}})},c.asin=function(n){return r.ENV.engine.runKernel(function(e){return e.asin(n)},{x:n},function(e){return{x:function(){return e.divStrict(c.sqrt(i.scalar(1).sub(n.toFloat().square())))}}})},c.acos=function(n){return r.ENV.engine.runKernel(function(e){return e.acos(n)},{x:n},function(e){return{x:function(){return e.divStrict(c.sqrt(i.scalar(1).sub(n.toFloat().square()))).neg()}}})},c.atan=function(n){return r.ENV.engine.runKernel(function(e){return e.atan(n)},{x:n},function(e){return{x:function(){return e.divStrict(i.scalar(1).add(n.toFloat().square()))}}})},c.sinh=function(n){return r.ENV.engine.runKernel(function(e){return e.sinh(n)},{x:n},function(e){return{x:function(){return n.toFloat().cosh().mulStrict(e)}}})},c.cosh=function(n){return r.ENV.engine.runKernel(function(e){return e.cosh(n)},{x:n},function(e){return{x:function(){return n.toFloat().sinh().mulStrict(e)}}})},c.tanh=function(n){return r.ENV.engine.runKernel(function(e,r){return r(e.tanh(n))},{x:n},function(n,e){var r=e[0];return{x:function(){return i.scalar(1).sub(r.square()).mulStrict(n)}}})},c.step=function(n,e){void 0===e&&(e=0);return r.ENV.engine.runKernel(function(r){return r.step(n,e)},{x:n},function(n){return{x:function(){return i.zerosLike(n)}}})},n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"neg",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"ceil",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"floor",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"exp",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"log",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"sqrt",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"square",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"abs",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"clipByValue",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"relu",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"elu",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"selu",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"leakyRelu",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"prelu",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"sigmoid",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"sin",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"cos",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"tan",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"asin",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"acos",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"atan",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"sinh",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"cosh",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"tanh",null),n([e.doc({heading:"Operations",subheading:"Basic math"}),u.operation],c,"step",null),c}();function l(n,e){return r.ENV.engine.runKernel(function(r){return r.preluDer(n,e)},{x:n,alpha:e})}function s(n){return r.ENV.engine.runKernel(function(e){return e.eluDer(n)},{x:n})}exports.UnaryOps=c;
},{"../doc":44,"../environment":10,"../util":12,"./operation":75,"./ops":40,"./selu_util":74}],40:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./array_ops"),s=require("./batchnorm"),e=require("./binary_ops"),o=require("./compare"),p=require("./concat"),t=require("./conv"),a=require("./image_ops"),i=require("./logical_ops"),n=require("./lrn"),x=require("./lstm"),l=require("./matmul"),c=require("./norm"),O=require("./pool"),m=require("./reduction_ops"),d=require("./reverse"),u=require("./slice"),y=require("./softmax"),g=require("./transpose"),q=require("./unary_ops");exports.batchNormalization=s.BatchNormOps.batchNormalization,exports.batchNormalization2d=s.BatchNormOps.batchNormalization2d,exports.batchNormalization3d=s.BatchNormOps.batchNormalization3d,exports.batchNormalization4d=s.BatchNormOps.batchNormalization4d,exports.concat=p.ConcatOps.concat,exports.concat1d=p.ConcatOps.concat1d,exports.concat2d=p.ConcatOps.concat2d,exports.concat3d=p.ConcatOps.concat3d,exports.concat4d=p.ConcatOps.concat4d,exports.conv1d=t.ConvOps.conv1d,exports.conv2d=t.ConvOps.conv2d,exports.conv2dTranspose=t.ConvOps.conv2dTranspose,exports.depthwiseConv2d=t.ConvOps.depthwiseConv2d,exports.matMul=l.MatmulOps.matMul,exports.matrixTimesVector=l.MatmulOps.matrixTimesVector,exports.outerProduct=l.MatmulOps.outerProduct,exports.vectorTimesMatrix=l.MatmulOps.vectorTimesMatrix,exports.avgPool=O.PoolOps.avgPool,exports.maxPool=O.PoolOps.maxPool,exports.minPool=O.PoolOps.minPool,exports.transpose=g.TransposeOps.transpose,exports.reverse=d.ReverseOps.reverse,exports.reverse1d=d.ReverseOps.reverse1d,exports.reverse2d=d.ReverseOps.reverse2d,exports.reverse3d=d.ReverseOps.reverse3d,exports.reverse4d=d.ReverseOps.reverse4d,exports.slice=u.SliceOps.slice,exports.slice1d=u.SliceOps.slice1d,exports.slice2d=u.SliceOps.slice2d,exports.slice3d=u.SliceOps.slice3d,exports.slice4d=u.SliceOps.slice4d,exports.argMax=m.ReductionOps.argMax,exports.argMin=m.ReductionOps.argMin,exports.logSumExp=m.ReductionOps.logSumExp,exports.max=m.ReductionOps.max,exports.mean=m.ReductionOps.mean,exports.min=m.ReductionOps.min,exports.moments=m.ReductionOps.moments,exports.sum=m.ReductionOps.sum,exports.equal=o.CompareOps.equal,exports.equalStrict=o.CompareOps.equalStrict,exports.greater=o.CompareOps.greater,exports.greaterStrict=o.CompareOps.greaterStrict,exports.greaterEqual=o.CompareOps.greaterEqual,exports.greaterEqualStrict=o.CompareOps.greaterEqualStrict,exports.less=o.CompareOps.less,exports.lessStrict=o.CompareOps.lessStrict,exports.lessEqual=o.CompareOps.lessEqual,exports.lessEqualStrict=o.CompareOps.lessEqualStrict,exports.notEqual=o.CompareOps.notEqual,exports.notEqualStrict=o.CompareOps.notEqualStrict,exports.logicalNot=i.LogicalOps.logicalNot,exports.logicalAnd=i.LogicalOps.logicalAnd,exports.logicalOr=i.LogicalOps.logicalOr,exports.logicalXor=i.LogicalOps.logicalXor,exports.where=i.LogicalOps.where,exports.abs=q.UnaryOps.abs,exports.acos=q.UnaryOps.acos,exports.asin=q.UnaryOps.asin,exports.atan=q.UnaryOps.atan,exports.ceil=q.UnaryOps.ceil,exports.clipByValue=q.UnaryOps.clipByValue,exports.cos=q.UnaryOps.cos,exports.cosh=q.UnaryOps.cosh,exports.elu=q.UnaryOps.elu,exports.exp=q.UnaryOps.exp,exports.floor=q.UnaryOps.floor,exports.leakyRelu=q.UnaryOps.leakyRelu,exports.log=q.UnaryOps.log,exports.neg=q.UnaryOps.neg,exports.prelu=q.UnaryOps.prelu,exports.relu=q.UnaryOps.relu,exports.selu=q.UnaryOps.selu,exports.sigmoid=q.UnaryOps.sigmoid,exports.sin=q.UnaryOps.sin,exports.sinh=q.UnaryOps.sinh,exports.sqrt=q.UnaryOps.sqrt,exports.square=q.UnaryOps.square,exports.step=q.UnaryOps.step,exports.tan=q.UnaryOps.tan,exports.tanh=q.UnaryOps.tanh,exports.add=e.BinaryOps.add,exports.addStrict=e.BinaryOps.addStrict,exports.div=e.BinaryOps.div,exports.divStrict=e.BinaryOps.divStrict,exports.maximum=e.BinaryOps.maximum,exports.maximumStrict=e.BinaryOps.maximumStrict,exports.minimum=e.BinaryOps.minimum,exports.minimumStrict=e.BinaryOps.minimumStrict,exports.mul=e.BinaryOps.mul,exports.mulStrict=e.BinaryOps.mulStrict,exports.pow=e.BinaryOps.pow,exports.powStrict=e.BinaryOps.powStrict,exports.sub=e.BinaryOps.sub,exports.subStrict=e.BinaryOps.subStrict,exports.norm=c.NormOps.norm,exports.cast=r.ArrayOps.cast,exports.clone=r.ArrayOps.clone,exports.fromPixels=r.ArrayOps.fromPixels,exports.ones=r.ArrayOps.ones,exports.onesLike=r.ArrayOps.onesLike,exports.zeros=r.ArrayOps.zeros,exports.zerosLike=r.ArrayOps.zerosLike,exports.rand=r.ArrayOps.rand,exports.randomNormal=r.ArrayOps.randomNormal,exports.truncatedNormal=r.ArrayOps.truncatedNormal,exports.randomUniform=r.ArrayOps.randomUniform,exports.reshape=r.ArrayOps.reshape,exports.squeeze=r.ArrayOps.squeeze,exports.tile=r.ArrayOps.tile,exports.gather=r.ArrayOps.gather,exports.oneHot=r.ArrayOps.oneHot,exports.linspace=r.ArrayOps.linspace,exports.range=r.ArrayOps.range,exports.buffer=r.ArrayOps.buffer,exports.fill=r.ArrayOps.fill,exports.tensor=r.ArrayOps.tensor,exports.scalar=r.ArrayOps.scalar,exports.tensor1d=r.ArrayOps.tensor1d,exports.tensor2d=r.ArrayOps.tensor2d,exports.tensor3d=r.ArrayOps.tensor3d,exports.tensor4d=r.ArrayOps.tensor4d,exports.print=r.ArrayOps.print,exports.expandDims=r.ArrayOps.expandDims,exports.stack=r.ArrayOps.stack,exports.pad=r.ArrayOps.pad,exports.pad1d=r.ArrayOps.pad1d,exports.pad2d=r.ArrayOps.pad2d,exports.pad3d=r.ArrayOps.pad3d,exports.pad4d=r.ArrayOps.pad4d,exports.basicLSTMCell=x.LSTMOps.basicLSTMCell,exports.multiRNNCell=x.LSTMOps.multiRNNCell,exports.softmax=y.SoftmaxOps.softmax,exports.localResponseNormalization=n.LRNOps.localResponseNormalization;var v=require("../tensor"),S=require("../types");v.Tensor,S.Rank,v.Tensor3D,v.Tensor4D,exports.losses={softmaxCrossEntropy:y.SoftmaxOps.softmaxCrossEntropy},exports.image={resizeBilinear:a.ImageOps.resizeBilinear};
},{"./array_ops":50,"./batchnorm":51,"./binary_ops":52,"./compare":53,"./concat":77,"./conv":54,"./image_ops":55,"./logical_ops":56,"./lrn":57,"./lstm":58,"./matmul":31,"./norm":59,"./pool":60,"./reduction_ops":61,"./reverse":62,"./slice":63,"./softmax":64,"./transpose":65,"./unary_ops":66,"../tensor":15,"../types":16}],108:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./util"),r=function(){function r(e,r){this.backendTimer=e,this.logger=r,null==r&&(this.logger=new t)}return r.prototype.profileKernel=function(r,t){var o,n=this,i=this.backendTimer.time(function(){o=t()}),l=o.dataSync();return e.checkForNaN(l,o.dtype,r),i.then(function(e){n.logger.logKernelProfile(r,o,l,e.kernelMs)}),o},r}();exports.Profiler=r;var t=function(){function r(){}return r.prototype.logKernelProfile=function(r,t,o,n){var i=e.rightPad(n+"ms",9),l=e.rightPad(r,25),c=t.rank,u=t.size,g=e.rightPad(t.shape.toString(),14);console.log("%c"+l+"\t%c"+i+"\t%c"+c+"D "+g+"\t%c"+u,"font-weight:bold","color:red","color:blue","color: orange")},r}();exports.Logger=t;
},{"./util":12}],109:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./util");function t(r,t,e){for(var i={},a={},n=0;n<t.length;n++)i[t[n].id]=!0;for(n=0;n<r.length;n++){var o=(g=r[n]).inputs;for(var u in o){for(var d=o[u],p=!1,s=0;s<t.length;s++)if(i[d.id]){i[g.output.id]=!0,p=!0,a[g.id]=!0;break}if(p)break}}var f={};f[e.id]=!0;var h={};for(n=r.length-1;n>=0;n--){o=(g=r[n]).inputs;var v=[];v.push(g.output);for(s=0;s<v.length;s++)if(f[v[s].id]){for(var u in o)f[o[u].id]=!0,h[g.id]=!0;break}}var l=[];for(n=0;n<r.length;n++){var g;if(a[(g=r[n]).id]&&h[g.id]){var c={};for(var u in g.inputs){var b=g.inputs[u];i[b.id]&&(c[u]=b)}var w=Object.assign({},g);w.inputs=c,w.output=g.output,l.push(w)}}return l}function e(t,e){for(var i=e.length-1;i>=0;i--){var a=e[i],n=t[a.output.id];if(null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.name+".");var o=a.gradient(n);for(var u in a.inputs){if(!(u in o))throw new Error("Cannot backprop through input "+u+". Available gradients found: "+Object.keys(o)+".");var d=o[u](),p=a.inputs[u];if(!r.arraysEqual(d.shape,p.shape))throw new Error("Error in gradient for op "+a.name+". The gradient of input '"+u+"' has shape '"+d.shape+"', which does not match the shape of the input '"+p.shape+"'");if(null==t[p.id])t[p.id]=d;else{var s=t[p.id];t[p.id]=s.add(d),s.dispose()}}}}exports.getFilteredNodesXToY=t,exports.backpropagateGradients=e;
},{"./util":12}],46:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(i,a)}u((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[0,s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./environment"),r=require("./globals"),s=require("./ops/ops"),o=require("./profiler"),i=require("./tape"),a=require("./tensor"),u=require("./util"),c=function(){function c(e,t,n){this.backend=e,this.customBackend=t,this.safeMode=n,this.registeredVariables={},this.refCounter=new WeakMap,this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.gradientScopeCount=0,this.customGradientDepth=0,this.activeScope={keep:[],track:[]},this.scopeStack=[this.activeScope],this.profiler=new o.Profiler(e)}return c.prototype.runKernel=function(e,t,r){var s,o=this,i=[],a=function(e){return i.push(e),e},u=this.activeScope.name;if(s=n.ENV.get("DEBUG")?this.profiler.profileKernel(u,function(){return e(o.backend,a)}):e(this.backend,a),null!=this.activeTape&&0===this.customGradientDepth){var c={id:this.nextTapeNodeId++,name:u,inputs:t,output:s};null!=r&&(c.gradient=function(e){return r(e,i)}),this.activeTape.push(c)}return s},c.prototype.registerTensor=function(e){var t=this.refCounter.has(e.dataId)?this.refCounter.get(e.dataId):0;this.numTensors++,0===t&&(this.numDataBuffers++,this.numBytes+=u.sizeFromShape(e.shape)*u.bytesPerElement(e.dtype),this.backend.register(e.dataId,e.shape,e.dtype)),this.refCounter.set(e.dataId,t+1),e instanceof a.Variable||this.track(e)},c.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},c.prototype.disposeTensor=function(e){if(this.refCounter.has(e.dataId)){this.numTensors--;var t=this.refCounter.get(e.dataId);t<=1?(this.refCounter.delete(e.dataId),this.backend.disposeData(e.dataId),this.numDataBuffers--,this.numBytes-=u.sizeFromShape(e.shape)*u.bytesPerElement(e.dtype)):this.refCounter.set(e.dataId,t-1)}},c.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,e},c.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},c.prototype.addTapeNode=function(e,t,n){var r={};e.forEach(function(e,t){r[t]=e});var s={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,output:t,gradient:function(e){var t={};return n(e).forEach(function(e,n){t[n]=function(){return e}}),t}};this.activeTape.push(s)},c.prototype.keep=function(e){if(1===this.scopeStack.length&&n.ENV.engine.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside dl.tidy(): dl.tidy(() => {...}) to avoid memory leaks.");return this.activeScope.keep.push(e),e},c.prototype.startScope=function(e,t){void 0===t&&(t=!1),t&&0===this.gradientScopeCount&&(this.activeTape=[]),t&&this.gradientScopeCount++;var n={keep:[],track:[]};e&&(n.name=e),this.scopeStack.push(n),this.activeScope=n},c.prototype.endScope=function(e,t){var n=this;void 0===t&&(t=!1),t&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=this.activeScope.keep,s=u.extractTensorsFromContainer(e);r=r.concat(s);for(var o=0;o<this.activeScope.track.length;o++){var i=this.activeScope.track[o];u.isTensorInList(i,r)||(null!=this.activeTape?s.push(i):i.dispose())}this.scopeStack.pop(),this.activeScope=0===this.scopeStack.length?{keep:[],track:[]}:this.scopeStack[this.scopeStack.length-1],s.forEach(function(e){u.isTensorInList(e,n.activeScope.keep)||n.track(e)})},c.prototype.dispose=function(){this.customBackend&&this.backend.dispose()},c.prototype.gradients=function(e,t,n,o){var c=this;return void 0===o&&(o=!1),u.assert(t.length>0,"gradients() received an empty list of xs."),r.tidy("gradients",function(){var r=e();u.assert(r instanceof a.Tensor,"The result y returned by f() must be a tensor.");var p=i.getFilteredNodesXToY(c.activeTape,t,r);if(!o&&0===p.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var h={};return h[r.id]=null==n?s.ones(r.shape):n,i.backpropagateGradients(h,p),{value:r,grads:t.map(function(e){return h[e.id]})}},!0)},c.prototype.customGrad=function(e){var t=this;return u.assert(u.isFunction(e),"The f passed in customGrad(f) must be a function."),function(){for(var n,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];u.assert(s.every(function(e){return e instanceof a.Tensor}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),t.customGradientDepth++;var i=r.tidy(e.name,function(){var t=e.apply(void 0,s),r=t.value,o=t.gradFunc;return u.assert(r instanceof a.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),u.assert(u.isFunction(o),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n=o,r},!0);if(t.customGradientDepth--,t.shouldRecord()){t.addTapeNode(s,i,function(e){var t=n(e),r=Array.isArray(t)?t:[t];return u.assert(r.length===s.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),u.assert(r.every(function(e){return e instanceof a.Tensor}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),r})}return i}},c.prototype.write=function(e,t){this.backend.write(e,t)},c.prototype.readSync=function(e){return this.backend.readSync(e)},c.prototype.read=function(e){return this.backend.read(e)},c.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},c.prototype.time=function(n){return e(this,void 0,void 0,function(){var e,r;return t(this,function(t){switch(t.label){case 0:return e=performance.now(),[4,this.backend.time(n)];case 1:return(r=t.sent()).wallMs=performance.now()-e,[2,r]}})})},c.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside dl.tidy(): dl.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(e),e},c}();exports.Engine=c;
},{"./environment":10,"./globals":19,"./ops/ops":40,"./profiler":108,"./tape":109,"./tensor":15,"./util":12}],47:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,n,t,r){var i,o=arguments.length,u=o<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,n,t,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(u=(o<3?i(u):o>3?i(n,t,u):i(n,t))||u);return o>3&&u&&Object.defineProperty(n,t,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./doc"),t=require("./environment"),r=require("./util"),i=function(){function i(){}return i.tidy=function(e,n,r){void 0===r&&(r=!1);var i=null;if(null==n){if("function"!=typeof e)throw new Error("Please provide a function to dl.tidy()");n=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to dl.tidy() must be a string");if("function"!=typeof n)throw new Error("When calling with two arguments, the 2nd argument to dl.tidy() must be a function");i=e}t.ENV.engine.startScope(i,r);var o=n();return o instanceof Promise&&console.warn("Returning a promise inside of tidy is dangerous. This will be a run-time error in 0.6.0"),t.ENV.engine.endScope(o,r),o},i.dispose=function(e){r.extractTensorsFromAny(e).forEach(function(e){return e.dispose()})},i.keep=function(e){return t.ENV.engine.keep(e)},i.time=function(e){return t.ENV.engine.time(e)},e([n.doc({heading:"Performance",subheading:"Memory"})],i,"tidy",null),e([n.doc({heading:"Performance",subheading:"Memory"})],i,"keep",null),e([n.doc({heading:"Performance",subheading:"Timing"})],i,"time",null),i}();exports.Tracking=i;
},{"./doc":44,"./environment":10,"./util":12}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./environment"),t=require("./ops/array_ops"),s=require("./ops/batchnorm"),i=require("./ops/binary_ops"),e=require("./ops/compare"),a=require("./ops/conv"),n=require("./ops/image_ops"),o=require("./ops/logical_ops"),p=require("./ops/lrn"),u=require("./ops/lstm"),c=require("./ops/matmul"),l=require("./ops/norm"),h=require("./ops/ops"),m=require("./ops/pool"),d=require("./ops/reduction_ops"),O=require("./ops/reverse"),y=require("./ops/slice"),g=require("./ops/softmax"),v=require("./ops/transpose"),S=require("./ops/unary_ops"),b=require("./tracking"),f=require("./util"),k=b.Tracking.tidy,q=b.Tracking.keep,E=function(){function E(h,f){this.matMul=c.MatmulOps.matMul,this.vectorTimesMatrix=c.MatmulOps.vectorTimesMatrix,this.outerProduct=c.MatmulOps.outerProduct,this.matrixTimesVector=c.MatmulOps.matrixTimesVector,this.dotProduct=c.MatmulOps.dotProduct,this.slice=y.SliceOps.slice,this.slice1D=y.SliceOps.slice1d,this.slice2D=y.SliceOps.slice2d,this.slice3D=y.SliceOps.slice3d,this.slice4D=y.SliceOps.slice4d,this.reverse=O.ReverseOps.reverse,this.reverse1D=O.ReverseOps.reverse1d,this.reverse2D=O.ReverseOps.reverse2d,this.reverse3D=O.ReverseOps.reverse3d,this.reverse4D=O.ReverseOps.reverse4d,this.batchNormalization=s.BatchNormOps.batchNormalization,this.batchNormalization2D=s.BatchNormOps.batchNormalization2d,this.batchNormalization3D=s.BatchNormOps.batchNormalization3d,this.batchNormalization4D=s.BatchNormOps.batchNormalization4d,this.avgPool=m.PoolOps.avgPool,this.maxPool=m.PoolOps.maxPool,this.minPool=m.PoolOps.minPool,this.maxPoolBackprop=m.PoolOps.maxPoolBackprop,this.conv2dTranspose=a.ConvOps.conv2dTranspose,this.depthwiseConv2D=a.ConvOps.depthwiseConv2d,this.conv2dDerFilter=a.ConvOps.conv2dDerFilter,this.conv2dDerInput=a.ConvOps.conv2dDerInput,this.argMax=d.ReductionOps.argMax,this.argMin=d.ReductionOps.argMin,this.logSumExp=d.ReductionOps.logSumExp,this.max=d.ReductionOps.max,this.mean=d.ReductionOps.mean,this.min=d.ReductionOps.min,this.moments=d.ReductionOps.moments,this.sum=d.ReductionOps.sum,this.add=i.BinaryOps.add,this.addStrict=i.BinaryOps.addStrict,this.div=i.BinaryOps.div,this.divide=this.div,this.divStrict=i.BinaryOps.divStrict,this.divideStrict=this.divStrict,this.maximum=i.BinaryOps.maximum,this.maximumStrict=i.BinaryOps.maximumStrict,this.minimum=i.BinaryOps.minimum,this.minimumStrict=i.BinaryOps.minimumStrict,this.mul=i.BinaryOps.mul,this.multiply=this.mul,this.mulStrict=i.BinaryOps.mulStrict,this.multiplyStrict=this.mulStrict,this.pow=i.BinaryOps.pow,this.powStrict=i.BinaryOps.powStrict,this.sub=i.BinaryOps.sub,this.subtract=this.sub,this.subStrict=i.BinaryOps.subStrict,this.logicalNot=o.LogicalOps.logicalNot,this.logicalAnd=o.LogicalOps.logicalAnd,this.logicalOr=o.LogicalOps.logicalOr,this.logicalXor=o.LogicalOps.logicalXor,this.where=o.LogicalOps.where,this.transpose=v.TransposeOps.transpose,this.equal=e.CompareOps.equal,this.equalStrict=e.CompareOps.equalStrict,this.greater=e.CompareOps.greater,this.greaterStrict=e.CompareOps.greaterStrict,this.greaterEqual=e.CompareOps.greaterEqual,this.greaterEqualStrict=e.CompareOps.greaterEqualStrict,this.less=e.CompareOps.less,this.lessStrict=e.CompareOps.lessStrict,this.lessEqual=e.CompareOps.lessEqual,this.lessEqualStrict=e.CompareOps.lessEqualStrict,this.notEqual=e.CompareOps.notEqual,this.notEqualStrict=e.CompareOps.notEqualStrict,this.abs=S.UnaryOps.abs,this.acos=S.UnaryOps.acos,this.asin=S.UnaryOps.asin,this.atan=S.UnaryOps.atan,this.ceil=S.UnaryOps.ceil,this.clip=S.UnaryOps.clipByValue,this.cos=S.UnaryOps.cos,this.cosh=S.UnaryOps.cosh,this.elu=S.UnaryOps.elu,this.exp=S.UnaryOps.exp,this.floor=S.UnaryOps.floor,this.leakyRelu=S.UnaryOps.leakyRelu,this.log=S.UnaryOps.log,this.neg=S.UnaryOps.neg,this.prelu=S.UnaryOps.prelu,this.relu=S.UnaryOps.relu,this.selu=S.UnaryOps.selu,this.sigmoid=S.UnaryOps.sigmoid,this.sin=S.UnaryOps.sin,this.sinh=S.UnaryOps.sinh,this.sqrt=S.UnaryOps.sqrt,this.square=S.UnaryOps.square,this.step=S.UnaryOps.step,this.tan=S.UnaryOps.tan,this.tanh=S.UnaryOps.tanh,this.norm=l.NormOps.norm,this.basicLSTMCell=u.LSTMOps.basicLSTMCell,this.multiRNNCell=u.LSTMOps.multiRNNCell,this.softmax=g.SoftmaxOps.softmax,this.softmaxCrossEntropy=g.SoftmaxOps.softmaxCrossEntropy,this.cast=t.ArrayOps.cast,this.clone=t.ArrayOps.clone,this.gather=t.ArrayOps.gather,this.reshape=t.ArrayOps.reshape,this.tile=t.ArrayOps.tile,this.oneHot=t.ArrayOps.oneHot,this.multinomial=t.ArrayOps.multinomial,this.pad1D=t.ArrayOps.pad1d,this.pad2D=t.ArrayOps.pad2d,this.resizeBilinear3D=n.ImageOps.resizeBilinear,this.localResponseNormalization3D=p.LRNOps.localResponseNormalization,this.localResponseNormalization4D=p.LRNOps.localResponseNormalization,this.keep=b.Tracking.keep,r.ENV.setMath(this,h,f),this.engine=r.ENV.engine,this.dispose=r.ENV.engine.dispose.bind(r.ENV.engine),this.registeredVariables=r.ENV.engine.registeredVariables,this.startScope=r.ENV.engine.startScope.bind(r.ENV.engine),this.endScope=r.ENV.engine.endScope.bind(r.ENV.engine)}return E.prototype.scope=function(r){var t=function(r){return q(r)},s=function(r){return r};return k(function(){return r(t,s)})},E.prototype.track=function(r){return r},E.prototype.topK=function(t,s){var i,e;return f.assert(s<=t.size,"Error in topK: k value ("+s+") must be less than size of input tensor, got shape "+t.shape+"."),k("topK",function(){return i=r.ENV.engine.runKernel(function(r){return r.topKValues(t,s)},{x:t}),e=r.ENV.engine.runKernel(function(r){return r.topKIndices(t,s)},{x:t}),i}),{values:i,indices:e}},E.prototype.elementWiseMul=function(r,t){return r.mulStrict(t)},E.prototype.scalarDividedByArray=function(r,t){return f.assert(1===r.size,"Error in scalarDividedByArray: first argument must be rank 0, but got Tensor of rank "+r.rank+"."),r.div(t)},E.prototype.arrayDividedByScalar=function(r,t){return f.assert(1===t.size,"Error in arrayDividedByScalar: second argument must be rank 0, but got Tensor of rank "+t.rank+"."),r.div(t)},E.prototype.switchDim=function(r,t){return h.transpose(r,t)},E.prototype.scalarPlusArray=function(r,t){return f.assert(1===r.size,"Error in scalarPlusArray: first argument must be rank 0, but got rank "+r.rank+"."),this.add(r,t)},E.prototype.scalarMinusArray=function(r,t){return f.assert(1===r.size,"Error in scalarMinusArray: first argument must be rank 0, but got rank "+r.rank+"."),this.subtract(r,t)},E.prototype.arrayMinusScalar=function(r,t){return f.assert(1===t.size,"Error in arrayMinusScalar: second argument must be rank 0, but got rank "+t.rank+"."),this.subtract(r,t)},E.prototype.scaledArrayAdd=function(r,t,s,i){var e=this;return f.assert(1===r.size,"Error in scaledArrayAdd: first argument must rank 0, but got  rank "+r.rank+"."),f.assert(1===s.size,"Error in scaledArrayAdd: third argument must be rank 0, but got Tensor of rank "+s.rank+"."),f.assertShapesMatch(t.shape,i.shape,"Error in scaledArrayAdd: "),k("scaledArrayAdd",function(){return e.add(e.multiply(r,t),e.multiply(s,i))})},E.prototype.scalarTimesArray=function(r,t){return f.assert(1===r.size,"Error in arrayDividedByScalar: first argument must be rank 0, but got rank "+r.rank+"."),this.multiply(r,t)},E.prototype.concat=function(r,t,s){return h.concat([r,t],s)},E.prototype.concat1D=function(r,t){return h.concat1d([r,t])},E.prototype.concat2D=function(r,t,s){return h.concat2d([r,t],s)},E.prototype.concat3D=function(r,t,s){return h.concat3d([r,t],s)},E.prototype.concat4D=function(r,t,s){return h.concat4d([r,t],s)},E.prototype.conv1d=function(r,t,s,i,e,a){return null!=s&&f.assert(1===s.rank,"Error in conv1d: bias must be rank 1, but got rank "+s.rank+"."),h.conv1d(r,t,i,e,a).add(s)},E.prototype.conv2d=function(r,t,s,i,e,a){return null!=s&&f.assert(1===s.rank,"Error in conv2d: bias must be rank 1, but got rank "+s.rank+"."),h.conv2d(r,t,i,e,a).add(s)},E.prototype.argMaxEquals=function(r,t){return f.assertShapesMatch(r.shape,t.shape,"Error in argMaxEquals: "),r.argMax().equal(t.argMax())},E}();exports.NDArrayMath=E;
},{"./environment":10,"./ops/array_ops":50,"./ops/batchnorm":51,"./ops/binary_ops":52,"./ops/compare":53,"./ops/conv":54,"./ops/image_ops":55,"./ops/logical_ops":56,"./ops/lrn":57,"./ops/lstm":58,"./ops/matmul":31,"./ops/norm":59,"./ops/ops":40,"./ops/pool":60,"./ops/reduction_ops":61,"./ops/reverse":62,"./ops/slice":63,"./ops/softmax":64,"./ops/transpose":65,"./ops/unary_ops":66,"./tracking":47,"./util":12}],10:[function(require,module,exports) {
var global = (1,eval)("this");
var e=(0,eval)("this"),t=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var E=e.length-1;E>=0;E--)(i=e[E])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var n,r=require("./device_util"),i=require("./doc"),o=require("./engine"),a=require("./math"),E=require("./util");function s(e,t){return null!=e.getExtension(t)}function u(e){if(0===e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return 1===e?t.getContext("webgl")||t.getContext("experimental-webgl"):t.getContext("webgl2")}function f(e){if(null!=e){var t=e.getExtension("WEBGL_lose_context");if(null==t)throw new Error("Extension WEBGL_lose_context not supported on this browser.");t.loseContext()}}function c(e){var t=u(e);return null!=t&&(f(t),!0)}function l(e){if(0===e)return 0;var t,n=u(e);return t=s(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:s(n,"EXT_disjoint_timer_query")?1:0,null!=n&&f(n),t}function h(e){if(0===e)return!1;var t=u(e);if(1===e){if(!s(t,"OES_texture_float"))return!1}else if(!s(t,"EXT_color_buffer_float"))return!1;var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);var i=2===e?t.RGBA32F:t.RGBA;t.texImage2D(t.TEXTURE_2D,0,i,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,new Float32Array(4));var a=t.getError()===t.NO_ERROR;return f(t),o&&a}function _(e){if(2!==e)return!1;var t=u(e),n=s(t,"WEBGL_get_buffer_sub_data_async");return f(t),n}!function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"}(n=exports.Type||(exports.Type={})),exports.URL_PROPERTIES=[{name:"DEBUG",type:n.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:n.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:n.BOOLEAN},{name:"WEBGL_VERSION",type:n.NUMBER},{name:"WEBGL_FLOAT_TEXTURE_ENABLED",type:n.BOOLEAN},{name:"WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED",type:n.BOOLEAN},{name:"BACKEND",type:n.STRING}];var d=["webgl","cpu"],p=function(){function e(e){this.features={},this.BACKEND_REGISTRY={},this.backends=this.BACKEND_REGISTRY,null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in exports.ENV.backends))throw new Error("Backend type '"+e+"' not found in registry");exports.ENV.globalMath=new a.NDArrayMath(e,t)},e.getBackend=function(){return exports.ENV.initEngine(),exports.ENV.currentBackendType},e.memory=function(){return exports.ENV.engine.memory()},e.prototype.get=function(e){return e in this.features?this.features[e]:(this.features[e]=this.evaluateFeature(e),this.features[e])},e.prototype.set=function(e,t){this.features[e]=t},e.prototype.getBestBackendType=function(){for(var e=0;e<d.length;++e){var t=d[e];if(t in this.backends)return t}throw new Error("No backend found in registry.")},e.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("BACKEND"===e)return this.getBestBackendType();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var t=this.get("WEBGL_VERSION");return 0===t?0:l(t)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!r.isMobile();if("WEBGL_VERSION"===e)return c(2)?2:c(1)?1:0;if("WEBGL_FLOAT_TEXTURE_ENABLED"===e)return h(this.get("WEBGL_VERSION"));if("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED"===e)return _(this.get("WEBGL_VERSION"));throw new Error("Unknown feature "+e+".")},e.prototype.setFeatures=function(e){this.reset(),this.features=e,this.backends={}},e.prototype.reset=function(){if(this.features=N(),null!=this.globalMath&&(this.globalMath.dispose(),this.globalMath=null,this.globalEngine=null),this.backends!==this.BACKEND_REGISTRY){for(var e in this.backends)this.backends[e].dispose();this.backends=this.BACKEND_REGISTRY}},e.prototype.setMath=function(e,t,n){if(void 0===n&&(n=!1),this.globalMath!==e){var r=!1;"string"==typeof t?(this.currentBackendType=t,t=exports.ENV.findBackend(t)):(r=!0,this.currentBackendType="custom"),this.globalEngine=new o.Engine(t,r,n),this.globalMath=e}},e.prototype.findBackend=function(e){return this.backends[e]},e.prototype.addCustomBackend=function(e,t){if(e in this.backends)throw new Error(e+" backend was already registered");try{var n=t();return this.backends[e]=n,!0}catch(e){return!1}},e.prototype.registerBackend=function(e,t){if(e in this.BACKEND_REGISTRY)throw new Error(e+" backend was already registered as global");try{var n=t();return this.BACKEND_REGISTRY[e]=n,!0}catch(e){return!1}},Object.defineProperty(e.prototype,"math",{get:function(){return this.initEngine(),this.globalMath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initEngine=function(){null==this.globalEngine&&(this.globalMath=new a.NDArrayMath(exports.ENV.get("BACKEND"),!1))},t([i.doc({heading:"Environment"})],e,"setBackend",null),t([i.doc({heading:"Environment"})],e,"getBackend",null),t([i.doc({heading:"Performance",subheading:"Memory"})],e,"memory",null),e}();exports.Environment=p;var g="dljsflags";function N(){var e={};if("undefined"==typeof window)return e;var t=E.getQueryParams(window.location.search);if(g in t){var r={};t[g].split(",").forEach(function(e){var t=e.split(":"),n=t[0],i=t[1];r[n]=i}),exports.URL_PROPERTIES.forEach(function(t){t.name in r&&(console.log("Setting feature override from URL "+t.name+": "+r[t.name]),t.type===n.NUMBER?e[t.name]=+r[t.name]:t.type===n.BOOLEAN?e[t.name]="true"===r[t.name]:t.type===n.STRING?e[t.name]=r[t.name]:console.warn("Unknown URL param: "+t.name+"."))})}return e}function B(){var t;if("undefined"!=typeof window)t=window;else{if(void 0===e)throw new Error("Could not find a global object");t=e}return t}function R(){var e=B();return e.ENV=e.ENV||new p(N()),e.ENV}exports.ENV=R();
},{"./device_util":45,"./doc":44,"./engine":46,"./math":14,"./util":12}],49:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,n,a,r){var s,t=arguments.length,i=t<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,n,a,r);else for(var u=e.length-1;u>=0;u--)(s=e[u])&&(i=(t<3?s(i):t>3?s(n,a,i):s(n,a))||i);return t>3&&i&&Object.defineProperty(n,a,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./doc"),a=require("./environment"),r=require("./globals"),s=require("./tensor"),t=require("./util"),i=function(){function i(){}return i.gradScope=function(e,n){return r.tidy(e,n,!0)},i.grad=function(e){return t.assert(t.isFunction(e),"The f passed in grad(f) must be a function"),function(n,r){t.assert(n instanceof s.Tensor,"The x passed in grad(f)(x) must be a tensor"),t.assert(null==r||r instanceof s.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor");var i=a.ENV.engine.gradients(function(){return e(n)},[n],r),d=i.value,o=i.grads;return null!=r&&t.assertShapesMatch(d.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),d.dispose(),u(o),o[0]}},i.grads=function(e){return t.assert(t.isFunction(e),"The f passed in grads(f) must be a function"),function(n,r){t.assert(Array.isArray(n)&&n.every(function(e){return e instanceof s.Tensor}),"The args passed in grads(f)(args) must be an array of tensors"),t.assert(null==r||r instanceof s.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor");var i=a.ENV.engine.gradients(function(){return e.apply(void 0,n)},n,r),d=i.value,o=i.grads;return null!=r&&t.assertShapesMatch(d.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),d.dispose(),u(o),o}},i.valueAndGrad=function(e){return t.assert(t.isFunction(e),"The f passed in valueAndGrad(f) must be a function"),function(n,r){t.assert(n instanceof s.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),t.assert(null==r||r instanceof s.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var i=a.ENV.engine.gradients(function(){return e(n)},[n],r),d=i.grads,o=i.value;return u(d),{grad:d[0],value:o}}},i.valueAndGrads=function(e){return t.assert(t.isFunction(e),"The f passed in valueAndGrads(f) must be a function"),function(n,r){t.assert(Array.isArray(n)&&n.every(function(e){return e instanceof s.Tensor}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),t.assert(null==r||r instanceof s.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var i=a.ENV.engine.gradients(function(){return e.apply(void 0,n)},n,r);return null!=r&&t.assertShapesMatch(i.value.shape,r.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),u(i.grads),i}},i.variableGrads=function(e,n){if(t.assert(t.isFunction(e),"The f passed in variableGrads(f) must be a function"),t.assert(null==n||Array.isArray(n)&&n.every(function(e){return e instanceof s.Variable}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==n)for(var r in n=[],a.ENV.engine.registeredVariables)n.push(a.ENV.engine.registeredVariables[r]);var i=n.length;n=n.filter(function(e){return e.trainable}),t.assert(n.length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable.");var u=a.ENV.engine.gradients(e,n,null,!0),d=u.value,o=u.grads;t.assert(o.some(function(e){return null!=e}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),t.assert(0===d.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+d.rank+" tensor");var l={};return n.forEach(function(e,n){null!=o[n]&&(l[e.name]=o[n])}),{value:d,grads:l}},i.customGrad=function(e){return a.ENV.engine.customGrad(e)},e([n.doc({heading:"Training",subheading:"Gradients"})],i,"grad",null),e([n.doc({heading:"Training",subheading:"Gradients"})],i,"grads",null),e([n.doc({heading:"Training",subheading:"Gradients"})],i,"valueAndGrad",null),e([n.doc({heading:"Training",subheading:"Gradients"})],i,"valueAndGrads",null),e([n.doc({heading:"Training",subheading:"Gradients"})],i,"variableGrads",null),e([n.doc({heading:"Training",subheading:"Gradients"})],i,"customGrad",null),i}();function u(e){if(e.filter(function(e){return null==e}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}exports.Gradients=i;
},{"./doc":44,"./environment":10,"./globals":19,"./tensor":15,"./util":12}],19:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./gradients"),e=require("./tracking");exports.tidy=e.Tracking.tidy,exports.keep=e.Tracking.keep,exports.dispose=e.Tracking.dispose,exports.time=e.Tracking.time,exports.grad=r.Gradients.grad,exports.valueAndGrad=r.Gradients.valueAndGrad,exports.grads=r.Gradients.grads,exports.valueAndGrads=r.Gradients.valueAndGrads,exports.variableGrads=r.Gradients.variableGrads,exports.customGrad=r.Gradients.customGrad;
},{"./gradients":49,"./tracking":47}],141:[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,o){function i(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(i,u)}c((r=r.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../../globals"),r=require("../../tensor"),a=require("../../util"),o=function(){function n(t,e,n){void 0===n&&(n=!0),this.base=t,this.batchSize=e,this.smallLastBatch=n}return n.prototype.getStream=function(){return t(this,void 0,void 0,function(){return e(this,function(t){return[2,this.base.getStream().batch(this.batchSize,this.smallLastBatch).map(i)]})})},n}();function i(t){var e={},r=t[0],a=Object.keys(r);a.forEach(function(t){e[t]=[]});for(var o=function(t){a.forEach(function(n){var r=t[n];e[n].push(r)})},i=0,c=t;i<c.length;i++){o(c[i])}var s={};return a.forEach(function(n){if(e[n].length!==t.length)throw new Error("Batching failed to get a '"+n+"' value for each element.");"string"==typeof e[n][0]?s[n]=e[n]:s[n]=u(e[n])}),t.forEach(n.dispose),s}function u(t){for(var e=c(t[0])[0],n=[t.length].concat(e),o=new Float32Array(n.reduce(function(t,e){return t*e})),i=0,u=0,s=t;u<s.length;u++){var l=c(s[u]),h=l[0],f=l[1];if(!a.arraysEqual(h,e))throw new Error("Elements must have the same shape to be batched");o.set(f,i),i+=f.length}return r.Tensor.make(n,{values:o})}function c(t){return t instanceof r.Tensor?[t.shape,t.dataSync()]:Array.isArray(t)?[[t.length],t]:[[],[t]]}exports.BatchDataset=o;
},{"../../globals":19,"../../tensor":15,"../../util":12}],142:[function(require,module,exports) {
"use strict";var n=this&&this.__awaiter||function(n,t,e,r){return new(e||(e=Promise))(function(a,i){function o(n){try{c(r.next(n))}catch(n){i(n)}}function u(n){try{c(r.throw(n))}catch(n){i(n)}}function c(n){n.done?a(n.value):new e(function(t){t(n.value)}).then(o,u)}c((r=r.apply(n,t||[])).next())})},t=this&&this.__generator||function(n,t){var e,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(a=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(n,o)}catch(n){i=[6,n],r=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../tensor");function r(n,t){var r=t-n,a=e.Scalar.new(n),i=e.Scalar.new(r);return function(t){if("string"==typeof t)throw new Error("Can't scale a string.");return t instanceof e.Tensor?t.sub(a).div(i):t instanceof Array?t.map(function(t){return(t-n)/r}):(t-n)/r}}function a(r,a,i){return n(this,void 0,void 0,function(){var n,o;return t(this,function(t){switch(t.label){case 0:return n=r,null!=i&&(n=n.shuffle(i)),null!=a&&(n=n.take(a)),o={},[4,n.forEach(function(n){for(var t in n){var r=n[t];if("string"==typeof r);else{var a=void 0,i=void 0;if(r instanceof e.Tensor)a=r.min().dataSync()[0],i=r.max().dataSync()[0];else if(r instanceof Array)a=r.reduce(function(n,t){return Math.min(n,t)}),i=r.reduce(function(n,t){return Math.max(n,t)});else{if(isNaN(r)||!isFinite(r))throw new Error("Cannot compute statistics: "+t+" = "+r);a=r,i=r}var u=o[t];null==u&&(u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},o[t]=u),u.min=Math.min(u.min,a),u.max=Math.max(u.max,i)}}})];case 1:return t.sent(),[2,o]}})})}exports.scaleTo01=r,exports.computeDatasetStatistics=a;
},{"../../tensor":15}],148:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t){if(this.capacity=t,this.begin=0,this.end=0,t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return t.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},t.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},t.prototype.set=function(t,i){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=i},t.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},t.prototype.isFull=function(){return this.length()===this.capacity},t.prototype.isEmpty=function(){return 0===this.length()},t.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},t.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},t.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var i=this.wrap(this.begin+t),e=this.get(i);return this.set(i,this.pop()),e},t}();exports.RingBuffer=t;
},{}],147:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function o(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=require("./ring_buffer"),e=function(i){function e(){return i.call(this,e.INITIAL_CAPACITY)||this}return t(e,i),e.prototype.isFull=function(){return!1},e.prototype.push=function(t){i.prototype.isFull.call(this)&&this.expand(),i.prototype.push.call(this,t)},e.prototype.unshift=function(t){i.prototype.isFull.call(this)&&this.expand(),i.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=2*this.capacity,i=new Array(t),e=this.length(),o=0;o<e;o++)i[o]=this.get(this.wrap(this.begin+o));this.data=i,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=e},e.INITIAL_CAPACITY=32,e}(i.RingBuffer);exports.GrowingRingBuffer=e;
},{"./ring_buffer":148}],143:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),e=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(u,i){function o(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){t.done?u(t.value):new n(function(e){e(t.value)}).then(o,s)}a((r=r.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var n,r,u,i,o={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(u=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(u=u.call(r,i[1])).done)return u;switch(r=0,u&&(i=[0,u.value]),i[0]){case 0:case 1:u=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(u=(u=o.trys).length>0&&u[u.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!u||i[1]>u[0]&&i[1]<u[3])){o.label=i[1];break}if(6===i[0]&&o.label<u[1]){o.label=u[1],u=i;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(i);break}u[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=u=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("seedrandom"),u=require("../../../globals"),i=require("../../../util"),o=require("../util/growing_ring_buffer"),s=require("../util/ring_buffer");function a(t){return new v(t)}function c(t){var e=t;return h(function(){return{value:e++,done:!1}})}function h(t){return new d(t)}function l(t){return _.create(t)}function f(t,e){return l(h(t).take(e))}exports.streamFromItems=a,exports.streamFromIncrementing=c,exports.streamFromFunction=h,exports.streamFromConcatenated=l,exports.streamFromConcatenatedFunction=f;var p=function(){function t(){}return t.prototype.collectRemaining=function(){return e(this,void 0,void 0,function(){var t,e;return n(this,function(n){switch(n.label){case 0:return t=[],[4,this.next()];case 1:e=n.sent(),n.label=2;case 2:return e.done?[3,4]:(t.push(e.value),[4,this.next()]);case 3:return e=n.sent(),[3,2];case 4:return[2,t]}})})},t.prototype.resolveFully=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return t.done?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}})})},t.prototype.filter=function(t){return new w(this,t)},t.prototype.map=function(t){return new g(this,t)},t.prototype.forEach=function(t){return e(this,void 0,void 0,function(){return n(this,function(e){return[2,this.map(t).resolveFully()]})})},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new b(this,t,e)},t.prototype.concatenate=function(t){return _.create(a([this,t]))},t.prototype.take=function(t){return t<0||null==t?this:new y(this,t)},t.prototype.skip=function(t){return t<0||null==t?this:new m(this,t)},t.prototype.prefetch=function(t){return new F(this,t)},t.prototype.shuffle=function(t,e){return new S(this,t,e)},t}();exports.DataStream=p;var v=function(r){function u(t){var e=r.call(this)||this;return e.items=t,e.trav=0,e}return t(u,r),u.prototype.next=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:t,done:!1}])})})},u}(p),d=function(r){function u(t){var e=r.call(this)||this;return e.nextFn=t,e}return t(u,r),u.prototype.next=function(){return e(this,void 0,void 0,function(){return n(this,function(t){return[2,this.nextFn()]})})},u}(p),m=function(r){function i(t,e){var n=r.call(this)||this;return n.upstream=t,n.maxCount=e,n.count=0,n}return t(i,r),i.prototype.next=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(t=e.sent()).done?[2,t]:(u.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},i}(p),y=function(r){function u(t,e){var n=r.call(this)||this;return n.upstream=t,n.maxCount=e,n.count=0,n}return t(u,r),u.prototype.next=function(){return e(this,void 0,void 0,function(){return n(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},u}(p),x=function(r){function u(){var t=r.call(this)||this;return t.outputQueue=new o.GrowingRingBuffer,t}return t(u,r),u.prototype.next=function(){return e(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},u}(p);exports.QueueStream=x;var b=function(r){function u(t,e,n){void 0===n&&(n=!0);var u=r.call(this)||this;return u.upstream=t,u.batchSize=e,u.enableSmallLastBatch=n,u.currentBatch=[],u}return t(u,r),u.prototype.pump=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done?this.enableSmallLastBatch&&this.currentBatch.length>0?(this.outputQueue.push(this.currentBatch),this.currentBatch=[],[2,!0]):[2,!1]:(this.currentBatch.push(t.value),this.currentBatch.length===this.batchSize&&(this.outputQueue.push(this.currentBatch),this.currentBatch=[]),[2,!0])}})})},u}(x),w=function(r){function i(t,e){var n=r.call(this)||this;return n.upstream=t,n.predicate=e,n}return t(i,r),i.prototype.pump=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done?[2,!1]:(this.predicate(t.value)?this.outputQueue.push(t.value):u.dispose(t.value),[2,!0])}})})},i}(x),g=function(r){function u(t,e){var n=r.call(this)||this;return n.upstream=t,n.transform=e,n}return t(u,r),u.prototype.pump=function(){return e(this,void 0,void 0,function(){var t,e,r,u,o,s,a;return n(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:if((t=n.sent()).done)return[2,!1];for(e=i.extractTensorsFromAny(t.value),r=this.transform(t.value),u=i.extractTensorsFromAny(r),o=0,s=e;o<s.length;o++)a=s[o],i.isTensorInList(a,u)||a.dispose();return this.outputQueue.push(r),[2,!0]}})})},u}(x),_=function(r){function u(){var t=null!==r&&r.apply(this,arguments)||this;return t.stream=null,t.lastRead=null,t}return t(u,r),u.create=function(t){var e=new u;return e.moreStreams=t,e},u.prototype.next=function(){return e(this,void 0,void 0,function(){return n(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},u.prototype.readFromChain=function(t){return e(this,void 0,void 0,function(){var e,r;return n(this,function(n){switch(n.label){case 0:return[4,t];case 1:return n.sent(),null!=this.stream?[3,3]:[4,this.moreStreams.next()];case 2:if((e=n.sent()).done)return[2,{value:null,done:!0}];this.stream=e.value,n.label=3;case 3:return[4,this.stream.next()];case 4:return(r=n.sent()).done?(this.stream=null,[2,this.readFromChain(t)]):[2,r]}})})},u}(p);exports.ChainedStream=_;var F=function(e){function n(t,n){var r=e.call(this)||this;return r.upstream=t,r.bufferSize=n,r.total=0,r.buffer=new s.RingBuffer(n),r}return t(n,e),n.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},n.prototype.next=function(){return this.refill(),this.buffer.shift()},n}(p);exports.PrefetchStream=F;var S=function(u){function i(t,e,n){var i=u.call(this,t,e)||this;return i.upstream=t,i.windowSize=e,i.upstreamExhausted=!1,i.random=r(n),i}return t(i,u),i.prototype.randomInt=function(t){return Math.floor(this.random()*t)},i.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},i.prototype.next=function(){return e(this,void 0,void 0,function(){var t,e;return n(this,function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return(e=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,e]);case 3:return[2,{value:null,done:!0}]}})})},i}(F);exports.ShuffleStream=S;
},{"seedrandom":151,"../../../globals":19,"../../../util":12,"../util/growing_ring_buffer":147,"../util/ring_buffer":148}],132:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),e=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function u(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,a)}c((n=n.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("seedrandom"),o=require("../../globals"),i=require("./batch_dataset"),u=require("./statistics"),a=require("./streams/data_stream"),c=require("./streams/data_stream"),s=require("./streams/data_stream"),f=function(){function t(){}return t.prototype.computeStatistics=function(t,n){return e(this,void 0,void 0,function(){return r(this,function(e){return[2,u.computeDatasetStatistics(this,t,n)]})})},t.prototype.filter=function(t){var e=this;return p(function(){return e.getStream().filter(function(e){return o.tidy(function(){return t(e)})})})},t.prototype.map=function(t){var e=this;return p(function(){return e.getStream().map(function(e){return o.tidy(function(){return t(e)})})})},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new i.BatchDataset(this,t,e)},t.prototype.concatenate=function(t){var e=this;return p(function(){return e.getStream().concatenate(t.getStream())})},t.prototype.repeat=function(t){var e=this;return p(function(){var r=a.streamFromFunction(function(){return{value:e.getStream(),done:!1}});return c.streamFromConcatenated(r.take(t))})},t.prototype.take=function(t){var e=this;return p(function(){return e.getStream().take(t)})},t.prototype.skip=function(t){var e=this;return p(function(){return e.getStream().skip(t)})},t.prototype.shuffle=function(t,e,r){void 0===r&&(r=!0);var o=this,i=n(e);return p(function(){var e=i.int32();return r&&(e+=i.int32()),o.getStream().shuffle(t,e.toString())})},t.prototype.prefetch=function(t){var e=this;return p(function(){return e.getStream().prefetch(t)})},t.prototype.collectAll=function(){return e(this,void 0,void 0,function(){return r(this,function(t){return[2,this.getStream().collectRemaining()]})})},t.prototype.forEach=function(t){return e(this,void 0,void 0,function(){return r(this,function(e){return[2,this.getStream().forEach(t)]})})},t}();function p(e){return new(function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return t(n,r),n.prototype.getStream=function(){return e()},n}(f))}function l(t){return p(function(){return s.streamFromItems(t)})}exports.Dataset=f,exports.datasetFromStreamFn=p,exports.datasetFromElements=l;
},{"seedrandom":151,"../../globals":19,"./batch_dataset":141,"./statistics":142,"./streams/data_stream":143}],134:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../dataset"),r=function(e){function r(t,r){void 0===r&&(r="line");var n=e.call(this)||this;return n.input=t,n.columnName=r,n}return t(r,e),r.prototype.getStream=function(){var t=this;return this.input.getStream().decodeUTF8().split("\n").map(function(e){return(r={})[t.columnName]=e,r;var r})},r}(e.Dataset);exports.TextLineDataset=r;
},{"../dataset":132}],133:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),t=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function i(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,i)}u((r=r.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var n,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r,o=require("../dataset"),a=require("./text_line_dataset");!function(e){e[e.READ_FIRST_LINE=0]="READ_FIRST_LINE",e[e.NUMBERED=1]="NUMBERED"}(r=exports.CsvHeaderConfig||(exports.CsvHeaderConfig={}));var s=function(o){function s(e){var t=o.call(this)||this;return t.input=e,t.hasHeaderLine=!1,t.base=new a.TextLineDataset(e,s.textColumnName),t}return e(s,o),Object.defineProperty(s.prototype,"csvColumnNames",{get:function(){return this._csvColumnNames},enumerable:!0,configurable:!0}),s.prototype.setCsvColumnNames=function(e){return t(this,void 0,void 0,function(){var t,o;return n(this,function(n){switch(n.label){case 0:return null!=e&&e!==r.NUMBERED?[3,2]:[4,this.base.getStream().next()];case 1:if((t=n.sent()).done)throw new Error("No data was found for CSV parsing.");return o=t.value[s.textColumnName],this._csvColumnNames=Array.from(o.split(",").keys()).map(function(e){return e.toString()}),[3,5];case 2:return e!==r.READ_FIRST_LINE?[3,4]:[4,this.base.getStream().next()];case 3:if((t=n.sent()).done)throw new Error("No data was found for CSV parsing.");return o=t.value[s.textColumnName],this._csvColumnNames=o.split(","),this.hasHeaderLine=!0,[3,5];case 4:this._csvColumnNames=e,n.label=5;case 5:return[2]}})})},s.create=function(e,o){return void 0===o&&(o=r.NUMBERED),t(this,void 0,void 0,function(){var t;return n(this,function(n){switch(n.label){case 0:return[4,(t=new s(e)).setCsvColumnNames(o)];case 1:return n.sent(),[2,t]}})})},s.prototype.getStream=function(){var e=this,t=this.base.getStream();return this.hasHeaderLine&&(t=t.skip(1)),t.map(function(t){return e.makeDatasetElement(t)})},s.prototype.makeDatasetElement=function(e){for(var t=e[s.textColumnName].split(","),n={},r=0;r<this._csvColumnNames.length;r++){var o=t[r];if(""===o)n[this._csvColumnNames[r]]=void 0;else{var a=Number(o);isNaN(a)?n[this._csvColumnNames[r]]=o:n[this._csvColumnNames[r]]=a}}return n},s.textColumnName="line",s}(o.Dataset);exports.CSVDataset=s;
},{"../dataset":132,"./text_line_dataset":134}],144:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){return function(){}}();exports.DataSource=e;
},{}],160:[function(require,module,exports) {
var global = (1,eval)("this");
var r=(0,eval)("this");!function(e){var t="object"==typeof exports&&exports,n="object"==typeof module&&module&&module.exports==t&&module,o="object"==typeof r&&r;o.global!==o&&o.window!==o||(e=o);var i,f,u,a=String.fromCharCode;function d(r){for(var e,t,n=[],o=0,i=r.length;o<i;)(e=r.charCodeAt(o++))>=55296&&e<=56319&&o<i?56320==(64512&(t=r.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&t)+65536):(n.push(e),o--):n.push(e);return n}function c(r){if(r>=55296&&r<=57343)throw Error("Lone surrogate U+"+r.toString(16).toUpperCase()+" is not a scalar value")}function l(r,e){return a(r>>e&63|128)}function v(r){if(0==(4294967168&r))return a(r);var e="";return 0==(4294965248&r)?e=a(r>>6&31|192):0==(4294901760&r)?(c(r),e=a(r>>12&15|224),e+=l(r,6)):0==(4292870144&r)&&(e=a(r>>18&7|240),e+=l(r,12),e+=l(r,6)),e+=a(63&r|128)}function h(){if(u>=f)throw Error("Invalid byte index");var r=255&i[u];if(u++,128==(192&r))return 63&r;throw Error("Invalid continuation byte")}function s(){var r,e;if(u>f)throw Error("Invalid byte index");if(u==f)return!1;if(r=255&i[u],u++,0==(128&r))return r;if(192==(224&r)){if((e=(31&r)<<6|h())>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&r)){if((e=(15&r)<<12|h()<<6|h())>=2048)return c(e),e;throw Error("Invalid continuation byte")}if(240==(248&r)&&(e=(7&r)<<18|h()<<12|h()<<6|h())>=65536&&e<=1114111)return e;throw Error("Invalid UTF-8 detected")}var p={version:"2.1.2",encode:function(r){for(var e=d(r),t=e.length,n=-1,o="";++n<t;)o+=v(e[n]);return o},decode:function(r){i=d(r),f=i.length,u=0;for(var e,t=[];!1!==(e=s());)t.push(e);return function(r){for(var e,t=r.length,n=-1,o="";++n<t;)(e=r[n])>65535&&(o+=a((e-=65536)>>>10&1023|55296),e=56320|1023&e),o+=a(e);return o}(t)}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return p});else if(t&&!t.nodeType)if(n)n.exports=p;else{var y={}.hasOwnProperty;for(var b in p)y.call(p,b)&&(t[b]=p[b])}else e.utf8=p}(this);
},{}],150:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),r=this&&this.__awaiter||function(t,r,e,n){return new(e||(e=Promise))(function(o,i){function u(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new e(function(r){r(t.value)}).then(u,a)}s((n=n.apply(t,r||[])).next())})},e=this&&this.__generator||function(t,r){var e,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=r.call(t,u)}catch(t){i=[6,t],n=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./data_stream"),o=function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return t(e,r),e.prototype.split=function(t){return new i(this,t)},e}(n.DataStream);exports.StringStream=o;var i=function(n){function o(t,r){var e=n.call(this)||this;return e.impl=new u(t,r),e}return t(o,n),o.prototype.next=function(){return r(this,void 0,void 0,function(){return e(this,function(t){return[2,this.impl.next()]})})},o}(o),u=function(n){function o(t,r){var e=n.call(this)||this;return e.upstream=t,e.separator=r,e.carryover="",e}return t(o,n),o.prototype.pump=function(){return r(this,void 0,void 0,function(){var t,r,n,o,i;return e(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:if((t=e.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((r=t.value.split(this.separator))[0]=this.carryover+r[0],n=0,o=r.slice(0,-1);n<o.length;n++)i=o[n],this.outputQueue.push(i);return this.carryover=r[r.length-1],[2,!0]}})})},o}(n.QueueStream);
},{"./data_stream":143}],149:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),e=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{l(n.next(t))}catch(t){a(t)}}function u(t){try{l(n.throw(t))}catch(t){a(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(o,u)}l((n=n.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[0,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("utf8"),i=require("./data_stream"),a=require("./string_stream"),o=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.decodeUTF8=function(){return new u(this)},r}(i.DataStream);exports.ByteStream=o;var u=function(n){function i(t){var e=n.call(this)||this;return e.impl=new l(t),e}return t(i,n),i.prototype.next=function(){return e(this,void 0,void 0,function(){return r(this,function(t){return[2,this.impl.next()]})})},i}(a.StringStream),l=function(i){function a(t){var e=i.call(this)||this;return e.upstream=t,e.partial=new Uint8Array([]),e.partialBytesValid=0,e}return t(a,i),a.prototype.pump=function(){return e(this,void 0,void 0,function(){var t,e,i,a,o,u,l,c;return r(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:if((t=r.sent()).done){if(0===this.partial.length)return[2,!1];e=new Uint8Array([])}else e=t.value;for(i=this.partial.length-this.partialBytesValid,o=a=i,u=0;a<e.length;)o=a,u=s(e[a]),a=o+u;return a===e.length&&(o=a),l=n.decode(String.fromCharCode.apply(null,e.slice(i,o))),i>0?(this.partial.set(e.slice(0,i),this.partialBytesValid),c=n.decode(String.fromCharCode.apply(null,this.partial)),this.outputQueue.push(c+l)):this.outputQueue.push(l),o===e.length?(this.partial=new Uint8Array([]),this.partialBytesValid=0):(this.partial=new Uint8Array(new ArrayBuffer(u)),this.partial.set(e.slice(o),0),this.partialBytesValid=e.length-o),[2,!0]}})})},a}(i.QueueStream);function s(t){return t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1}
},{"utf8":160,"./data_stream":143,"./string_stream":150}],145:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),t=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function u(e){try{f(n.next(e))}catch(e){i(e)}}function a(e){try{f(n.throw(e))}catch(e){i(e)}}function f(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(u,a)}f((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./byte_stream"),o=function(n){function o(e,t){void 0===t&&(t={});var r=n.call(this)||this;return r.file=e,r.options=t,r.offset=t.offset||0,r.chunkSize=t.chunkSize||1048576,r}return e(o,n),o.prototype.next=function(){return t(this,void 0,void 0,function(){var e,t,n=this;return r(this,function(r){switch(r.label){case 0:return this.offset>=this.file.size?[2,{value:null,done:!0}]:(e=new Promise(function(e,t){var r=new FileReader;r.onload=function(n){var o=r.result;if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),!(o instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(o)},r.onabort=function(e){return t(new Error("Aborted"))},r.onerror=function(e){return t(new Error(e.error))};var o=n.offset+n.chunkSize,i=n.file.slice(n.offset,o);r.readAsArrayBuffer(i),n.offset=o}),t={},[4,e]);case 1:return[2,(t.value=r.sent(),t.done=!1,t)]}})})},o}(n.ByteStream);exports.FileReaderStream=o;
},{"./byte_stream":149}],135:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../datasource"),r=require("../streams/filereader_stream"),o=function(e){function o(t,r){void 0===r&&(r={});var o=e.call(this)||this;return o.input=t,o.options=r,o}return t(o,e),o.prototype.getStream=function(){return new r.FileReaderStream(this.input,this.options)},o}(e.DataSource);exports.FileDataSource=o;
},{"../datasource":144,"../streams/filereader_stream":145}],146:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),e=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function u(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,a)}s((n=n.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./byte_stream"),o=require("./data_stream"),i=require("./filereader_stream"),u=function(n){function o(t,e){void 0===e&&(e={});var r=n.call(this)||this;return r.impl=new a(t,e),r}return t(o,n),o.prototype.next=function(){return e(this,void 0,void 0,function(){return r(this,function(t){return[2,this.impl.next()]})})},o}(n.ByteStream);exports.URLStream=u;var a=function(n){function o(t,e){void 0===e&&(e={});var r=n.call(this)||this;return r.url=t,r.options=e,r.blobPromise=fetch(t,e).then(function(t){if(t.ok)return t.blob();throw new Error(t.statusText)}),r}return t(o,n),o.prototype.pump=function(){return e(this,void 0,void 0,function(){var t,e;return r(this,function(r){switch(r.label){case 0:return null!=this.fileReaderStream?[3,2]:[4,this.blobPromise];case 1:t=r.sent(),this.fileReaderStream=new i.FileReaderStream(t,this.options),r.label=2;case 2:return[4,this.fileReaderStream.next()];case 3:return(e=r.sent()).done?[2,!1]:(this.outputQueue.push(e.value),[2,!0])}})})},o}(o.QueueStream);
},{"./byte_stream":149,"./data_stream":143,"./filereader_stream":145}],136:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../datasource"),e=require("../streams/url_stream"),o=function(r){function o(t,e){void 0===e&&(e={});var o=r.call(this)||this;return o.url=t,o.options=e,o}return t(o,r),o.prototype.getStream=function(){return new e.URLStream(this.url,this.options)},o}(r.DataSource);exports.URLDataSource=o;
},{"../datasource":144,"../streams/url_stream":146}],107:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./data/dataset");exports.Dataset=e.Dataset;var a=require("./data/dataset");exports.datasetFromElements=a.datasetFromElements;var t=require("./data/datasets/csv_dataset");exports.CSVDataset=t.CSVDataset;var r=require("./data/datasets/text_line_dataset");exports.TextLineDataset=r.TextLineDataset;var s=require("./data/sources/file_data_source");exports.FileDataSource=s.FileDataSource;var o=require("./data/sources/url_data_source");exports.URLDataSource=o.URLDataSource;
},{"./data/dataset":132,"./data/datasets/csv_dataset":133,"./data/datasets/text_line_dataset":134,"./data/sources/file_data_source":135,"./data/sources/url_data_source":136}],23:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../tensor"),a=require("../util"),n=.1,o=function(){function o(t){this.dataShapes=t,this.normalizationInfo={}}return o.prototype.getDataShape=function(t){return this.dataShapes[t]},o.prototype.getData=function(){return this.dataset},o.prototype.getStats=function(){var t=this;if(null==this.dataset)throw new Error("Data is null.");return this.dataset.map(function(a){return t.getStatsForData(a)})},o.prototype.getStatsForData=function(t){var o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=t.map(function(t,a){return a});a.shuffle(r),r=r.slice(r.length*n);for(var e=0;e<r.length;e++)for(var s=t[r[e]].dataSync(),l=0;l<s.length;l++)o=Math.min(o,s[l]),i=Math.max(i,s[l]);return{inputMin:o,inputMax:i,exampleCount:t.length,shape:t[0].shape}},o.prototype.normalizeExamplesToRange=function(n,o,i,r,e){var s=i instanceof Float32Array&&o instanceof Float32Array,l=r instanceof Float32Array&&e instanceof Float32Array,u=a.sizeFromShape(n[0].shape),h=[];return n.forEach(function(a){for(var n=a.dataSync(),m=new Float32Array(u),f=0;f<u;f++){var p=s?o[f]:o,d=(s?i[f]:i)-p,I=l?r[f]:r,z=(l?e[f]:e)-I;m[f]=0===d?I:I+z*(n[f]-p)/d}h.push(t.Tensor.make(a.shape,{values:m},"float32"))}),h},o.prototype.computeBounds=function(t){var n=this;if(null==this.dataset)throw new Error("Data is null.");var o=a.sizeFromShape(this.dataset[t][0].shape);this.normalizationInfo[t]={isNormalized:!1,minValues:new Float32Array(o),maxValues:new Float32Array(o)};for(var i=0;i<o;i++)this.normalizationInfo[t].minValues[i]=Number.POSITIVE_INFINITY,this.normalizationInfo[t].maxValues[i]=Number.NEGATIVE_INFINITY;this.dataset[t].forEach(function(a){for(var i=a.dataSync(),r=0;r<o;r++)n.normalizationInfo[t].minValues[r]=Math.min(n.normalizationInfo[t].minValues[r],i[r]),n.normalizationInfo[t].maxValues[r]=Math.max(n.normalizationInfo[t].maxValues[r],i[r])})},o.prototype.normalizeWithinBounds=function(t,a,n){if(null==this.dataset)throw new Error("Data is null.");if(t>=this.dataset.length)throw new Error("dataIndex out of bounds.");var o,i;null==this.normalizationInfo[t]&&this.computeBounds(t),this.normalizationInfo[t].isNormalized?(o=this.normalizationInfo[t].lowerBound,i=this.normalizationInfo[t].upperBound):(o=this.normalizationInfo[t].minValues,i=this.normalizationInfo[t].maxValues),this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],o,i,a,n),this.normalizationInfo[t].isNormalized=!0,this.normalizationInfo[t].lowerBound=a,this.normalizationInfo[t].upperBound=n},o.prototype.isNormalized=function(t){return null!=this.normalizationInfo&&this.normalizationInfo[t].isNormalized},o.prototype.removeNormalization=function(t){if(null==this.dataset)throw new Error("Training or test data is null.");this.isNormalized(t)&&(this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],this.normalizationInfo[t].lowerBound,this.normalizationInfo[t].upperBound,this.normalizationInfo[t].minValues,this.normalizationInfo[t].maxValues),this.normalizationInfo[t].isNormalized=!1)},o.prototype.unnormalizeExamples=function(t,a){return this.isNormalized(a)?this.normalizeExamplesToRange(t,this.normalizationInfo[a].lowerBound,this.normalizationInfo[a].upperBound,this.normalizationInfo[a].minValues,this.normalizationInfo[a].maxValues):t},o.prototype.dispose=function(){if(null!=this.dataset){for(var t=0;t<this.dataset.length;t++)for(var a=0;a<this.dataset[t].length;a++)this.dataset[t][a].dispose();this.dataset=[]}},o}();exports.InMemoryDataset=o;
},{"../tensor":15,"../util":12}],20:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tensor"),r=require("../util"),n=require("./dataset"),o=1e3;function a(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t),n.onload=function(){e(JSON.parse(n.responseText))},n.onerror=function(t){r(t)},n.send()})}exports.getXhrDatasetConfig=a;var i=function(n){function o(t){var e=n.call(this,t.data.map(function(t){return t.shape}))||this;return e.xhrDatasetConfig=t,e}return t(o,n),o.prototype.getTensor=function(t){var n="png"===t.dataType?c(t,t.shape):s(t),o=r.sizeFromShape(t.shape);return n.then(function(r){for(var n=[],a=0;a<r.length/o;a++){var i=r.subarray(a*o,(a+1)*o),s=e.Tensor.make(t.shape,{values:new Float32Array(i)},"float32");n.push(s)}return n})},o.prototype.fetchData=function(){var t=this;return new Promise(function(e,r){var n=t.xhrDatasetConfig.data.map(function(e){return t.getTensor(e)});Promise.all(n).then(function(r){t.dataset=r,e()})})},o}(n.InMemoryDataset);function s(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t.path),n.responseType="arraybuffer",n.onload=function(r){var o="float32"===t.dataType?new Float32Array(n.response):new Uint8Array(n.response);e(o)},n.onerror=function(t){return r(t)},n.send()})}function u(t,e,r){for(var n=r,o=0;o<t.length;o+=4)e[n++]=t[o]}function h(t,e,r){for(var n=r,o=0;o<t.length;o+=4)e[n]=t[o],e[n+1]=t[o+1],e[n+2]=t[o+2],n+=3}function f(t,e){var n=document.createElement("canvas"),a=n.getContext("2d"),i=t.height,s=r.sizeFromShape(e),f=new Uint8Array(i*s);if(t.width!==e[0]*e[1])throw new Error("Image width ("+t.width+") must be multiple of rows*columns ("+e[0]+"*"+e[1]+") of the tensor");n.width=t.width,n.height=o;for(var c=n.width,p=n.height,g=c,l=p,d=e[2],v=0,w=Math.ceil(i/n.height),m=0;m<w;++m){var y=m*n.height;m===w-1&&i%n.height>0&&(n.height=i%n.height,l=p=n.height),a.drawImage(t,0,y,c,p,0,0,g,l);var _=a.getImageData(0,0,n.width,n.height).data;1===d?u(_,f,v):h(_,f,v),v+=n.height*s}return f}function c(t,e){return new Promise(function(r,n){var o=new Image;o.setAttribute("crossOrigin",""),o.onload=function(){var t=f(o,e);o.src="",o=null,r(t)},o.src=t.path})}exports.XhrDataset=i;
},{"../tensor":15,"../util":12,"./dataset":23}],102:[function(require,module,exports) {
"use strict";var r;function e(r,e){return[e,r]}function t(r,e){return r*e}function o(r,e){return[4*e,r]}function n(r,e){if(r%e!=0)throw new Error("unpackedSize ("+r+") must be a multiple of "+e);return r/e}function a(r,e,o){var n=t(r.length,o);if(e.length<n)throw new Error("unpackedArray length ("+e.length+") must be >= "+n);for(var a=0,i=0;i<r.length;++i)e[a]=r[i],a+=o}Object.defineProperty(exports,"__esModule",{value:!0}),function(r){r[r.FLOAT=0]="FLOAT",r[r.UNSIGNED_BYTE=1]="UNSIGNED_BYTE"}(r=exports.TextureType||(exports.TextureType={})),exports.getUnpackedMatrixTextureShapeWidthHeight=e,exports.getUnpackedArraySizeFromMatrixSize=t,exports.getColorMatrixTextureShapeWidthHeight=o,exports.getMatrixSizeFromUnpackedArraySize=n,exports.encodeMatrixToUnpackedArray=a,exports.FLOAT_MAX=2e4,exports.FLOAT_MIN=-exports.FLOAT_MAX;var i=(exports.FLOAT_MAX-exports.FLOAT_MIN)/255,f=[1,1/255,1/65025,1/16581375],h=[1,255,65025];function u(r){for(var e=new Uint8Array(4*r.length),t=function(t){var o=r[t/4];if(isNaN(o))return e[t]=exports.BYTE_NAN_VALUE,e[t+1]=exports.BYTE_NAN_VALUE,e[t+2]=exports.BYTE_NAN_VALUE,e[t+3]=exports.BYTE_NAN_VALUE,"continue";var n=(o-exports.FLOAT_MIN)/i,a=h.map(function(r){return r*n}).map(function(r){return Math.floor(r%1*255)});e[t]=Math.floor(n),e[t+1]=a[0],e[t+2]=a[1],e[t+3]=a[2]},o=0;o<e.length;o+=4)t(o);return e}function p(r){for(var e=new Float32Array(r.length/4),t=function(t){if(r[t]===exports.BYTE_NAN_VALUE&&r[t+1]===exports.BYTE_NAN_VALUE&&r[t+2]===exports.BYTE_NAN_VALUE&&r[t+3]===exports.BYTE_NAN_VALUE)return e[t/4]=NaN,"continue";var o=0;f.forEach(function(e,n){o+=e*r[t+n]});var n=o*i+exports.FLOAT_MIN;e[t/4]=n},o=0;o<r.length;o+=4)t(o);return e}function x(r,e,t){var o=n(r.length,t);if(e.length<o)throw new Error("matrix length ("+e.length+") must be >= "+o);for(var a=0,i=0;i<r.length;i+=t)e[a++]=r[i]}function c(r,e,t){var o=r.length*t/4;if(e.length<o)throw new Error("matrix length ("+e.length+") must be >= "+o);for(var n=0,a=0;a<r.length;a+=4)for(var i=0;i<t;i++)e[n++]=r[a+i]}function l(r,e){return[Math.ceil(e/2),Math.ceil(r/2)]}function A(r,e){var t=l(r,e);return t[0]*t[1]*4}function s(r,e,t,o){var n=A(e,t);if(o.length<n)throw new Error("packedRGBA length ("+o.length+") must be >= "+n);for(var a=l(e,t),i=a[0],f=a[1],h=t%2==1,u=e%2==1,p=Math.floor(t/2),x=Math.floor(e/2),c=h?4:0,s=t,g=0,N=0;N<x;++N){for(var T=2*N*t,d=0;d<p;++d){var E=T+2*d;o[g]=r[E],o[g+1]=r[E+1],o[g+2]=r[E+s],o[g+3]=r[E+s+1],g+=4}g+=c}if(h){E=t-1,g=4*(i-1);var _=2*t;for(c=4*i,N=0;N<x;++N)o[g]=r[E],o[g+2]=r[E+t],E+=_,g+=c}if(u)for(E=(e-1)*t,g=(f-1)*i*4,d=0;d<p;++d)o[g++]=r[E++],o[g++]=r[E++],g+=2;return h&&u&&(o[o.length-4]=r[r.length-1]),o}function g(r,e,t,o){var n=e*t;if(n<o.length)throw new Error("matrix length ("+o.length+") must be >= "+n);for(var a=t%2==1,i=e%2==1,f=Math.floor(t/2),h=Math.floor(e/2),u=l(e,t),p=u[0],x=u[1],c=a?4:0,A=t+(a?1:0),s=0,g=0,N=t,T=0;T<h;++T){for(var d=0;d<f;++d)o[g++]=r[s++],o[g++]=r[s++],o[N++]=r[s++],o[N++]=r[s++];s+=c,g+=A,N+=A}if(a){s=4*(p-1);var E=t-1;for(c=4*p,A=2*t,T=0;T<h;++T)o[E]=r[s],o[E+t]=r[s+2],s+=c,E+=A}if(i)for(s=(x-1)*p*4,E=(e-1)*t,d=0;d<f;++d)o[E++]=r[s++],o[E++]=r[s++],s+=2;return a&&i&&(o[o.length-1]=r[r.length-4]),o}exports.BYTE_NAN_VALUE=0,exports.encodeFloatArray=u,exports.decodeToFloatArray=p,exports.decodeMatrixFromUnpackedArray=x,exports.decodeMatrixFromUnpackedColorRGBAArray=c,exports.getPackedMatrixTextureShapeWidthHeight=l,exports.getPackedRGBAArraySizeFromMatrixShape=A,exports.encodeMatrixToPackedRGBA=s,exports.decodeMatrixFromPackedRGBA=g;
},{}],42:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=null,r=require("../../util"),t=require("../../environment");function n(e){var r=document.createElement("canvas");return r.width=1,r.height=1,o(r,e)}function o(e,r){var n,o=t.ENV.get("WEBGL_VERSION");if(2===o?n=e.getContext("webgl2",r):1===o&&(n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)),0===o||null==n)throw new Error("This browser does not support WebGL.");return n}function u(e,r){var t=r();return f(e),t}exports.createWebGLRenderingContext=n,exports.createWebGLRenderingContextFromCanvas=o,exports.callAndCheck=u;var a=!1;function i(e){a=e}function f(e){if(a){var r=e.getError();if(r!==e.NO_ERROR)throw new Error("WebGL Error: "+c(e,r))}}function c(e,r){switch(r){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+r}}function E(e,r){return C(e,function(){return e.getExtension(r)},'Extension "'+r+'" not supported on this browser.')}function T(e,r){var t=C(e,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(u(e,function(){return e.shaderSource(t,r)}),u(e,function(){return e.compileShader(t)}),!1===e.getShaderParameter(t,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function s(e,r){var t=C(e,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(u(e,function(){return e.shaderSource(t,r)}),u(e,function(){return e.compileShader(t)}),!1===e.getShaderParameter(t,e.COMPILE_STATUS))throw R(r,e.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}exports.enableDebugWebGLErrorChecking=i,exports.checkWebGLError=f,exports.getWebGLErrorMessage=c,exports.getExtensionOrThrow=E,exports.createVertexShader=T,exports.createFragmentShader=s;var l=/ERROR: [0-9]+:([0-9]+):/g;function R(e,t){var n=l.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var o=+n[1],u=e.split("\n"),a=u.length.toString().length+2,i=u.map(function(e,t){return r.rightPad((t+1).toString(),a)+e}),f=0,c=0;c<i.length;c++)f=Math.max(i[c].length,f);var E=i.slice(0,o-1),T=i.slice(o-1,o),s=i.slice(o);console.log(E.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+r.rightPad(T[0],f),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(s.join("\n"))}function g(e){return C(e,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function F(e,r){if(u(e,function(){return e.linkProgram(r)}),!1===e.getProgramParameter(r,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(r)),new Error("Failed to link vertex and fragment shaders.")}function x(e,r){if(u(e,function(){return e.validateProgram(r)}),!1===e.getProgramParameter(r,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(r)),new Error("Shader program validation failed.")}function A(e,r){var t=C(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return u(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,t)}),u(e,function(){return e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)}),t}function b(e,r){var t=C(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return u(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)}),u(e,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW)}),t}function d(r){return null!=e?e:e=u(r,function(){return r.getParameter(r.MAX_TEXTURE_SIZE)})}function _(){return t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===t.ENV.get("WEBGL_VERSION")?1:4}function h(e){return C(e,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function m(e,r,t){var n=d(e);if(r<=0||t<=0){var o="["+r+"x"+t+"]";throw new Error("Requested texture size "+o+" is invalid.")}if(r>n||t>n){o="["+r+"x"+t+"]";throw new Error("Requested texture size "+o+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}}function U(e){return C(e,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function L(e,r,t,n,o,a,i){var f=e.getAttribLocation(r,t);-1!==f&&(u(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),u(e,function(){return e.vertexAttribPointer(f,o,e.FLOAT,!1,a,i)}),u(e,function(){return e.enableVertexAttribArray(f)}))}function p(e,r,t){D(e,t),u(e,function(){return e.activeTexture(e.TEXTURE0+t)}),u(e,function(){return e.bindTexture(e.TEXTURE_2D,r)})}function S(e,r){D(e,r),u(e,function(){return e.activeTexture(e.TEXTURE0+r)}),u(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function M(e,r,t){return C(e,function(){return e.getUniformLocation(r,t)},'uniform "'+t+'" not present in program.')}function I(e,r,t){return e.getUniformLocation(r,t)}function N(e,r,t,n,o){u(e,function(){return p(e,t,o)}),u(e,function(){return e.uniform1i(n,o)})}function O(e){u(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),u(e,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),u(e,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})}function v(e,r,t){u(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),u(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)})}function P(e,r){u(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),u(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function w(e){var r=e.checkFramebufferStatus(e.FRAMEBUFFER);if(r!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+B(e,r))}function B(e,r){switch(r){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+r}}function C(e,r,t){var n=u(e,function(){return r()});if(null==n)throw new Error(t);return n}function D(e,r){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=r+e.TEXTURE0;if(n<e.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function G(e,t){2!==t.length&&(t=r.squeezeShape(t).newShape);var n=d(e),o=r.sizeFromShape(t);return t.length<=1&&o<=n?[o,1]:2===t.length&&t[0]<=n&&t[1]<=n?t:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?[t[0],t[1]*t[2]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n?[t[0],t[1]*t[2]*t[3]]:r.sizeToSquarishShape(o)}exports.createProgram=g,exports.linkProgram=F,exports.validateProgram=x,exports.createStaticVertexBuffer=A,exports.createStaticIndexBuffer=b,exports.queryMaxTextureSize=d,exports.getChannelsPerTexture=_,exports.createTexture=h,exports.validateTextureSize=m,exports.createFramebuffer=U,exports.bindVertexBufferToProgramAttribute=L,exports.bindTextureUnit=p,exports.unbindTextureUnit=S,exports.getProgramUniformLocationOrThrow=M,exports.getProgramUniformLocation=I,exports.bindTextureToProgramUniformSampler=N,exports.bindCanvasToFramebuffer=O,exports.bindColorTextureToFramebuffer=v,exports.unbindColorTextureFromFramebuffer=P,exports.validateFramebuffer=w,exports.getFramebufferErrorMessage=B,exports.getTextureShapeFromLogicalShape=G;
},{"../../util":12,"../../environment":10}],41:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(a,u){function i(e){try{o(n.next(e))}catch(e){u(e)}}function c(e){try{o(n.throw(e))}catch(e){u(e)}}function o(e){e.done?a(e.value):new t(function(r){r(e.value)}).then(i,c)}o((n=n.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var t,n,a,u,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(u){return function(c){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,n&&(a=n[2&u[0]?"return":u[0]?"throw":"next"])&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[0,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=r.call(e,i)}catch(e){u=[6,e],n=0}finally{t=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../environment"),n=require("./tex_util"),a=require("./webgl_util");function u(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function i(e){var r,t=u();return r=null!=e?a.createWebGLRenderingContextFromCanvas(e,t):a.createWebGLRenderingContext(t),a.callAndCheck(r,function(){return r.disable(r.DEPTH_TEST)}),a.callAndCheck(r,function(){return r.disable(r.STENCIL_TEST)}),a.callAndCheck(r,function(){return r.disable(r.BLEND)}),a.callAndCheck(r,function(){return r.disable(r.DITHER)}),a.callAndCheck(r,function(){return r.disable(r.POLYGON_OFFSET_FILL)}),a.callAndCheck(r,function(){return r.disable(r.SAMPLE_COVERAGE)}),a.callAndCheck(r,function(){return r.enable(r.SCISSOR_TEST)}),a.callAndCheck(r,function(){return r.enable(r.CULL_FACE)}),a.callAndCheck(r,function(){return r.cullFace(r.BACK)}),r}function c(e){return a.createVertexShader(e,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function o(e){var r=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return a.createStaticVertexBuffer(e,r)}function l(e){var r=new Uint16Array([0,1,2,2,1,3]);return a.createStaticIndexBuffer(e,r)}function d(e,r){return t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===t.ENV.get("WEBGL_VERSION")?4===r?e.RGBA32F:e.R32F:e.RGBA}function f(e,r){return t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===t.ENV.get("WEBGL_VERSION")?4===r?e.RGBA:e.RED:e.RGBA}function A(e){return t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?e.FLOAT:e.UNSIGNED_BYTE}function E(e,r,t,n){a.validateTextureSize(e,r,t);var u=a.createTexture(e),i=e.TEXTURE_2D,c=d(e,n),o=f(e,n);return a.callAndCheck(e,function(){return e.bindTexture(i,u)}),a.callAndCheck(e,function(){return e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),a.callAndCheck(e,function(){return e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),a.callAndCheck(e,function(){return e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST)}),a.callAndCheck(e,function(){return e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST)}),a.callAndCheck(e,function(){return e.texImage2D(i,0,c,r,t,0,o,A(e),null)}),a.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)}),u}function T(e,r,t){var a=n.getUnpackedMatrixTextureShapeWidthHeight(r,t);return E(e,a[0],a[1],1)}function x(e,r,t){var a=n.getColorMatrixTextureShapeWidthHeight(r,t);return E(e,a[0],a[1],4)}function h(e,r,t){var a=n.getPackedMatrixTextureShapeWidthHeight(r,t);return E(e,a[0],a[1],4)}function s(e,r,t){a.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,t)}),a.bindVertexBufferToProgramAttribute(e,r,"clipSpacePos",t,3,20,0),a.bindVertexBufferToProgramAttribute(e,r,"uv",t,2,20,12)}function p(e,r,t){a.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,r)}),a.callAndCheck(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}),a.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function _(e,r,t,n,u,i){var c=f(e,i);a.validateTextureSize(e,t,n),a.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,r)}),a.callAndCheck(e,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,t,n,c,A(e),u)}),a.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function R(e,r,u,i,c,o){var l,d=n.getUnpackedMatrixTextureShapeWidthHeight(u,i),f=d[0],A=d[1];if(t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var E=1===o?a.getChannelsPerTexture():o;1===E?l=c:(l=new Float32Array(n.getUnpackedArraySizeFromMatrixSize(c.length,E)),n.encodeMatrixToUnpackedArray(c,l,E))}else l=n.encodeFloatArray(c);_(e,r,f,A,l,o)}function C(e,r,t,a,u){var i=n.getPackedMatrixTextureShapeWidthHeight(t,a),c=i[0],o=i[1],l=new Float32Array(n.getPackedRGBAArraySizeFromMatrixShape(t,a));n.encodeMatrixToPackedRGBA(u,t,a,l);_(e,r,c,o,l,4)}function k(e,r,a){return t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?new Float32Array(n.getUnpackedArraySizeFromMatrixSize(e*r,a)):new Uint8Array(e*r*a)}function B(e,r,a,u){if(t.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var i=new Float32Array(r*a);return n.decodeMatrixFromUnpackedArray(e,i,u),i}return n.decodeToFloatArray(e)}function b(t,n,u,i){return e(this,void 0,void 0,function(){var e,c,o,l,d;return r(this,function(r){switch(r.label){case 0:return e=t,o=k(u,i,c=4),l=o instanceof Float32Array?4*o.length:o,d=t.createBuffer(),a.callAndCheck(t,function(){return t.bindBuffer(e.PIXEL_PACK_BUFFER,d)}),a.callAndCheck(t,function(){return t.bufferData(e.PIXEL_PACK_BUFFER,l,t.STATIC_DRAW)}),a.callAndCheck(t,function(){return e.readPixels(0,0,i,u,t.RGBA,A(t),0)}),[4,n.getBufferSubDataAsync(e.PIXEL_PACK_BUFFER,0,o)];case 1:return r.sent(),[2,B(o,u,i,c)]}})})}function g(e,r,t){var u=n.getUnpackedMatrixTextureShapeWidthHeight(r,t),i=u[0],c=u[1],o=k(r,t,4);return a.callAndCheck(e,function(){return e.readPixels(0,0,i,c,e.RGBA,A(e),o)}),B(o,r,t,4)}function F(e,r,t,u){var i=r*t*4,c=new Uint8Array(i);a.callAndCheck(e,function(){return e.readPixels(0,0,t,r,e.RGBA,e.UNSIGNED_BYTE,c)});for(var o=new Float32Array(i),l=0;l<c.length;l++)o[l]=c[l];var d=new Float32Array(r*t*u);return n.decodeMatrixFromUnpackedColorRGBAArray(o,d,u),d}function S(e,r,t){var u=n.getPackedMatrixTextureShapeWidthHeight(r,t),i=u[0],c=u[1],o=new Float32Array(n.getPackedRGBAArraySizeFromMatrixShape(r,t));a.callAndCheck(e,function(){return e.readPixels(0,0,i,c,e.RGBA,A(e),o)});var l=new Float32Array(r*t);return n.decodeMatrixFromPackedRGBA(o,r,t,l)}exports.getWebGLContextAttributes=u,exports.createWebGLContext=i,exports.createVertexShader=c,exports.createVertexBuffer=o,exports.createIndexBuffer=l,exports.createMatrixTexture=T,exports.createColorMatrixTexture=x,exports.createPackedMatrixTexture=h,exports.bindVertexProgramAttributeStreams=s,exports.uploadPixelDataToTexture=p,exports.uploadMatrixToTexture=R,exports.uploadMatrixToPackedTexture=C,exports.downloadMatrixFromOutputTextureAsync=b,exports.downloadMatrixFromOutputTexture=g,exports.downloadMatrixFromRGBAColorTexture=F,exports.downloadMatrixFromPackedOutputTexture=S;
},{"../../environment":10,"./tex_util":102,"./webgl_util":42}],29:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),e=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))(function(n,o){function i(t){try{p(a.next(t))}catch(t){o(t)}}function s(t){try{p(a.throw(t))}catch(t){o(t)}}function p(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(i,s)}p((a=a.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var r,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,a&&(n=a[2&o[0]?"return":o[0]?"throw":"next"])&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[0,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("seedrandom"),n=require("../environment"),o=require("../math"),i=require("../ops/axis_util"),s=require("../ops/broadcast_util"),p=require("../ops/concat_util"),u=require("../ops/ops"),h=require("../ops/ops"),f=require("../ops/selu_util"),l=require("../tensor"),c=require("../types"),d=require("../util"),y=function(){function t(){this.data=new WeakMap,"undefined"!=typeof document&&(this.canvas=document.createElement("canvas"))}return t.prototype.register=function(t,e,r){if(this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,null)},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.throwIfNoData(t),this.data.set(t,e)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("MathBackendCPU.writePixels(): pixels can not be null");var r,a;if(t instanceof ImageData)r=t.data;else if(t instanceof HTMLCanvasElement)r=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels is of unknown type: "+t.constructor.name);if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.getContext("2d").drawImage(t,0,0,t.width,t.height),r=this.canvas.getContext("2d").getImageData(0,0,t.width,t.height).data}if(4===e)a=new Int32Array(r);else{var n=t.width*t.height;a=new Int32Array(n*e);for(var o=0;o<n;o++)for(var i=0;i<e;++i)a[o*e+i]=r[4*o+i]}var s=[t.height,t.width,e];return h.tensor3d(a,s,"int32")},t.prototype.read=function(t){return e(this,void 0,void 0,function(){return r(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){return this.throwIfNoData(t),this.data.get(t)},t.prototype.disposeData=function(t){this.data.has(t)&&this.data.delete(t)},t.prototype.time=function(t){return e(this,void 0,void 0,function(){var e;return r(this,function(r){return e=performance.now(),t(),[2,{kernelMs:performance.now()-e}]})})},t.prototype.memory=function(){return{unreliable:!0}},t.prototype.throwIfNoData=function(t){if(!this.data.has(t))throw new Error("CPU backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},t.prototype.slice=function(t,e,r){for(var a=u.buffer(r,t.dtype),n=0;n<a.size;++n){var o=a.indexToLoc(n),i=o.map(function(t,r){return t+e[r]});a.set.apply(a,[t.get.apply(t,i)].concat(o))}return a.toTensor()},t.prototype.reverse=function(t,e){for(var r=u.buffer(t.shape,t.dtype),a=t.buffer(),n=function(n){var o=r.indexToLoc(n),i=o.slice();e.forEach(function(e){return i[e]=t.shape[e]-1-i[e]}),r.set.apply(r,[a.get.apply(a,i)].concat(o))},o=0;o<r.size;o++)n(o);return r.toTensor()},t.prototype.concat=function(t,e){var r=p.computeOutShape(t.shape,e.shape,1),a=u.buffer(r,t.dtype);if(1===t.shape[0]&&1===e.shape[0]){var n=t.dataSync(),o=e.dataSync(),i=a.values;return i.set(n,0),i.set(o,t.size),a.toTensor()}for(var s=0;s<r[0];++s){for(var h=0;h<t.shape[1];++h)a.set(t.get(s,h),s,h);for(h=0;h<e.shape[1];++h)a.set(e.get(s,h),s,h+t.shape[1])}return a.toTensor()},t.prototype.neg=function(t){return this.multiply(u.scalar(-1),t)},t.prototype.add=function(t,e){return this.broadcastedBinaryOp(t,e,c.upcastType(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.subtract=function(t,e){return this.broadcastedBinaryOp(t,e,c.upcastType(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.matMul=function(t,e,r,a){for(var n=r?t.shape[0]:t.shape[1],o=r?t.shape[1]:t.shape[0],i=a?e.shape[0]:e.shape[1],s=function(t,e,r){return t.get(e,r)},p=function(t,e,r){return t.get(r,e)},h=r?p:s,f=a?p:s,l=new Float32Array(o*i),c=0,d=0;d<o;++d)for(var y=0;y<i;++y){for(var v=0,g=0;g<n;++g)v+=h(t,d,g)*f(e,g,y);l[c++]=v}return u.tensor2d(l,[o,i])},t.prototype.multiply=function(t,e){return this.broadcastedBinaryOp(t,e,c.upcastType(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.divide=function(t,e){return this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.sum=function(t,e){i.assertAxesAreInnerMostDims("sum",e,t.rank);for(var r=i.computeOutAndReduceShapes(t.shape,e),a=r[0],n=r[1],o=c.upcastType(t.dtype,"int32"),s=u.zeros(a,o),p=d.sizeFromShape(n),h=s.dataSync(),f=t.dataSync(),l=0;l<h.length;++l){for(var y=l*p,v=0,g=0;g<p;++g)v+=f[y+g];h[l]=v}return s},t.prototype.argMin=function(t,e){i.assertAxesAreInnerMostDims("argMin",e,t.rank);for(var r=i.computeOutAndReduceShapes(t.shape,e),a=r[0],n=r[1],o=u.zeros(a,"int32"),s=d.sizeFromShape(n),p=o.dataSync(),h=t.dataSync(),f=0;f<p.length;++f){for(var l=f*s,c=h[l],y=0,v=0;v<s;++v){var g=h[l+v];if(isNaN(g)){y=d.NAN_INT32;break}g<c&&(c=g,y=v)}p[f]=y}return o},t.prototype.argMax=function(t,e){i.assertAxesAreInnerMostDims("argMax",e,t.rank);for(var r=i.computeOutAndReduceShapes(t.shape,e),a=r[0],n=r[1],o=u.zeros(a,"int32"),s=d.sizeFromShape(n),p=o.dataSync(),h=t.dataSync(),f=0;f<p.length;++f){for(var l=f*s,c=h[l],y=0,v=0;v<s;++v){var g=h[l+v];if(isNaN(g)){y=d.NAN_INT32;break}g>c&&(c=g,y=v)}p[f]=y}return o},t.prototype.equal=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r===a?1:0})},t.prototype.notEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r!==a?1:0})},t.prototype.less=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r<a?1:0})},t.prototype.lessEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r<=a?1:0})},t.prototype.greater=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r>a?1:0})},t.prototype.greaterEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r>=a?1:0})},t.prototype.logicalNot=function(t){for(var e=t.dataSync(),r=new Int32Array(e.length),a=0;a<e.length;++a)d.isValNaN(e[a],t.dtype)?r[a]=d.getNaN("bool"):r[a]=e[a]?0:1;return l.Tensor.make(t.shape,{values:r},"bool")},t.prototype.logicalAnd=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r&&a})},t.prototype.logicalOr=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r||a})},t.prototype.logicalXor=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return d.isValNaN(r,t.dtype)||d.isValNaN(a,e.dtype)?d.getNaN("bool"):r^a})},t.prototype.where=function(t,e,r,a){for(var n=t.dataSync(),o=e.dataSync(),i=r.dataSync(),s=u.zeros(e.shape,a),p=s.dataSync(),h=0,f=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],l=0;l<n.length;l++)for(var c=0;c<f;c++)1===n[l]?p[h++]=o[l]:p[h++]=i[l];return s},t.prototype.topKValues=function(t,e){return this.topK(t,e).values},t.prototype.topKIndices=function(t,e){return this.topK(t,e).indices},t.prototype.topK=function(t,e){for(var r=t.dataSync(),a=[],n=0;n<r.length;n++)a.push({value:r[n],index:n});a.sort(function(t,e){return e.value-t.value});var o=d.getTypedArrayFromDType(t.dtype,e),i=new Int32Array(e);for(n=0;n<e;n++)o[n]=a[n].value,i[n]=a[n].index;return{values:u.tensor1d(o,t.dtype),indices:l.Tensor1D.new(i)}},t.prototype.min=function(t,e){i.assertAxesAreInnerMostDims("min",e,t.rank);for(var r=i.computeOutAndReduceShapes(t.shape,e),a=r[0],n=r[1],o=u.zeros(a,t.dtype),s=d.sizeFromShape(n),p=o.dataSync(),h=t.dataSync(),f=0;f<p.length;++f){for(var l=f*s,c=h[0],y=0;y<s;++y){var v=h[l+y];if(isNaN(v)){c=Number.NaN;break}v<c&&(c=v)}p[f]=c}return o},t.prototype.minimum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.max=function(t,e){i.assertAxesAreInnerMostDims("max",e,t.rank);for(var r=i.computeOutAndReduceShapes(t.shape,e),a=r[0],n=r[1],o=u.zeros(a,t.dtype),s=d.sizeFromShape(n),p=o.dataSync(),h=t.dataSync(),f=0;f<p.length;++f){for(var l=f*s,c=h[l],y=0;y<s;++y){var v=h[l+y];if(isNaN(v)){c=Number.NaN;break}v>c&&(c=v)}p[f]=c}return o},t.prototype.maximum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.ceil=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.ceil(e[a]);return l.Tensor.make(t.shape,{values:r})},t.prototype.floor=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.floor(e[a]);return l.Tensor.make(t.shape,{values:r})},t.prototype.exp=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.exp(e[a]);return l.Tensor.make(t.shape,{values:r})},t.prototype.log=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a){var n=e[a];r[a]=Math.log(n)}return l.Tensor.make(t.shape,{values:r})},t.prototype.sqrt=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a){var n=e[a];r[a]=Math.sqrt(n)}return l.Tensor.make(t.shape,{values:r})},t.prototype.square=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a){var n=e[a];r[a]=n*n}return l.Tensor.make(t.shape,{values:r})},t.prototype.relu=function(t){for(var e=u.zeros(t.shape,t.dtype),r=e.dataSync(),a=t.dataSync(),n=0;n<a.length;++n){var o=a[n];d.isValNaN(o,t.dtype)?r[n]=d.getNaN(e.dtype):r[n]=Math.max(0,a[n])}return e},t.prototype.elu=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a){var n=r[a];e[a]=n>=0?n:Math.exp(n)-1}return l.Tensor.make(t.shape,{values:e})},t.prototype.eluDer=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a){var n=r[a];e[a]=n>=0?1:Math.exp(n)}return l.Tensor.make(t.shape,{values:e})},t.prototype.selu=function(t){for(var e=f.SELU_SCALEALPHA,r=f.SELU_SCALE,a=new Float32Array(t.size),n=t.dataSync(),o=0;o<n.length;++o){var i=n[o];a[o]=i>=0?r*i:e*(Math.exp(i)-1)}return l.Tensor.make(t.shape,{values:a})},t.prototype.leakyRelu=function(t,e){for(var r=new Float32Array(t.size),a=t.dataSync(),n=0;n<a.length;n++){var o=a[n];r[n]=o>=0?o:e*o}return l.Tensor.make(t.shape,{values:r})},t.prototype.prelu=function(t,e){for(var r=new Float32Array(t.size),a=t.dataSync(),n=e.dataSync(),o=0;o<a.length;o++){var i=a[o];r[o]=i>=0?i:n[o]*i}return l.Tensor.make(t.shape,{values:r})},t.prototype.preluDer=function(t,e){for(var r=new Float32Array(t.size),a=t.dataSync(),n=e.dataSync(),o=0;o<a.length;o++){var i=a[o];r[o]=i>0?1:i<0?n[o]:i}return l.Tensor.make(t.shape,{values:r})},t.prototype.clip=function(t,e,r){for(var a=new Float32Array(t.size),n=t.dataSync(),o=0;o<n.length;++o)a[o]=Math.min(r,Math.max(e,n[o]));return l.Tensor.make(t.shape,{values:a})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.abs(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.int=function(t){for(var e=new Int32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=r[a];return l.Tensor.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=1/(1+Math.exp(-r[a]));return l.Tensor.make(t.shape,{values:e})},t.prototype.sin=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.sin(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.cos=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.cos(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.tan=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.tan(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.asin=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.asin(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.acos=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.acos(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.atan=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.atan(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.sinh=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.sinh(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.cosh=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.cosh(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.tanh=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=d.tanh(r[a]);return l.Tensor.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0);for(var r=new Float32Array(t.size),a=t.dataSync(),n=0;n<a.length;++n){var o=a[n];d.isValNaN(o,t.dtype)?r[n]=d.getNaN(t.dtype):r[n]=o>0?1:e}return l.Tensor.make(t.shape,{values:r})},t.prototype.conv2d=function(t,e,r){for(var a=r.filterHeight,n=r.filterWidth,o=r.padInfo.left,i=r.padInfo.top,s=u.buffer(r.outShape,t.dtype),p=0;p<r.batchSize;++p)for(var h=0;h<r.outChannels;++h)for(var f=0;f<r.outHeight;++f)for(var l=f*r.strideHeight-o,c=Math.max(0,l),d=Math.min(r.inHeight,a+l),y=0;y<r.outWidth;++y){for(var v=y*r.strideWidth-i,g=Math.max(0,v),m=Math.min(r.inWidth,n+v),N=0,b=c;b<d;++b)for(var w=b-l,S=g;S<m;++S)for(var M=S-v,T=0;T<r.inChannels;++T){N+=t.get(p,b,S,T)*e.get(w,M,T,h)}s.set(N,p,f,y,h)}return s.toTensor()},t.prototype.conv2dDerInput=function(t,e,r){for(var a=r.filterHeight,n=r.filterWidth,o=a-1-r.padInfo.top,i=n-1-r.padInfo.left,s=r.strideHeight,p=r.strideWidth,h=u.buffer(r.inShape,"float32"),f=0;f<r.batchSize;++f)for(var l=0;l<r.inChannels;++l)for(var c=0;c<r.inHeight;++c)for(var d=c-i,y=Math.max(0,Math.ceil(d/s)),v=Math.min(r.outHeight,(a+d)/s),g=0;g<r.inWidth;++g){for(var m=g-o,N=Math.max(0,Math.ceil(m/p)),b=Math.min(r.outWidth,(n+m)/p),w=0,S=y;S<v;++S)for(var M=S*s-d,T=N;T<b;++T)for(var x=T*p-m,A=0;A<r.outChannels;++A){w+=t.get(f,S,T,A)*e.get(a-1-M,n-1-x,l,A)}h.set(w,f,c,g,l)}return h.toTensor()},t.prototype.conv2dDerFilter=function(t,e,r){for(var a=r.strideHeight,n=r.strideWidth,o=r.filterHeight,i=r.filterWidth,s=u.buffer(r.filterShape,"float32"),p=r.padInfo.left,h=r.padInfo.top,f=0;f<o;++f)for(var l=Math.max(0,Math.ceil((h-f)/a)),c=Math.min(r.outHeight,(r.inHeight+h-f)/a),d=0;d<i;++d)for(var y=Math.max(0,Math.ceil((p-d)/n)),v=Math.min(r.outWidth,(r.inWidth+p-d)/n),g=0;g<r.inChannels;++g)for(var m=0;m<r.outChannels;++m){for(var N=0,b=0;b<r.batchSize;++b)for(var w=l;w<c;++w)for(var S=f+w*a-h,M=y;M<v;++M){var T=d+M*n-p;N+=t.get(b,S,T,g)*e.get(b,w,M,m)}s.set(N,f,d,g,m)}return s.toTensor()},t.prototype.depthwiseConv2D=function(t,e,r){for(var a=r.filterHeight,n=r.filterWidth,o=r.padInfo.left,i=r.padInfo.top,s=r.outChannels/r.inChannels,p=u.buffer(r.outShape,t.dtype),h=0;h<r.batchSize;++h)for(var f=0;f<r.inChannels;++f)for(var l=0;l<r.outHeight;++l)for(var c=l*r.strideHeight-o,d=Math.max(0,c),y=Math.min(r.inHeight,a+c),v=0;v<r.outWidth;++v)for(var g=v*r.strideWidth-i,m=Math.max(0,g),N=Math.min(r.inWidth,n+g),b=0;b<s;++b){for(var w=0,S=d;S<y;++S)for(var M=S-c,T=m;T<N;++T){var x=T-g;w+=t.get(h,S,T,f)*e.get(M,x,f,b)}p.set(w,h,l,v,f*s+b)}return p.toTensor()},t.prototype.tile=function(t,e){for(var r=new Array(t.rank),a=0;a<r.length;a++)r[a]=t.shape[a]*e[a];var n=u.buffer(r,t.dtype),o=t.dataSync();for(a=0;a<n.values.length;++a){for(var i=n.indexToLoc(a),s=new Array(t.rank),p=0;p<s.length;p++)s[p]=i[p]%t.shape[p];var h=t.locToIndex(s);n.values[a]=o[h]}return n.toTensor()},t.prototype.pad=function(t,e,r){var a=e.map(function(e,r){return e[0]+t.shape[r]+e[1]}),n=e.map(function(t){return t[0]}),o=t.buffer(),i=u.buffer(a,t.dtype);0!==r&&i.values.fill(r);for(var s=0;s<t.size;s++){var p=o.indexToLoc(s),h=p.map(function(t,e){return t+n[e]});i.set.apply(i,[t.get.apply(t,p)].concat(h))}return i.toTensor()},t.prototype.transpose=function(t,e){for(var r=new Array(t.rank),a=0;a<r.length;a++)r[a]=t.shape[e[a]];var n=new Float32Array(t.size),o=t.dataSync(),i=l.Tensor.make(r,{values:n});for(a=0;a<t.size;++a){for(var s=t.indexToLoc(a),p=new Array(s.length),u=0;u<p.length;u++)p[u]=s[e[u]];n[i.locToIndex(p)]=o[a]}return i},t.prototype.gather=function(t,e,r){var a=t.shape.slice(),n=e.dataSync();a[r]=n.length;for(var o=u.zeros(a,t.dtype),i=t.dataSync(),s=o.dataSync(),p=0;p<o.size;++p){var h=o.indexToLoc(p),f=h.slice();f[r]=n[h[r]];var l=t.locToIndex(f);s[p]=i[l]}return o},t.prototype.pool=function(t,e,r){for(var a=e.strideHeight,n=e.strideWidth,o=e.filterHeight,i=e.filterWidth,s=u.buffer(e.outShape,"float32"),p=e.padInfo.top,h=e.padInfo.left,f=0;f<e.batchSize;++f)for(var l=0;l<e.inChannels;++l)for(var c=0;c<e.outHeight;++c)for(var d=c*a-p,y=Math.max(0,d),v=Math.min(e.inHeight,o+d),g=0;g<e.outWidth;++g){for(var m=g*n-h,N=Math.max(0,m),b=Math.min(e.inWidth,i+m),w="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=0,M=y;M<v;++M){for(var T=N;T<b;++T){var x=t.get(f,M,T,l);if(isNaN(x)){w=NaN,S=NaN;break}"max"===r&&x>w||"min"===r&&x<w?w=x:"avg"===r&&(S+=x/(o*i))}if(isNaN(w))break}s.set("avg"===r?S:w,f,c,g,l)}return s.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var r=u.buffer(e.outShape,"int32"),a=e.strideHeight,n=e.strideWidth,o=e.filterHeight,i=e.filterWidth,s=e.padInfo.top,p=e.padInfo.left,h=0;h<e.batchSize;++h)for(var f=0;f<e.inChannels;++f)for(var l=0;l<e.outHeight;++l)for(var c=l*a-s,d=Math.max(0,c),y=Math.min(e.inHeight,o+c),v=0;v<e.outWidth;++v){for(var g=v*n-p,m=Math.max(0,g),N=Math.min(e.inWidth,i+g),b=Number.NEGATIVE_INFINITY,w=-1,S=d;S<y;++S)for(var M=S-c,T=m;T<N;++T){var x=T-g,A=t.get(h,S,T,f);A>b&&(b=A,w=M*i+x)}r.set(w,h,l,v,f)}return r.toTensor()},t.prototype.maxPoolBackprop=function(t,e,r){for(var a=this.maxPoolPositions(e,r),n=r.strideHeight,o=r.strideWidth,i=r.filterHeight,s=r.filterWidth,p=s-1-r.padInfo.left,h=i-1-r.padInfo.top,f=u.buffer(e.shape,"float32"),l=0;l<r.batchSize;++l)for(var c=0;c<r.inChannels;++c)for(var d=0;d<r.inHeight;++d)for(var y=0;y<r.inWidth;++y){for(var v=d-h,g=y-p,m=0,N=0;N<i;++N){var b=(v+N)/n;if(!(b<0||b>=r.outHeight||Math.floor(b)!==b))for(var w=0;w<s;++w){var S=(g+w)/o;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var M=i*s-1-a.get(l,b,S,c)===N*s+w?1:0;if(0!==M)m+=t.get(l,b,S,c)*M}}}f.set(m,l,d,y,c)}return f.toTensor()},t.prototype.avgPoolBackprop=function(t,e,r){for(var a=r.strideHeight,n=r.strideWidth,o=r.filterHeight,i=r.filterWidth,s=i-1-r.padInfo.left,p=o-1-r.padInfo.top,h=u.buffer(e.shape,"float32"),f=1/(o*i),l=0;l<r.batchSize;++l)for(var c=0;c<r.inChannels;++c)for(var d=0;d<r.inHeight;++d)for(var y=0;y<r.inWidth;++y){for(var v=d-p,g=y-s,m=0,N=0;N<o;++N){var b=(v+N)/a;if(!(b<0||b>=r.outHeight||Math.floor(b)!==b))for(var w=0;w<i;++w){var S=(g+w)/n;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S))m+=t.get(l,b,S,c)}}h.set(m*f,l,d,y,c)}return h.toTensor()},t.prototype.minPool=function(t,e){return this.pool(t,e,"min")},t.prototype.avgPool=function(t,e){return this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,r,a){for(var n=t.shape,o=n[0],i=n[1],s=n[2],p=n[3],h=u.buffer([o,e,r,p],t.dtype),f=a?[i-1,s-1]:[i,s],l=a?[e-1,r-1]:[e,r],c=0;c<o;c++)for(var d=0;d<e;d++)for(var y=0;y<r;y++)for(var v=0;v<p;v++){var g=f[0]*d/l[0],m=f[1]*y/l[1],N=Math.floor(g),b=Math.min(i-1,Math.ceil(g)),w=Math.floor(m),S=Math.min(s-1,Math.ceil(m)),M=t.get(c,N,w,v),T=t.get(c,b,w,v),x=m-w,A=M+(t.get(c,N,S,v)-M)*x,k=A+(T+(t.get(c,b,S,v)-T)*x-A)*(g-N);h.set(k,c,d,y,v)}return h.toTensor()},t.prototype.batchNormalization4D=function(t,e,r,a,n,o){for(var i=t.dataSync(),s=e.dataSync(),p=r.dataSync(),u=n?n.dataSync():new Float32Array([1]),f=o?o.dataSync():new Float32Array([0]),l=new Float32Array(i.length),c=0;c<i.length;c++)l[c]=f[c%f.length]+(i[c]-s[c%s.length])*u[c%u.length]/Math.sqrt(p[c%p.length]+a);return h.tensor4d(l,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,r,a,n,o){for(var i=u.buffer(t.shape,"float32"),s=e,p=i.shape[1]-1,h=i.shape[2]-1,f=i.shape[3]-1,l=function(e,r,a,n){for(var o=0,i=Math.max(0,n-s);i<=Math.min(n+s,f);i++){var p=t.get(e,r,a,i);o+=p*p}return o},c=function(e,r,a,n){for(var o=0,i=Math.max(0,r-s);i<=Math.min(r+s,p);i++)for(var u=Math.max(0,a-s);u<=Math.min(a+s,h);u++)o+=Math.pow(t.get(e,i,u,n),2);return o},d=0;d<i.shape[0];d++)for(var y=0;y<=i.shape[1];y++)for(var v=0;v<i.shape[2];v++)for(var g=0;g<i.shape[3];g++){var m="withinChannel"===o?c(d,y,v,g):l(d,y,v,g),N=t.get(d,y,v,g)*Math.pow(r+a*m,-n);i.set(N,d,y,v,g)}return i.toTensor()},t.prototype.multinomial=function(t,e,r){for(var n=t.shape[0],o=t.shape[1],i=u.zeros([n,e],"int32"),s=i.dataSync(),p=t.dataSync(),h=0;h<n;++h){var f=h*o,l=new Float32Array(o-1);l[0]=p[f];for(var c=1;c<l.length;++c)l[c]=l[c-1]+p[f+c];for(var d=a.alea(r.toString()),y=h*e,v=0;v<e;++v){var g=d();s[y+v]=l.length;for(var m=0;m<l.length;m++)if(g<l[m]){s[y+v]=m;break}}}return i},t.prototype.oneHot=function(t,e,r,a){var n=new Float32Array(t.size*e);n.fill(a);for(var o=0;o<t.size;++o)n[o*e+t.get(o)]=r;return u.tensor2d(n,[t.size,e])},t.prototype.broadcastedBinaryOp=function(t,e,r,a){for(var n=s.assertAndGetBroadcastShape(t.shape,e.shape),o=u.buffer(n,r),i=t.dataSync(),p=e.dataSync(),h=s.getBroadcastDims(t.shape,n),f=s.getBroadcastDims(e.shape,n),l=function(r){var n=o.indexToLoc(r),s=n.slice(-t.rank);h.forEach(function(t){return s[t]=0});var u=t.locToIndex(s),l=n.slice(-e.rank);f.forEach(function(t){return l[t]=0});var c=e.locToIndex(l);o.values[r]=a(i[u],p[c])},c=0;c<o.values.length;++c)l(c);return o.toTensor()},t.prototype.dispose=function(){},t}();exports.MathBackendCPU=y,n.ENV.registerBackend("cpu",function(){return new y});var v=function(e){function r(t){void 0===t&&(t=!1);return console.warn("new NDArrayMathCPU() is deprecated. Please use dl.setBackend('cpu')."),e.call(this,"cpu",t)||this}return t(r,e),r}(o.NDArrayMath);exports.NDArrayMathCPU=v;
},{"seedrandom":151,"../environment":10,"../math":14,"../ops/axis_util":72,"../ops/broadcast_util":73,"../ops/concat_util":68,"../ops/ops":40,"../ops/selu_util":74,"../tensor":15,"../types":16,"../util":12}],76:[function(require,module,exports) {
"use strict";function t(t){return t<=exports.PARALLELIZE_THRESHOLD?t:e(t,Math.floor(Math.sqrt(t)))}function e(t,e){for(var r=e;r<t;++r)if(t%r==0)return r;return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PARALLELIZE_THRESHOLD=30,exports.computeOptimalWindowSize=t;
},{}],78:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){return function(t,n,e){this.variableNames=["A"];var i=t.windowSize,a=t.batchSize,s=t.inSize,d=Math.ceil(s/i);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,d];var o="max"===n?">":"<",r=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+i+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+i+"; i++) {\n          int inIdx = "+r+";\n          float candidate = getA(batch, inIdx);\n          if (isNaN(candidate)) {\n            setOutput(candidate);\n            return;\n          }\n          if (candidate "+o+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}}();exports.ArgMinMaxProgram=t;
},{}],79:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,d=n.strideHeight,e=n.strideWidth,i=t-1-n.padInfo.top,r=o-1-n.padInfo.left,a=1/(t*o);this.userCode="\n      const ivec2 pads = ivec2("+i+", "+r+");\n      const float avgMultiplier = float("+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+d+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.AvgPool2DBackpropProgram=n;
},{}],80:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../ops/broadcast_util"),a=function(){return function(a,e,s,o,r,n){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],t.assertAndGetBroadcastShape(a,e),t.assertAndGetBroadcastShape(a,s);var i="0.0";null!=o&&(t.assertAndGetBroadcastShape(a,o),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var u="1.0";null!=r&&(t.assertAndGetBroadcastShape(a,r),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=a,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+u+";\n        float inv = scale / sqrt(variance + float("+n+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "}}();exports.BatchNormProgram=a;
},{"../../ops/broadcast_util":73}],81:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../ops/broadcast_util"),t="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";exports.ADD="return a + b;",exports.SUB="return a - b;",exports.MUL="return a * b;",exports.DIV="return a / b;",exports.POW="\n  return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",exports.EQUAL=t+"\n  return float(a == b);\n",exports.NOT_EQUAL=t+"\n  return float(a != b);\n",exports.LESS=t+"\n  return float(a < b);\n",exports.LESS_EQUAL=t+"\n  return float(a <= b);\n",exports.GREATER=t+"\n  return float(a > b);\n",exports.GREATER_EQUAL=t+"\n  return float(a >= b);\n",exports.LOGICAL_AND=t+"\n  return float(a >= 1.0 && b >= 1.0);\n",exports.LOGICAL_OR=t+"\n  return float(a >= 1.0 || b >= 1.0);\n",exports.LOGICAL_XOR=t+"\n  return float(a >= 1.0 ^^ b >= 1.0);\n",exports.PRELU="\n  return (a >= 0.0) ? a : b * a;\n",exports.PRELU_DER="\n  return (a > 0.0) ? 1.0 : ((a < 0.0) ? b : a);\n",exports.MAX=t+"\n  return max(a, b);\n",exports.MIN=t+"\n  return min(a, b);\n";var n=function(){return function(t,n,a){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(n,a),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}();exports.BinaryOpProgram=n;
},{"../../ops/broadcast_util":73}],82:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){return function(t,e,u){this.variableNames=["A"],this.outputShape=t;var n=e.toFixed(20),a=u.toFixed(20);this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, "+n+", "+a+"));\n      }\n    "}}();exports.ClipProgram=t;
},{}],83:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../ops/concat_util"),e=function(){return function(e,n){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=t.computeOutShape(e,n,1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+e[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+e[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "}}();exports.ConcatProgram=e;
},{"../../ops/concat_util":68}],84:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,o=n.strideWidth,d=n.padInfo.top,e=n.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+d+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+o+" - "+e+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DDerFilterProgram=n;var t=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,d=n.strideHeight,e=n.strideWidth,i=t-1-n.padInfo.top,r=o-1-n.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+r+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+d+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+o+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DDerInputProgram=t;
},{}],85:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.top,t=n.padInfo.left,d=n.strideHeight,o=n.strideWidth,i=n.filterHeight,r=n.filterWidth,a=4*Math.floor(n.inChannels/4),s=n.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+d+", "+o+");\n      const ivec2 pads = ivec2("+e+", "+t+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+r+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+a+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===s)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+a+") *\n                getW(wR, wC, "+a+", d2);\n            } else if ("+(2===s)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+a+"),\n                getX(batch, xR, xC, "+a+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+a+", d2),\n                getW(wR, wC, "+a+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===s)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+a+"),\n                getX(batch, xR, xC, "+a+" + 1),\n                getX(batch, xR, xC, "+a+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+a+", d2),\n                getW(wR, wC, "+a+" + 1, d2),\n                getW(wR, wC, "+a+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DProgram=n;
},{}],86:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.inHeight,e=n.inWidth,o=n.padInfo.top,i=n.padInfo.left,r=n.strideHeight,d=n.strideWidth,s=n.filterHeight,a=n.filterWidth,C=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+d+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+C+";\n        int q = d2 - d1 * "+C+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+e+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.DepthwiseConv2DProgram=n;
},{}],87:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){return function(e){this.variableNames=["A"];var t=e[0],n=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+t+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}}();exports.FromPixelsProgram=e;
},{}],131:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../../environment"),e=require("../../util"),t=require("../../ops/broadcast_util"),r=require("./tex_util");function o(n,e,t,r){var o=i(),u=a(),s=n.map(function(n){return"uniform sampler2D "+n.name+";"}).join("\n"),v=n.map(function(n){return c(n,e,r)}).join("\n"),x=e.texShape,d=l(e.logicalShape,x);return[C,o,u,s,d,v,t].join("\n")}function i(){return n.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?h:p}function a(){return n.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?m:f}function u(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return y(n);case 1:return S(n);case 2:return T(n);case 3:return U(n);case 4:return D(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function c(n,t,r){var o=E(n);return o+=u(n),(r||e.arraysEqual(n.shapeInfo.logicalShape,t.logicalShape))&&(o+=A(n,t,r)),o}function l(n,e){switch(n.length){case 0:return g();case 1:return R(n,e);case 2:return N(n,e);case 3:return w(n,e);case 4:return V(n,e);default:throw new Error(n.length+"-D output sampling is not yet supported")}}exports.makeShader=o;var s="\nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",v="\nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",x="\nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",d="\nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",p="\n  uniform float NaN;\n\n  const vec4 floatDeltas = vec4(\n      1.0,\n      1.0 / 255.0,\n      1.0 / (255.0 * 255.0),\n      1.0 / (255.0 * 255.0 * 255.0)\n  );\n  const float minValue = "+r.FLOAT_MIN+".0;\n  const float maxValue = "+r.FLOAT_MAX+".0;\n  const float range = (maxValue - minValue) / 255.0;\n  const vec2 dotRange = vec2(1.0, range);\n\n  float sample(sampler2D texture, vec2 uv) {\n    vec4 sampleValue = texture2D(texture, uv);\n    if (all(equal(sampleValue, vec4("+r.BYTE_NAN_VALUE+")))) {\n      return NaN;\n    }\n\n    vec4 encValue = floor(sampleValue * 255.0 + 0.5);\n    float decodedValue = dot(encValue, floatDeltas);\n    return dot(vec2(minValue, decodedValue), dotRange);\n  }\n",f="\n  const vec4 floatPowers = vec4(\n    1.0,\n    255.0,\n    255.0 * 255.0,\n    255.0 * 255.0 * 255.0\n  );\n  const vec2 recipRange = vec2(1.0/range);\n  const vec2 recipRange255 = vec2(1.0/(maxValue - minValue));\n\n  void setOutput(float decodedValue) {\n    if (isNaN(decodedValue)) {\n      gl_FragColor = vec4("+r.BYTE_NAN_VALUE+");\n      return;\n    }\n\n    float a = dot(vec2(decodedValue, -minValue), recipRange);\n    float b = fract(a) * 255.0;\n    float c = fract(b) * 255.0;\n    float d = fract(c) * 255.0;\n    gl_FragColor = floor(vec4(a, b, c, d)) / 255.0;\n\n    // TODO(dsmilkov): Version above gets better accuracy but probably slower\n    // than the version below. Benchmark to determine if the accuracy is worth\n    // the cost.\n\n    // float normValue = dot(vec2(decodedValue, -minValue), recipRange255);\n    // vec4 f = normValue * floatPowers;\n    // gl_FragColor = floor(fract(f) * 255.0) / 255.0;\n  }\n",h="\n  float sample(sampler2D texture, vec2 uv) {\n    return texture2D(texture, uv).r;\n  }\n",m="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",C="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  bool isNaN(float val) {\n    float v1 = val * val;\n    float v2 = val * val;\n    return v1 == v2 ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  const vec2 randomConst = vec2(\n    23.14069263277926, // e^pi (Gelfond's constant)\n     2.665144142690225 // 2^sqrt(2) (GelfondSchneider constant)\n  );\n\n  float random(float seed) {\n      return fract(cos(dot(resultUV * seed, randomConst)) * 12345.6789);\n  }\n\n  "+s+"\n  "+v+"\n  "+x+"\n  "+d+"\n";function g(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function R(n,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}function w(n,e){var t=n[1]*n[2],r=n[2];return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t+";\n      index -= r * "+t+";\n      int c = index / "+r+";\n      int d = index - c * "+r+";\n      return ivec3(r, c, d);\n    }\n  "}function V(n,e){var t=n[3],r=n[2]*t,o=n[1]*r;return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      int r = index / "+o+";\n      index -= r * "+o+";\n\n      int c = index / "+r+";\n      index -= c * "+r+";\n\n      int d = index / "+t+";\n      int d2 = index - d * "+t+";\n\n      return ivec4(r, c, d, d2);\n    }\n  "}function N(n,t){return e.arraysEqual(n,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===n[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===n[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+n[1]+";\n      int c = index - r * "+n[1]+";\n      return ivec2(r, c);\n    }\n  "}function y(n){var e=n.name;return"\n    float "+("get"+e.charAt(0).toUpperCase()+e.slice(1))+"() {\n      return sample("+e+", halfCR);\n    }\n  "}function S(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);return"\n    float "+t+"(int index) {\n      return "+t+"Flat(index);\n    }\n  "}function T(n){var t=n.shapeInfo.logicalShape,r=n.shapeInfo.texShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[0],c=r[1];if(e.arraysEqual(t,r))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+c+".0, "+a+".0);\n      return sample("+o+", uv);\n    }\n  ";var l=e.squeezeShape(t),s=l.newShape,v=l.keptDims,x=s;if(x.length<t.length){return"\n      "+u(I(n,x))+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+b(["row","col"],v)+");\n      }\n    "}return 1===c?"\n    float "+i+"(int row, int col) {\n      int index = row * "+t[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+a+".0);\n      return sample("+o+", uv);\n    }\n  ":1===a?"\n    float "+i+"(int row, int col) {\n      int index = row * "+t[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+c+".0, 0.5);\n      return sample("+o+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    vec2 uv = UVfrom2D("+a+", "+c+", "+t[1]+", row, col);\n    return sample("+o+", uv);\n  }\n"}function U(n){var t=n.shapeInfo.texShape,r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=t[0],c=t[1],l=r[1]*r[2],s=r[2],v=e.squeezeShape(r),x=v.newShape,d=v.keptDims,p=x;if(p.length<r.length){return"\n        "+u(I(n,p))+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+b(["row","col","depth"],d)+");\n        }\n      "}return c===l?"\n        float "+i+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+s+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+c+".0, "+a+".0);\n          return sample("+o+", uv);\n        }\n      ":c===s?"\n    float "+i+"(int row, int col, int depth) {\n      int texR = row * "+r[1]+" + col;\n      int texC = depth;\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+c+".0, "+a+".0);\n      return sample("+o+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+a+", "+c+", "+l+", "+s+", row, col, depth);\n        return sample("+o+", uv);\n      }\n  "}function D(n){var t=n.shapeInfo.logicalShape,r=n.shapeInfo.texShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[0],c=r[1],l=t[3],s=t[2]*l,v=t[1]*s,x=e.squeezeShape(t),d=x.newShape,p=x.keptDims;if(d.length<t.length){return"\n      "+u(I(n,d))+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+b(["row","col","depth","depth2"],p)+");\n      }\n    "}return c===v?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+s+" + depth * "+l+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+c+".0, "+a+".0);\n        return sample("+o+", uv);\n      }\n    ":c===l?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" + depth;\n        int texC = depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+c+".0, "+a+".0);\n        return sample("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+a+", "+c+", "+v+", "+s+",\n          "+l+", row, col, depth, depth2);\n      return sample("+o+", uv);\n    }\n  "}function E(n){var e=n.name,t=n.shapeInfo.texShape,r="get"+e.charAt(0).toUpperCase()+e.slice(1)+"Flat",o=t[0],i=t[1];return 1===i&&1===o?"\n      float "+r+"(int index) {\n        return sample("+e+", halfCR);\n      }\n    ":1===i?"\n      float "+r+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+o+".0);\n        return sample("+e+", uv);\n      }\n    ":1===o?"\n      float "+r+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+i+".0, 0.5);\n        return sample("+e+", uv);\n      }\n    ":"\n    float "+r+"(int index) {\n      vec2 uv = UVfrom1D("+o+", "+i+", index);\n      return sample("+e+", uv);\n    }\n  "}function O(n,e,r,o){var i=n.shapeInfo.logicalShape.length,a=e.logicalShape.length,u="int";2===a?u="ivec2":3===a?u="ivec3":4===a&&(u="ivec4");var c=t.getBroadcastDims(n.shapeInfo.logicalShape,e.logicalShape),l=a-i;return"\n    float "+o+"() {\n      "+u+" coords = getOutputCoords();\n      "+(0===i?"":a<2&&c.length>=1?"coords = 0;":c.map(function(n){return"coords["+(n+l)+"] = 0;"}).join("\n"))+"\n      return get"+r+"("+(a<2&&i>0?"coords":n.shapeInfo.logicalShape.map(function(n,e){return"coords["+(e+l)+"]"}).join(", "))+");\n    }\n  "}function A(n,r,o){var i=n.shapeInfo.texShape,a=n.name,u=a.charAt(0).toUpperCase()+a.slice(1),c="get"+u+"AtOutCoords",l=t.getBroadcastDims(n.shapeInfo.logicalShape,r.logicalShape),s=n.shapeInfo.logicalShape.length,v=r.logicalShape.length,x=o&&(v>s||l.length>0),d=t.broadcastDimsAreOuter(l);if(x&&!d)return O(n,r,u,c);var p=r.texShape;if(e.arraysEqual(i,p))return"\n      float "+c+"() {\n        return sample("+a+", resultUV);\n      }\n    ";var f=e.sizeFromShape(i),h="";return x&&d&&(h="\n        int mainPart = index / "+f+";\n        index -= mainPart * "+f+";\n      "),"\n    float "+c+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+p[0]+", "+p[1]+"));\n      int index = resTexRC.x * "+p[1]+" + resTexRC.y;\n      "+h+"\n      int texR = index / "+i[1]+";\n      int texC = index - texR * "+i[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+i[1]+".0, "+i[0]+".0);\n\n      return sample("+a+", uv);\n    }\n  "}function _(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";throw Error("GPU for rank "+n+" is not yet supported")}function I(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function b(n,e){return e.map(function(e){return n[e]}).join(", ")}exports.getCoordsDataType=_;
},{"../../environment":10,"../../util":12,"../../ops/broadcast_util":73,"./tex_util":102}],88:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./shader_compiler"),r=function(){return function(r,s,n){this.variableNames=["A","indices"];var i=r.slice();i[n]=s,this.outputShape=i,this.rank=i.length;var o=e.getCoordsDataType(this.rank),a=t(r,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "}}();function t(e,r){var t=e.length;if(t>4)throw Error("Gather for rank "+t+" is not yet supported");if(1===t)return"int(getIndices(resRC))";for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],i=0;i<e.length;i++)i===r?n.push("int(getIndices("+s[i]+"))"):n.push(""+s[i]);return n.join()}exports.GatherProgram=r;
},{"./shader_compiler":131}],43:[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(o,n){function u(t){try{s(i.next(t))}catch(t){n(t)}}function a(t){try{s(i.throw(t))}catch(t){n(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,a)}s((i=i.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var r,i,o,n,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../environment"),i=require("../../util"),o=require("./gpgpu_util"),n=require("./tex_util"),u=require("./webgl_util"),a=function(){function a(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.firstProgram=!0,this.gl=null!=t?t:o.createWebGLContext(),1===r.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=u.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float")):this.colorBufferFloatExtension=u.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=u.getExtensionOrThrow(this.gl,"WEBGL_lose_context"),r.ENV.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")&&(this.getBufferSubDataAsyncExtension=this.gl.getExtension("WEBGL_get_buffer_sub_data_async")),this.vertexBuffer=o.createVertexBuffer(this.gl),this.indexBuffer=o.createIndexBuffer(this.gl),this.framebuffer=u.createFramebuffer(this.gl)}return a.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;u.callAndCheck(e,function(){return e.finish()}),u.callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),u.callAndCheck(e,function(){return e.deleteFramebuffer(t.framebuffer)}),u.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),u.callAndCheck(e,function(){return e.deleteBuffer(t.vertexBuffer)}),u.callAndCheck(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),u.callAndCheck(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.loseContextExtension.loseContext(),this.disposed=!0}},a.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,u.enableDebugWebGLErrorChecking(t)},a.prototype.createMatrixTexture=function(t,e){return this.throwIfDisposed(),o.createMatrixTexture(this.gl,t,e)},a.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),o.uploadPixelDataToTexture(this.gl,t,e)},a.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),o.createPackedMatrixTexture(this.gl,t,e)},a.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(u.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),u.callAndCheck(this.gl,function(){return e.gl.deleteTexture(t)})},a.prototype.uploadMatrixToTexture=function(t,e,r,i){this.throwIfDisposed();return o.uploadMatrixToTexture(this.gl,t,e,r,i,1)},a.prototype.uploadMatrixToPackedTexture=function(t,e,r,i){return this.throwIfDisposed(),o.uploadMatrixToPackedTexture(this.gl,t,e,r,i)},a.prototype.downloadMatrixFromTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return o.downloadMatrixFromOutputTexture(i.gl,e,r)})},a.prototype.downloadMatrixFromTextureAsync=function(r,i,n){return t(this,void 0,void 0,function(){var t=this;return e(this,function(e){if(null==this.getBufferSubDataAsyncExtension)throw new Error("Cannot download matrix from output texture asynchronously, WEBGL_get_buffer_sub_data_async is not enabled.");return[2,this.downloadMatrixDriverAsync(r,function(){return o.downloadMatrixFromOutputTextureAsync(t.gl,t.getBufferSubDataAsyncExtension,i,n)})]})})},a.prototype.downloadMatrixFromRGBAColorTexture=function(t,e,r,i){var n=this;return this.downloadMatrixDriver(t,function(){return o.downloadMatrixFromRGBAColorTexture(n.gl,e,r,i)})},a.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return o.downloadMatrixFromPackedOutputTexture(i.gl,e,r)})},a.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=u.createFragmentShader(e,t),i=o.createVertexShader(e),n=u.createProgram(e);return u.callAndCheck(e,function(){return e.attachShader(n,i)}),u.callAndCheck(e,function(){return e.attachShader(n,r)}),u.linkProgram(e,n),this.autoDebugValidate&&u.validateProgram(e,n),this.firstProgram&&(this.firstProgram=!1,this.setProgram(n),o.bindVertexProgramAttributeStreams(e,this.program,this.vertexBuffer)),n},a.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&u.callAndCheck(this.gl,function(){return e.gl.deleteProgram(t)})},a.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&u.validateProgram(this.gl,this.program),u.callAndCheck(this.gl,function(){return e.gl.useProgram(t)})},a.prototype.getUniformLocation=function(t,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?u.getProgramUniformLocationOrThrow(this.gl,t,e):u.getProgramUniformLocation(this.gl,t,e)},a.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),u.callAndCheck(this.gl,function(){return r.gl.getAttribLocation(t,e)})},a.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},a.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),u.bindTextureToProgramUniformSampler(this.gl,this.program,t,e,r)},a.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},a.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var i=n.getPackedMatrixTextureShapeWidthHeight(e,r),o=i[0],u=i[1];this.setOutputMatrixTextureDriver(t,o,u)},a.prototype.setOutputMatrixWriteRegion=function(t,e,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,e)},a.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},a.prototype.debugValidate=function(){null!=this.program&&u.validateProgram(this.gl,this.program),u.validateFramebuffer(this.gl)},a.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),u.callAndCheck(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},a.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),u.callAndCheck(this.gl,function(){return t.gl.finish()})},a.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=u.getExtensionOrThrow(this.gl,2===r.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},a.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},a.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},a.prototype.runQuery=function(t){var e=this.beginQuery();return t(),this.endQuery(),this.pollQueryTime(e)},a.prototype.beginQuery=function(){if(2===r.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),i=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,i),i}var o=this.getQueryTimerExtensionWebGL1(),n=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),n},a.prototype.endQuery=function(){if(2!==r.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,i=this.getQueryTimerExtensionWebGL2();e.endQuery(i.TIME_ELAPSED_EXT)}},a.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE),n=this.gl.getParameter(i.GPU_DISJOINT_EXT);return o&&!n}o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT),n=this.gl.getParameter(i.GPU_DISJOINT_EXT);return o&&!n},a.prototype.pollQueryTime=function(t){var e=this;return new Promise(function(o,n){var u=r.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION");i.repeatedTry(function(){return e.isQueryAvailable(t,u)}).then(function(){return o(e.getQueryTime(t,u))}).catch(function(){console.warn("Disjoint query timer never available."),o(-1)})})},a.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)/1e6},a.prototype.downloadMatrixDriverSetup=function(t){this.throwIfDisposed(),u.bindColorTextureToFramebuffer(this.gl,t,this.framebuffer),this.autoDebugValidate&&u.validateFramebuffer(this.gl)},a.prototype.downloadMatrixDriverTeardown=function(){null!=this.outputTexture?(u.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&u.validateFramebuffer(this.gl)):u.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},a.prototype.downloadMatrixDriver=function(t,e){this.downloadMatrixDriverSetup(t);var r=e();return this.downloadMatrixDriverTeardown(),r},a.prototype.downloadMatrixDriverAsync=function(r,i){return t(this,void 0,void 0,function(){var t;return e(this,function(e){switch(e.label){case 0:return this.downloadMatrixDriverSetup(r),[4,i()];case 1:return t=e.sent(),this.downloadMatrixDriverTeardown(),[2,t]}})})},a.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var i=this.gl;u.bindColorTextureToFramebuffer(i,t,this.framebuffer),this.autoDebugValidate&&u.validateFramebuffer(i),this.outputTexture=t,u.callAndCheck(i,function(){return i.viewport(0,0,e,r)}),u.callAndCheck(i,function(){return i.scissor(0,0,e,r)})},a.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,i){var o=this;this.throwIfDisposed(),u.callAndCheck(this.gl,function(){return o.gl.scissor(t,e,r,i)})},a.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},a.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},a}();exports.GPGPUContext=a;
},{"../../environment":10,"../../util":12,"./gpgpu_util":41,"./tex_util":102,"./webgl_util":42}],89:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../environment"),a=require("../../util"),r=require("./shader_compiler"),t="NaN";function o(){return!e.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")}function n(e,a,n,i){for(var s=a.userCode,u=n.map(function(e,r){var t={logicalShape:e.tensor.shape,texShape:e.texData.texShape};return{name:a.variableNames[r],shapeInfo:t}}),p=u.map(function(e){return e.shapeInfo}),h={logicalShape:i.tensor.shape,texShape:i.texData.texShape},c=r.makeShader(u,h,s,!0===a.supportsBroadcasting),f=e.createProgram(c),m={},g=0;g<a.variableNames.length;g++){var l=a.variableNames[g];m[l]=e.getUniformLocation(f,l)}if(o()){m[t]=e.getUniformLocation(f,t,!1)}return{program:a,source:c,webGLProgram:f,uniformLocations:m,gpgpu:e,inShapeInfos:p,outShapeInfo:h}}function i(e,r){if(e.length!==r.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+r.length+" inputs");e.forEach(function(e,t){var o=e.logicalShape,n=e.texShape,i=r[t].tensor.shape,s=r[t].texData.texShape;if(!a.arraysEqual(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!a.arraysEqual(n,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+n+" and "+s+" must match")})}function s(e,a,r,n){i(e.inShapeInfos,a),i([e.outShapeInfo],[r]);var s=r.texData.texture,u=r.texData.texShape,p=e.gpgpu;p.setOutputMatrixTexture(s,u[0],u[1]),p.setProgram(e.webGLProgram),a.forEach(function(a,r){var t=a.texData.texture,o=e.program.variableNames[r],n=e.uniformLocations[o];p.setInputMatrixTexture(t,n,r)}),o()&&p.gl.uniform1f(e.uniformLocations[t],NaN),null!=n&&n(p,e.webGLProgram),p.executeProgram()}function u(e,a,r){var t="";a.concat(r).forEach(function(e){t+=e.tensor.shape+"_"+e.texData.texShape});var o=e.userCode,n=(!0===e.supportsBroadcasting).toString(),i=e.constructor.name;return i+="_"+n+"_"+t+"_"+o}exports.compileProgram=n,exports.runProgram=s,exports.makeShaderKey=u;
},{"../../environment":10,"../../util":12,"./shader_compiler":131}],90:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./shader_compiler"),r=function(){return function(r,t,s){var o,n;if(this.variableNames=["c","a","b"],this.outputShape=t,s>4)throw Error("Where for rank "+s+" is not yet supported");if(1===s)n="resRC",o="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],i=[],p=0;p<t.length;p++)i.push(""+a[p]),p<r&&u.push(""+a[p]);o=u.join(),n=i.join()}var h=e.getCoordsDataType(s);this.userCode="\n      void main() {\n        "+h+" resRC = getOutputCoords();\n        float cVal = getC("+o+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+n+"));\n        } else {\n          setOutput(getB("+n+"));\n        }\n      }\n    "}}();exports.WhereProgram=r;
},{"./shader_compiler":131}],91:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n,t,o,i,r,d){this.variableNames=["x"],this.outputShape=[];var s,e=t,a=n[1]-1,u=n[2]-1,c=n[3]-1;this.outputShape=n;var l="float("+o+") + float("+i+") * sum";s=.5===r?"inversesqrt("+l+")":1===r?"1.0/("+l+")":"exp(log("+l+") * float(-"+r+"));",this.userCode="withinChannel"===d?"\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int b = coords[0];\n          int r = coords[1];\n          int c = coords[2];\n          int d = coords[3];\n          float x = getX(b, r, c, d);\n          float sum = 0.0;\n          for (int u = -"+e+"; u <= "+e+"; u++) {\n            for (int v = -"+e+"; v <= "+e+"; v++) {\n              int idx = r + u;\n              int idy = c + v;\n              if (idx >= 0 && idx <= "+a+" && idy >= 0 && idy <= "+u+") {\n                float z = getX(b, idx, idy, d);\n                sum += z * z;\n              }\n            }\n          }\n          float val = x * "+s+";\n          setOutput(val);\n        }\n      ":"\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int b = coords[0];\n          int r = coords[1];\n          int c = coords[2];\n          int d = coords[3];\n          float x = getX(b, r, c, d);\n          float sum = 0.0;\n          for (int j = -"+e+"; j <= "+e+"; j++) {\n            int idx = d + j;\n            if (idx >= 0 && idx <=  "+c+") {\n              float z = getX(b, r, c, idx);\n              sum += z * z;\n            }\n          }\n          float val = x * "+s+";\n          setOutput(val);\n        }\n      "}}();exports.LRNProgram=n;
},{}],92:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,e=n.strideHeight,d=n.strideWidth,i=t-1-n.padInfo.top,r=o-1-n.padInfo.left,a=t*o-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+r+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+d+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+a+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.MaxPool2DBackpropProgram=n;
},{}],93:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){return function(t,n,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"];var r=e?t[1]:t[0],a=i?n[0]:n[1],o=e?t[0]:t[1];this.outputShape=[r,a];var u=function(t,n){return e?n+" + "+t+", aRow":"aRow, "+n+" + "+t},x=function(t,n){return i?"bCol, "+n+" + "+t:n+" + "+t+", bCol"},M=4*Math.floor(o/4),s=o%4;this.userCode=" float dotARowBCol(int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+M+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+u(0,"i")+"),\n          getMatrixA("+u(1,"i")+"),\n          getMatrixA("+u(2,"i")+"),\n          getMatrixA("+u(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+x(0,"i")+"),\n          getMatrixB("+x(1,"i")+"),\n          getMatrixB("+x(2,"i")+"),\n          getMatrixB("+x(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===s)+") {\n        result += getMatrixA("+u(0,M)+") *\n          getMatrixB("+x(0,M)+");\n      } else if ("+(2===s)+") {\n        vec2 a = vec2(\n          getMatrixA("+u(0,M)+"),\n          getMatrixA("+u(1,M)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+x(0,M)+"),\n          getMatrixB("+x(1,M)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===s)+") {\n        vec3 a = vec3(\n          getMatrixA("+u(0,M)+"),\n          getMatrixA("+u(1,M)+"),\n          getMatrixA("+u(2,M)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+x(0,M)+"),\n          getMatrixB("+x(1,M)+"),\n          getMatrixB("+x(2,M)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec2 resRC = getOutputCoords();\n      setOutput(dotARowBCol(resRC.x, resRC.y));\n    }\n    "}}();exports.MatMulProgram=t;
},{}],94:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function n(n,t,e){this.variableNames=["probs"],this.outputShape=[n,e],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,o){null==t.seedLoc&&(t.seedLoc=e.getUniformLocation(o,"seed")),e.gl.uniform1f(t.seedLoc,n)}},n}();exports.MultinomialProgram=n;
},{}],95:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){return function(t,e,o,n){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+n+"), float("+o+"),\n                      float(index == coords.y)));\n      }\n    "}}();exports.OneHotProgram=t;
},{}],96:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./shader_compiler"),n=function(){return function(n,e,o){this.variableNames=["x"],this.outputShape=e.map(function(t,e){return t[0]+n[e]+t[1]});var r=n.length,u=t.getCoordsDataType(r),s=e.map(function(t){return t[0]}).join(","),a=e.map(function(t,e){return t[0]+n[e]}).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+u+" start = "+u+"("+s+");\n      "+u+" end = "+u+"("+a+");\n\n      void main() {\n        "+u+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+o+"));\n        } else {\n          "+u+" coords = outC - start;\n          setOutput(getX("+i+"));\n        }\n      }\n    ":"\n        int start = "+s+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+o+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "}}();exports.PadProgram=n;
},{"./shader_compiler":131}],97:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var i=n.filterHeight,a=n.filterWidth,o=n.strideHeight,r=n.strideWidth,u=n.padInfo.top,l=n.padInfo.left;this.outputShape=n.outShape;var x="avg"===e,s="0.0";if(x||(s="min"===e?"1.0 / 0.0":"-1.0 / 0.0"),t){var c="min"===e?"<=":">=";this.userCode="\n        const ivec2 strides = ivec2("+o+", "+r+");\n        const ivec2 pads = ivec2("+u+", "+l+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+i+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+a+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              if (isNaN(value)) {\n                setOutput(value);\n                return;\n              }\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value "+c+" currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+a+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "}else{var C="min"===e?"min":"max",d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / "+i*a+".0");var v=4*Math.floor(a/4),R=a%4,f="\n      if (hasNaN(values)) {\n        setOutput(getNaN(values));\n        return;\n      }\n      if ("+x+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = "+C+"(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+r+");\n      const ivec2 pads = ivec2("+u+", "+l+");\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+s+");\n        float avgValue = 0.0;\n\n        for (int wR = 0; wR < "+i+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              getValue(batch, xR, xC + 3, d)\n            );\n\n            "+f+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===R)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n            "+f+"\n          } else if ("+(2===R)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+f+"\n          } else if ("+(3===R)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+f+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}}}();exports.Pool2DProgram=n;
},{}],98:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){return function(n,i){this.variableNames=["x"];var e=n.windowSize,a=n.batchSize,t=n.inSize,u=Math.ceil(t/e);this.outputShape=[a,u];var l="sum"===i,o="0.0";l||(o="min"===i?"1.0 / 0.0":"-1.0 / 0.0");var s="min"===i?"min":"max",c=i+"("+i+"("+i+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===i&&(c="sumValue");var d=4*Math.floor(e/4),v=e%4,x="\n      if ("+l+") {\n        sumValue += dot(values, ones);\n      } else {\n        if (hasNaN(values)) {\n          setOutput(getNaN(values));\n          return;\n        }\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",V="";t%e>0&&(V="\n        if (inIdx < 0 || inIdx >= "+t+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+V+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+d+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+x+"\n        }\n\n        int inIdx = inOffset + "+d+";\n        if ("+(1===v)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n          "+x+"\n        } else if ("+(2===v)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n          "+x+"\n        } else if ("+(3===v)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n          "+x+"\n        }\n        setOutput("+c+");\n      }\n    "}}();exports.ReduceProgram=n;
},{}],99:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){return function(e,t,o,n){this.variableNames=["A"],this.outputShape=[];var r=e[0],c=e[1],i=e[2],u=e[3];this.outputShape=[r,t,o,u];var s=n?[c-1,i-1]:[c,i],a=n?[t-1,o-1]:[t,o];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/a[0]+",\n          "+s[1]/a[1]+");\n      const vec2 inputShapeRC = vec2("+c+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}}();exports.ResizeBilinearProgram=e;
},{}],100:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./shader_compiler"),t=function(){return function(t,r){this.variableNames=["x"];var o=t.length;if(o>4)throw new Error("WebGL backend: Reverse of rank-"+o+" tensor is not yet supported");if(this.outputShape=t,1!==o){var n=t.map(function(e,o){return function(e){return-1!==r.indexOf(e)&&1!==t[e]?t[e]+" - coords["+e+"] - 1":"coords["+e+"]"}(o)}).join(","),s=e.getCoordsDataType(o);this.userCode="\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+n+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "}}();exports.ReverseProgram=t;
},{"./shader_compiler":131}],101:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./shader_compiler"),t=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e=r.getCoordsDataType(this.rank),n=o(this.rank);this.userCode="\n      uniform "+e+" start;\n\n      void main() {\n        "+e+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(r){var t=this;if(r.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+r.length+")");return function(o,e){if(null!=t.startLoc||(t.startLoc=o.getUniformLocationNoThrow(e,"start"),null!=t.startLoc))if(1===t.rank)o.gl.uniform1i(t.startLoc,r[0]);else if(2===t.rank)o.gl.uniform2i(t.startLoc,r[0],r[1]);else if(3===t.rank)o.gl.uniform3i(t.startLoc,r[0],r[1],r[2]);else{if(4!==t.rank)throw Error("Slicing for rank "+t.rank+" is not yet supported");o.gl.uniform4i(t.startLoc,r[0],r[1],r[2],r[3])}}},t}();function o(r){if(1===r)return"sourceLoc";if(2===r)return"sourceLoc.x, sourceLoc.y";if(3===r)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===r)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+r+" is not yet supported")}exports.SliceProgram=t;
},{"./shader_compiler":131}],103:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./tex_util"),t=function(){function t(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.allocatedTextures=[],this.usedTextureCount={}}return t.prototype.acquireTexture=function(t,s){void 0===s&&(s=e.TextureType.FLOAT);var r=u(t,s);if(r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextureCount||(this.usedTextureCount[r]=0),this.usedTextureCount[r]++,this.freeTextures[r].length>0)return this.numFreeTextures--,this.numUsedTextures++,this.log(),this.freeTextures[r].shift();this.numUsedTextures++,this.log();var i=this.gpgpu.createMatrixTexture(t[0],t[1]);return this.allocatedTextures.push(i),i},t.prototype.releaseTexture=function(t,s,r){void 0===r&&(r=e.TextureType.FLOAT);var i=u(s,r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--,this.usedTextureCount[i]--,this.log()},t.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var e=this;null!=this.allocatedTextures&&(this.allocatedTextures.forEach(function(t){e.gpgpu.deleteMatrixTexture(t)}),this.freeTextures=null,this.allocatedTextures=null,this.usedTextureCount=null,this.numUsedTextures=0,this.numFreeTextures=0)},t}();function u(e,t){return e[0]+"_"+e[1]+"_"+t}exports.TextureManager=t;
},{"./tex_util":102}],104:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./shader_compiler"),e=function(){return function(e,n){this.variableNames=["A"];for(var o=new Array(e.length),s=0;s<o.length;s++)o[s]=e[s]*n[s];this.outputShape=o,this.rank=o.length;var i=r.getCoordsDataType(this.rank),a=t(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "}}();function t(r){var e=r.length;if(e>4)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+r[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],o=0;o<r.length;o++)n.push("imod("+t[o]+", "+r[o]+")");return n.join()}exports.TileProgram=e;
},{"./shader_compiler":131}],105:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./shader_compiler"),e=function(){return function(e,n){this.variableNames=["A"];for(var s=new Array(e.length),o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;var a=r.getCoordsDataType(this.rank),i=t(n);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "}}();function t(r){var e=r.length;if(e>4)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=new Array(e),s=0;s<r.length;s++)n[r[s]]=t[s];return n.join()}exports.TransposeProgram=e;
},{"./shader_compiler":131}],106:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../../ops/selu_util"),r=function(){return function(n,r){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+r+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}();exports.UnaryOpProgram=r;var e="\n  if (isNaN(x)) return x;\n";function t(n){return"\n    return (x >= 0.0) ? x : "+n+" * x;\n  "}function x(n){return void 0===n&&(n=0),e+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "}exports.ABS="\n  return abs(x);\n",exports.RELU=e+"\n  return (x < 0.0) ? 0.0 : x;\n",exports.ELU="\n  return (x >= 0.0) ? x : (exp(x) - 1.0);\n",exports.ELU_DER="\n  return (x >= 0.0) ? 1.0 : exp(x);\n",exports.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+n.SELU_SCALEALPHA+";\n  float scale = "+n.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",exports.LEAKY_RELU=t,exports.STEP=x,exports.NEG="\n  return -x;\n",exports.CEIL="\n  return ceil(x);\n",exports.FLOOR="\n  return floor(x);\n",exports.EXP="\n  return exp(x);\n",exports.LOG="\n  return log(x);\n",exports.SQRT=e+"\n  return sqrt(x);\n",exports.SIGMOID="\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",exports.SIN=e+"\n  return sin(x);\n",exports.COS=e+"\n  return cos(x);\n",exports.TAN="\n  return tan(x);\n",exports.ASIN=e+"\n  return asin(x);\n",exports.ACOS=e+"\n  return acos(x);\n",exports.ATAN=e+"\n  return atan(x);\n",exports.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",exports.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",exports.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",exports.SQUARE="\n  return x * x;\n",exports.LOGICAL_NOT=e+"\n  return float(!(x >= 1.0));\n",exports.TO_INT="\n  return float(int(x));\n";
},{"../../ops/selu_util":74}],30:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),t=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function p(e){try{u(n.next(e))}catch(e){o(e)}}function i(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(p,i)}u((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var r,n,a,o,p={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;p;)try{if(r=1,n&&(a=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return p.label++,{value:o[1],done:!1};case 5:p.label++,n=o[1],o=[0];continue;case 7:o=p.ops.pop(),p.trys.pop();continue;default:if(!(a=(a=p.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){p=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){p.label=o[1];break}if(6===o[0]&&p.label<a[1]){p.label=a[1],a=o;break}if(a&&p.label<a[2]){p.label=a[2],p.ops.push(o);break}a[2]&&p.ops.pop(),p.trys.pop();continue}o=t.call(e,p)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../environment"),a=require("../math"),o=require("../ops/axis_util"),p=require("../ops/reduce_util"),i=require("../tensor"),u=require("../types"),s=require("../util"),h=require("./webgl/argminmax_gpu"),l=require("./webgl/avg_pool_backprop_gpu"),c=require("./webgl/batchnorm_gpu"),m=require("./webgl/binaryop_gpu"),g=require("./webgl/binaryop_gpu"),y=require("./webgl/clip_gpu"),d=require("./webgl/concat_gpu"),f=require("./webgl/conv_backprop_gpu"),w=require("./webgl/conv_gpu"),v=require("./webgl/conv_gpu_depthwise"),A=require("./webgl/from_pixels_gpu"),O=require("./webgl/gather_gpu"),P=require("./webgl/gpgpu_context"),R=require("./webgl/gpgpu_math"),x=require("./webgl/logical_gpu"),S=require("./webgl/lrn_gpu"),b=require("./webgl/max_pool_backprop_gpu"),_=require("./webgl/mulmat_gpu"),T=require("./webgl/multinomial_gpu"),E=require("./webgl/onehot_gpu"),D=require("./webgl/pad_gpu"),U=require("./webgl/pool_gpu"),N=require("./webgl/reduce_gpu"),M=require("./webgl/resize_bilinear_gpu"),k=require("./webgl/reverse_gpu"),I=require("./webgl/slice_gpu"),q=require("./webgl/tex_util"),L=require("./webgl/texture_manager"),B=require("./webgl/tile_gpu"),G=require("./webgl/transpose_gpu"),C=require("./webgl/unaryop_gpu"),W=require("./webgl/unaryop_gpu"),z=require("./webgl/webgl_util"),F=function(){function e(e,t){if(void 0===t&&(t=!0),this.gpgpu=e,this.delayedStorage=t,this.texData=new WeakMap,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,n.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");null==e?(this.gpgpu=new P.GPGPUContext,this.gpgpuCreatedLocally=!0):this.gpgpuCreatedLocally=!1,"undefined"!=typeof document&&(this.canvas=document.createElement("canvas")),this.textureManager=new L.TextureManager(this.gpgpu)}return e.prototype.register=function(e,t,r){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:r,values:null,texture:null,texShape:null,texType:q.TextureType.FLOAT})},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("MathBackendWebGL.writePixels(): pixels can not be null");var r=[e.height,e.width],n=[e.height,e.width,t];if(e instanceof HTMLVideoElement){if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.getContext("2d").drawImage(e,0,0,e.width,e.height),e=this.canvas}var a=i.Tensor.make(r,{},"int32");this.texData.get(a.dataId).texType=q.TextureType.UNSIGNED_BYTE,this.gpgpu.uploadPixelDataToTexture(this.getTexture(a.dataId),e);var o=new A.FromPixelsProgram(n),p=this.compileAndRun(o,[a]);return a.dispose(),p},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");this.throwIfNoData(e);var r=this.texData.get(e),n=r.texture,a=r.texShape,o=r.texType;null!=n&&(this.textureManager.releaseTexture(n,a,o),r.texture=null,r.texShape=null),r.values=t,this.delayedStorage||this.uploadToGPU(e)},e.prototype.readSync=function(e){this.throwIfNoData(e);var t=this.texData.get(e),r=t.texture,n=t.values,a=t.texShape;if(null!=n)return this.cacheOnCPU(e),n;var o,p=null!=this.activeTimers;p&&(o=performance.now());var i=this.gpgpu.downloadMatrixFromTexture(r,a[0],a[1]);return p&&(this.downloadWaitMs+=performance.now()-o),this.cacheOnCPU(e,i),t.values},e.prototype.read=function(e){return t(this,void 0,void 0,function(){var t,a,o,p,i;return r(this,function(r){switch(r.label){case 0:return this.throwIfNoData(e),t=this.texData.get(e),a=t.texture,o=t.values,p=t.texShape,null!=o?(this.cacheOnCPU(e),[2,o]):n.ENV.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")?[4,this.gpgpu.downloadMatrixFromTextureAsync(a,p[0],p[1])]:[3,2];case 1:return i=r.sent(),this.cacheOnCPU(e,i),[2,t.values];case 2:return 0===n.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.readSync(e)]:[4,this.gpgpu.runQuery(function(){})];case 3:return r.sent(),[2,this.readSync(e)]}})})},e.prototype.time=function(e){return t(this,void 0,void 0,function(){var t,n,a,o,p,i;return r(this,function(r){switch(r.label){case 0:return t=this.activeTimers,n=[],a=!1,null==this.programTimersStack?(this.programTimersStack=n,a=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=s.flatten(this.activeTimers),this.activeTimers=t,a&&(this.programTimersStack=null),[4,Promise.all(o).then(function(e){var t=0;return e.forEach(function(e){return t+=e}),t})];case 1:return p=r.sent(),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:p,wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i]}})})},e.prototype.memory=function(){return{unreliable:!1}},e.prototype.startTimer=function(){return n.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return n.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return t(this,void 0,void 0,function(){var t;return r(this,function(r){return n.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.pollQueryTime(e)]:[2,(t=e).endMs-t.startMs]})})},e.prototype.disposeData=function(e){if(this.texData.has(e)){var t=this.texData.get(e),r=t.texture,n=t.texShape,a=t.texType;null!=r&&this.textureManager.releaseTexture(r,n,a),this.texData.delete(e)}},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getTextureData=function(e){return this.uploadToGPU(e),this.texData.get(e)},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.slice=function(e,t,r){var n=new I.SliceProgram(r),a=n.getCustomSetupFunc(t);return this.compileAndRun(n,[e],null,a)},e.prototype.reverse=function(e,t){var r=new k.ReverseProgram(e.shape,t);return this.compileAndRun(r,[e])},e.prototype.concat=function(e,t){var r=new d.ConcatProgram(e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.neg=function(e){var t=new W.UnaryOpProgram(e.shape,C.NEG);return this.compileAndRun(t,[e])},e.prototype.matMul=function(e,t,r,n){var a=new _.MatMulProgram(e.shape,t.shape,r,n);return this.compileAndRun(a,[e,t])},e.prototype.multiply=function(e,t){var r=new g.BinaryOpProgram(m.MUL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,u.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.batchNormalization4D=function(e,t,r,n,a,o){var p=[e,t,r],i=null;null!=o&&(i=o.shape,p.push(o));var u=null;null!=a&&(u=a.shape,p.push(a));var s=new c.BatchNormProgram(e.shape,t.shape,r.shape,i,u,n);return this.compileAndRun(s,p)},e.prototype.localResponseNormalization4D=function(e,t,r,n,a,o){var p=new S.LRNProgram(e.shape,t,r,n,a,o);return this.compileAndRun(p,[e])},e.prototype.tile=function(e,t){var r=new B.TileProgram(e.shape,t);return this.compileAndRun(r,[e])},e.prototype.pad=function(e,t,r){var n=new D.PadProgram(e.shape,t,r);return this.compileAndRun(n,[e])},e.prototype.transpose=function(e,t){var r=new G.TransposeProgram(e.shape,t);return this.compileAndRun(r,[e])},e.prototype.gather=function(e,t,r){var n=new O.GatherProgram(e.shape,t.size,r);return this.compileAndRun(n,[e,t])},e.prototype.reduce=function(e,t,r){var n=e.shape[0],a=e.shape[1],o={windowSize:p.computeOptimalWindowSize(a),inSize:a,batchSize:n},i=new N.ReduceProgram(o,t),u=i.outputShape,s=u[0],h=u[1],l=this.makeOutputArray([s,h],r);return this.compileAndRun(i,[e],l),1===l.shape[1]?l:this.reduce(l,t,r)},e.prototype.argReduce=function(e,t,r){void 0===r&&(r=null);var n=e.shape[0],a=e.shape[1];null!=r&&(n=r.shape[0],a=r.shape[1]);var o={windowSize:p.computeOptimalWindowSize(a),inSize:a,batchSize:n},i=new h.ArgMinMaxProgram(o,t,null==r),u=i.outputShape,s=u[0],l=u[1],c=this.makeOutputArray([s,l],"int32"),m=[e];return null!=r&&m.push(r),this.compileAndRun(i,m,c),1===c.shape[1]?c:this.argReduce(e,t,c)},e.prototype.sum=function(e,t){o.assertAxesAreInnerMostDims("sum",t,e.rank);var r=o.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=s.sizeFromShape(a),i=e.as2D(-1,p),h=u.sumOutType(e.dtype);return this.reduce(i,"sum",h).reshape(n)},e.prototype.argMin=function(e,t){o.assertAxesAreInnerMostDims("argMin",t,e.rank);var r=o.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=s.sizeFromShape(a),i=e.as2D(-1,p);return this.argReduce(i,"min").reshape(n)},e.prototype.argMax=function(e,t){o.assertAxesAreInnerMostDims("argMax",t,e.rank);var r=o.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=s.sizeFromShape(a),i=e.as2D(-1,p);return this.argReduce(i,"max").reshape(n)},e.prototype.equal=function(e,t){var r=new g.BinaryOpProgram(m.EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.notEqual=function(e,t){var r=new g.BinaryOpProgram(m.NOT_EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.less=function(e,t){var r=new g.BinaryOpProgram(m.LESS,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.lessEqual=function(e,t){var r=new g.BinaryOpProgram(m.LESS_EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.greater=function(e,t){var r=new g.BinaryOpProgram(m.GREATER,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.greaterEqual=function(e,t){var r=new g.BinaryOpProgram(m.GREATER_EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.logicalNot=function(e){var t=new W.UnaryOpProgram(e.shape,C.LOGICAL_NOT);return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){var r=new g.BinaryOpProgram(m.LOGICAL_AND,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.logicalOr=function(e,t){var r=new g.BinaryOpProgram(m.LOGICAL_OR,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.logicalXor=function(e,t){var r=new g.BinaryOpProgram(m.LOGICAL_XOR,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.where=function(e,t,r,n){var a=new x.WhereProgram(e.rank,t.shape,t.rank),o=this.makeOutputArray(a.outputShape,n);return this.compileAndRun(a,[e,t,r],o)},e.prototype.topKValues=function(e,t){throw new Error("topKValues GPU not yet implemented!")},e.prototype.topKIndices=function(e,t){throw new Error("topKIndices GPU not yet implemented!")},e.prototype.min=function(e,t){o.assertAxesAreInnerMostDims("min",t,e.rank);var r=o.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=s.sizeFromShape(a),i=e.as2D(-1,p);return this.reduce(i,"min",i.dtype).reshape(n)},e.prototype.minimum=function(e,t){var r=new g.BinaryOpProgram(m.MIN,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.max=function(e,t){o.assertAxesAreInnerMostDims("max",t,e.rank);var r=o.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=s.sizeFromShape(a),i=e.as2D(-1,p);return this.reduce(i,"max",i.dtype).reshape(n)},e.prototype.maximum=function(e,t){var r=new g.BinaryOpProgram(m.MAX,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.divide=function(e,t){var r=new g.BinaryOpProgram(m.DIV,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],n)},e.prototype.add=function(e,t){var r=new g.BinaryOpProgram(m.ADD,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,u.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.subtract=function(e,t){var r=new g.BinaryOpProgram(m.SUB,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,u.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.pow=function(e,t){var r=new g.BinaryOpProgram(m.POW,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,u.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.ceil=function(e){var t=new W.UnaryOpProgram(e.shape,C.CEIL);return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new W.UnaryOpProgram(e.shape,C.FLOOR);return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t=new W.UnaryOpProgram(e.shape,C.EXP);return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t=new W.UnaryOpProgram(e.shape,C.LOG);return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new W.UnaryOpProgram(e.shape,C.SQRT);return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new W.UnaryOpProgram(e.shape,C.SQUARE);return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t=new W.UnaryOpProgram(e.shape,C.RELU);return this.compileAndRun(t,[e])},e.prototype.elu=function(e){var t=new W.UnaryOpProgram(e.shape,C.ELU);return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e){var t=new W.UnaryOpProgram(e.shape,C.ELU_DER);return this.compileAndRun(t,[e])},e.prototype.selu=function(e){var t=new W.UnaryOpProgram(e.shape,C.SELU);return this.compileAndRun(t,[e])},e.prototype.leakyRelu=function(e,t){var r=new W.UnaryOpProgram(e.shape,C.LEAKY_RELU(t));return this.compileAndRun(r,[e])},e.prototype.prelu=function(e,t){var r=new g.BinaryOpProgram(m.PRELU,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.preluDer=function(e,t){var r=new g.BinaryOpProgram(m.PRELU_DER,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.int=function(e){var t=new W.UnaryOpProgram(e.shape,C.TO_INT),r=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],r)},e.prototype.clip=function(e,t,r){var n=new y.ClipProgram(e.shape,t,r);return this.compileAndRun(n,[e])},e.prototype.abs=function(e){var t=new W.UnaryOpProgram(e.shape,C.ABS);return this.compileAndRun(t,[e])},e.prototype.sigmoid=function(e){var t=new W.UnaryOpProgram(e.shape,C.SIGMOID);return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new W.UnaryOpProgram(e.shape,C.SIN);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new W.UnaryOpProgram(e.shape,C.COS);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new W.UnaryOpProgram(e.shape,C.TAN);return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new W.UnaryOpProgram(e.shape,C.ASIN);return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new W.UnaryOpProgram(e.shape,C.ACOS);return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new W.UnaryOpProgram(e.shape,C.ATAN);return this.compileAndRun(t,[e])},e.prototype.sinh=function(e){var t=new W.UnaryOpProgram(e.shape,C.SINH);return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new W.UnaryOpProgram(e.shape,C.COSH);return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new W.UnaryOpProgram(e.shape,C.TANH);return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var r=new W.UnaryOpProgram(e.shape,C.STEP(t));return this.compileAndRun(r,[e])},e.prototype.conv2d=function(e,t,r){var n=new w.Conv2DProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.conv2dDerInput=function(e,t,r){var n=new f.Conv2DDerInputProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.conv2dDerFilter=function(e,t,r){var n=new f.Conv2DDerFilterProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.depthwiseConv2D=function(e,t,r){var n=new v.DepthwiseConv2DProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.maxPool=function(e,t){var r=new U.Pool2DProgram(t,"max",!1),n=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],n)},e.prototype.minPool=function(e,t){var r=new U.Pool2DProgram(t,"min",!1),n=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],n)},e.prototype.avgPool=function(e,t){var r=new U.Pool2DProgram(t,"avg",!1),n=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e],n)},e.prototype.maxPoolBackprop=function(e,t,r){var n=new U.Pool2DProgram(r,"max",!0),a=this.compileAndRun(n,[t]),o=new b.MaxPool2DBackpropProgram(r),p=this.makeOutputArray(o.outputShape,t.dtype),i=this.compileAndRun(o,[e,a],p);return a.dispose(),i},e.prototype.avgPoolBackprop=function(e,t,r){var n=new l.AvgPool2DBackpropProgram(r),a=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[e],a)},e.prototype.resizeBilinear=function(e,t,r,n){var a=new M.ResizeBilinearProgram(e.shape,t,r,n);return this.compileAndRun(a,[e])},e.prototype.multinomial=function(e,t,r){var n=e.shape[0],a=e.shape[1],o=new T.MultinomialProgram(n,a,t),p=this.makeOutputArray(o.outputShape,"int32"),i=o.getCustomSetupFunc(r);return this.compileAndRun(o,[e],p,i)},e.prototype.oneHot=function(e,t,r,n){var a=new E.OneHotProgram(e.size,t,r,n);return this.compileAndRun(a,[e])},e.prototype.makeOutputArray=function(e,t){return i.Tensor.make(e,{},t)},e.prototype.compileAndRun=function(e,t,r,n){var a=this;null==r&&(r=this.makeOutputArray(e.outputShape,t[0].dtype));var o=t.map(function(e){return a.uploadToGPU(e.dataId),{tensor:e,texData:a.texData.get(e.dataId)}});this.uploadToGPU(r.dataId);var p,i={tensor:r,texData:this.texData.get(r.dataId)},u=R.makeShaderKey(e,o,i),s=this.getAndSaveBinary(u,function(){return R.compileProgram(a.gpgpu,e,o,i)}),h=null!=this.activeTimers;return h&&(p=this.startTimer()),R.runProgram(s,o,i,n),h&&(p=this.endTimer(p),this.activeTimers.push(this.getQueryTime(p))),r},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){if(!this.disposed){for(var e in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},e.prototype.throwIfNoData=function(e){if(!this.texData.has(e))throw new Error("WebGL backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},e.prototype.uploadToGPU=function(e){this.throwIfNoData(e);var t=this.texData.get(e),r=t.shape,n=t.values,a=t.texture,o=t.dtype,p=t.texType;if(null==a){var i,u=null!=this.activeTimers;u&&(i=performance.now());var s=z.getTextureShapeFromLogicalShape(this.gpgpu.gl,r);t.texShape=s;var h=this.textureManager.acquireTexture(s,p);t.texture=h,null!=n&&(this.gpgpu.uploadMatrixToTexture(h,s[0],s[1],X(n,o)),t.values=null,u&&(this.uploadWaitMs+=performance.now()-i))}},e.prototype.cacheOnCPU=function(e,t){var r=this.delayedStorage,n=this.texData.get(e),a=n.texture,o=n.texShape,p=n.dtype,i=n.texType;r&&null!=a&&(this.textureManager.releaseTexture(a,o,i),n.texture=null,n.texShape=null),null!=t&&(n.values=Q(t,p))},e}();exports.MathBackendWebGL=F,n.ENV.registerBackend("webgl",function(){return new F});var V=function(t){function r(e,r){void 0===r&&(r=!1);return console.warn("new NDArrayMathGPU() is deprecated. Please use dl.setBackend('webgl')."),t.call(this,new F(e),r)||this}return e(r,t),r}(a.NDArrayMath);function Q(e,t){if("float32"===t)return e;if("int32"===t||"bool"===t){for(var r="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),n=0;n<r.length;++n){var a=e[n];a=isNaN(a)?s.getNaN(t):Math.round(a),r[n]=a}return r}throw new Error("Unknown dtype "+t)}function X(e,t){if(e instanceof Float32Array)return e;for(var r=new Float32Array(e.length),n=0;n<r.length;n++){var a=e[n];r[n]=s.isValNaN(a,t)?NaN:a}return r}exports.NDArrayMathGPU=V;
},{"../environment":10,"../math":14,"../ops/axis_util":72,"../ops/reduce_util":76,"../tensor":15,"../types":16,"../util":12,"./webgl/argminmax_gpu":78,"./webgl/avg_pool_backprop_gpu":79,"./webgl/batchnorm_gpu":80,"./webgl/binaryop_gpu":81,"./webgl/clip_gpu":82,"./webgl/concat_gpu":83,"./webgl/conv_backprop_gpu":84,"./webgl/conv_gpu":85,"./webgl/conv_gpu_depthwise":86,"./webgl/from_pixels_gpu":87,"./webgl/gather_gpu":88,"./webgl/gpgpu_context":43,"./webgl/gpgpu_math":89,"./webgl/logical_gpu":90,"./webgl/lrn_gpu":91,"./webgl/max_pool_backprop_gpu":92,"./webgl/mulmat_gpu":93,"./webgl/multinomial_gpu":94,"./webgl/onehot_gpu":95,"./webgl/pad_gpu":96,"./webgl/pool_gpu":97,"./webgl/reduce_gpu":98,"./webgl/resize_bilinear_gpu":99,"./webgl/reverse_gpu":100,"./webgl/slice_gpu":101,"./webgl/tex_util":102,"./webgl/texture_manager":103,"./webgl/tile_gpu":104,"./webgl/transpose_gpu":105,"./webgl/unaryop_gpu":106,"./webgl/webgl_util":42}],11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./environment"),r=require("./kernels/backend_cpu"),t=require("./kernels/backend_webgl"),n=require("./tensor"),a=require("./util");function o(e,r,t){if(void 0===t&&(t=exports.TEST_EPSILON),e instanceof n.Tensor||r instanceof n.Tensor){if(e instanceof n.Tensor&&r instanceof n.Tensor){if(e.dtype!==r.dtype)throw new Error("Arrays are of different type actual: "+e.dtype+" vs expected: "+r.dtype+".");if(!a.arraysEqual(e.shape,r.shape))throw new Error("Arrays are of different shape actual: "+e.shape+" vs expected: "+r.shape+".")}}else{var o=e.constructor.name,s=r.constructor.name;if(o!==s)throw new Error("Arrays are of different type actual: "+o+" vs expected: "+s)}var c,f;if(c=e instanceof n.Tensor?e.dataSync():e,f=r instanceof n.Tensor?r.dataSync():r,c.length!==f.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+f.length+".\nActual:   "+c+".\nExpected: "+f+".");for(var u=0;u<f.length;++u){var E=c[u],p=f[u];if(!i(E,Number(p),t))throw new Error("Arrays differ: actual["+u+"] = "+E+", expected["+u+"] = "+p+".\nActual:   "+c+".\nExpected: "+f+".")}}function s(e,r){return o(e,r,0)}function c(e,r,t){if(void 0===t&&(t=exports.TEST_EPSILON),!i(e,r,t))throw new Error("Numbers differ: actual === "+e+", expected === "+r)}function i(e,r,t){return!(!isNaN(e)||!isNaN(r))||!(isNaN(e)||isNaN(r)||Math.abs(e-r)>t)}function f(e,r,t){var a;a=e instanceof n.Tensor?e.dataSync():e;for(var o=0;o<a.length;o++)if(a[o]<r||a[o]>t)throw new Error("Value out of range:"+a[o]+" low: "+r+", high: "+t)}function u(e,r,t){r.forEach(function(r){E(e+" "+JSON.stringify(r),t,r)})}function E(n,a,o){describe(n,function(){beforeEach(function(){e.ENV.setFeatures(o||{}),e.ENV.addCustomBackend("webgl",function(){return new t.MathBackendWebGL}),e.ENV.addCustomBackend("cpu",function(){return new r.MathBackendCPU}),o&&null!=o.BACKEND&&e.Environment.setBackend(o.BACKEND),e.ENV.engine.startScope()}),afterEach(function(){e.ENV.engine.endScope(null),e.ENV.reset()}),a()})}function p(e,r){if(!a.isValNaN(e,r))throw new Error("Value "+e+" does not represent NaN for dtype "+r)}exports.WEBGL_ENVS=[{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!0,WEBGL_VERSION:1},{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!0,WEBGL_VERSION:2}],exports.CPU_ENVS=[{BACKEND:"cpu"}],exports.ALL_ENVS=exports.WEBGL_ENVS.concat(exports.CPU_ENVS),exports.TEST_EPSILON=.001,exports.expectArraysClose=o,exports.expectArraysEqual=s,exports.expectNumbersClose=c,exports.expectValuesInRange=f,exports.describeWithFlags=u,exports.assertIsNan=p;
},{"./environment":10,"./kernels/backend_cpu":29,"./kernels/backend_webgl":30,"./tensor":15,"./util":12}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="0.5.1";exports.version=e;
},{}],22:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tensor"),n="manifest.json",t=function(){function t(e){this.urlPath=e,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}return t.prototype.loadManifest=function(){var e=this;return new Promise(function(t,r){var o=new XMLHttpRequest;o.open("GET",e.urlPath+n),o.onload=function(){e.checkpointManifest=JSON.parse(o.responseText),t()},o.onerror=function(t){throw new Error(n+" not found at "+e.urlPath+". "+t)},o.send()})},t.prototype.getCheckpointManifest=function(){var e=this;return null==this.checkpointManifest?new Promise(function(n,t){e.loadManifest().then(function(){n(e.checkpointManifest)})}):new Promise(function(n,t){n(e.checkpointManifest)})},t.prototype.getAllVariables=function(){var e=this;return null!=this.variables?new Promise(function(n,t){n(e.variables)}):new Promise(function(n,t){e.getCheckpointManifest().then(function(t){for(var r=Object.keys(e.checkpointManifest),o=[],i=0;i<r.length;i++)o.push(e.getVariable(r[i]));Promise.all(o).then(function(t){e.variables={};for(var o=0;o<t.length;o++)e.variables[r[o]]=t[o];n(e.variables)})})})},t.prototype.getVariable=function(n){var t=this;if(!(n in this.checkpointManifest))throw new Error("Cannot load non-existant variable "+n);var r=function(r,o){var i=new XMLHttpRequest;i.responseType="arraybuffer";var a=t.checkpointManifest[n].filename;i.open("GET",t.urlPath+a),i.onload=function(){if(404===i.status)throw new Error("Not found variable "+n);var o=new Float32Array(i.response),a=e.Tensor.make(t.checkpointManifest[n].shape,{values:o});r(a)},i.onerror=function(e){throw new Error("Could not fetch variable "+n+": "+e)},i.send()};return null==this.checkpointManifest?new Promise(function(e,n){t.loadManifest().then(function(){new Promise(r).then(e)})}):new Promise(r)},t}();exports.CheckpointLoader=t;
},{"../tensor":15}],24:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../util"),n=function(){function t(t){this.inputs=t,this.idx=0,this.inputCounter=0,this.epoch=0,this.shuffledIndices=e.createShuffledIndices(t[0].length),this.numInputs=t.length;for(var n=this.inputs[0].length,r=0;r<this.numInputs;r++)e.assert(this.inputs[r].length===n,"Number of examples must match across different inputs.");for(r=0;r<this.numInputs;r++)for(var i=this.inputs[r][0].shape,u=0;u<this.inputs[r].length;u++)e.assertShapesMatch(i,this.inputs[r][u].shape)}return t.prototype.getCurrentExampleIndex=function(){var t=this.idx;return this.inputCounter++,this.inputCounter>=this.numInputs&&(this.idx++,this.inputCounter=0,this.idx>=this.inputs[0].length&&(this.idx=0,this.epoch++)),t},t.prototype.getNextInput=function(t){var e=this.getCurrentExampleIndex();return this.inputs[t][this.shuffledIndices[e]]},t.prototype.getEpoch=function(){return this.epoch},t.prototype.getInputProviders=function(){for(var t=[],e=0;e<this.numInputs;e++)t.push(this.getInputProvider(e));return t},t}();exports.InMemoryShuffledInputProviderBuilder=n;var r=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(){return e.getNextInput(t).clone()},disposeCopy:function(t){t.dispose()}}},n}(n);exports.InCPUMemoryShuffledInputProviderBuilder=r;var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(){return e.getNextInput(t).clone()},disposeCopy:function(t){t.dispose()}}},n}(n);exports.InGPUMemoryShuffledInputProviderBuilder=i;
},{"../util":12}],27:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=require("../ops/ops"),t=function(){function t(i,t,n){void 0===i&&(i=1),void 0===t&&(t="fan_in"),void 0===n&&(n="normal"),this.scale=i,this.mode=t,this.distribution=n}return t.prototype.initialize=function(t,n,r){var e=0;if("fan_in"===this.mode)e=n;else if("fan_out"===this.mode)e=r;else{if("fan_avg"!==this.mode)throw new Error("Unexpected mode for variance scaling initializer: "+this.mode);e=(n+r)/2}if("normal"===this.distribution)return i.truncatedNormal(t,0,Math.sqrt(this.scale/e));if("uniform"===this.distribution)return i.randomUniform(t,0,Math.sqrt(3*this.scale/e));throw new Error("Unexpected distribution for variance scaling initializer: "+this.distribution)},t}();exports.VarianceScalingInitializer=t;var n=function(){function t(){}return t.prototype.initialize=function(t,n,r){return i.zeros(t)},t}();exports.ZerosInitializer=n;var r=function(){function t(){}return t.prototype.initialize=function(t,n,r){return i.ones(t)},t}();exports.OnesInitializer=r;var e=function(){function t(i){void 0===i&&(i=0),this.value=i}return t.prototype.initialize=function(t,n,r){return i.fill(t,this.value)},t}();exports.ConstantInitializer=e;var o=function(){function i(i){this.tensor=i}return i.prototype.initialize=function(i,t,n){return this.tensor},i}();exports.TensorInitializer=o;var a=function(){function t(i,t){void 0===i&&(i=0),void 0===t&&(t=.05),this.mean=i,this.stdev=t}return t.prototype.initialize=function(t,n,r){return i.randomNormal(t,this.mean,this.stdev)},t}();exports.RandomNormalInitializer=a;var s=function(){function t(i,t){void 0===i&&(i=0),void 0===t&&(t=.05),this.mean=i,this.stdev=t}return t.prototype.initialize=function(t,n,r){return i.truncatedNormal(t,this.mean,this.stdev)},t}();exports.RandomTruncatedNormalInitializer=s;var u=function(){function t(i,t){void 0===i&&(i=-.05),void 0===t&&(t=.05),this.minval=i,this.maxval=t}return t.prototype.initialize=function(t,n,r){return i.randomUniform(t,this.minval,this.maxval)},t}();exports.RandomUniformInitializer=u;
},{"../ops/ops":40}],25:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../ops/concat_util"),n=require("../ops/conv_util"),a=require("../tensor"),r=require("../util"),s=require("./initializers"),o=function(){function t(t){this.g=t}return t.prototype.dense=function(t,e,n,a,r,o,i){void 0===a&&(a=null),void 0===r&&(r=!0),void 0===o&&(o=new s.VarianceScalingInitializer),void 0===i&&(i=new s.ZerosInitializer);var h=this.g.variable(t+"-weights",o.initialize([e.shape[0],n],e.shape[0],n)),p=this.g.matmul(e,h);if(r){var u=this.g.variable(t+"-bias",i.initialize([n],e.shape[0],n));p=this.g.add(p,u)}return null!=a&&(p=a(p)),p},t}();exports.GraphLayers=o;var i=function(){function t(){this.nodes=[],this.layers=new o(this)}return t.prototype.variable=function(t,e){return this.addNodeAndReturnOutput(new u(this,t,e))},t.prototype.placeholder=function(t,e){return this.addNodeAndReturnOutput(new d(this,t,e))},t.prototype.constant=function(t){var e;if("number"==typeof t)e=a.Scalar.new(t);else if(t instanceof a.Tensor)e=t;else{if(!(t instanceof Array))throw new Error("unimplemented constant type.");var n=r.flatten(t),s=new Float32Array(n);e=a.Tensor.make(r.inferShape(t),{values:s})}return this.addNodeAndReturnOutput(new c(this,e))},t.prototype.reshape=function(t,e){return this.addNodeAndReturnOutput(new l(this,"Reshape",t,e))},t.prototype.fusedLinearCombination=function(t,e,n,a){return this.addNodeAndReturnOutput(new f(this,t,e,n,a))},t.prototype.add=function(t,e){return this.addNodeAndReturnOutput(new x(this,t,e))},t.prototype.subtract=function(t,e){return this.addNodeAndReturnOutput(new v(this,t,e))},t.prototype.multiply=function(t,e){return this.addNodeAndReturnOutput(new m(this,t,e))},t.prototype.divide=function(t,e){return this.addNodeAndReturnOutput(new y(this,t,e))},t.prototype.reduceSum=function(t){return this.addNodeAndReturnOutput(new w(this,t))},t.prototype.concat1d=function(t,e){return this.addNodeAndReturnOutput(new g(this,t,e))},t.prototype.concat2d=function(t,e,n){return this.addNodeAndReturnOutput(new N(this,t,e,n))},t.prototype.concat3d=function(t,e,n){return this.addNodeAndReturnOutput(new S(this,t,e,n))},t.prototype.concat4d=function(t,e,n){return this.addNodeAndReturnOutput(new E(this,t,e,n))},t.prototype.matmul=function(t,e){return this.addNodeAndReturnOutput(new A(this,t,e))},t.prototype.conv2d=function(t,e,n,a,r,s,o){return void 0===s&&(s=1),this.addNodeAndReturnOutput(new R(this,t,e,n,a,r,s,o))},t.prototype.maxPool=function(t,e,n,a){return void 0===n&&(n=1),this.addNodeAndReturnOutput(new O(this,t,e,n,a))},t.prototype.exp=function(t){return this.addNodeAndReturnOutput(new D(this,t))},t.prototype.log=function(t){return this.addNodeAndReturnOutput(new T(this,t))},t.prototype.relu=function(t){return this.addNodeAndReturnOutput(new C(this,t))},t.prototype.leakyRelu=function(t,e){return this.addNodeAndReturnOutput(new X(this,t,e))},t.prototype.prelu=function(t,e){return this.addNodeAndReturnOutput(new z(this,t,e))},t.prototype.elu=function(t){return this.addNodeAndReturnOutput(new q(this,t))},t.prototype.tanh=function(t){return this.addNodeAndReturnOutput(new L(this,t))},t.prototype.sigmoid=function(t){return this.addNodeAndReturnOutput(new F(this,t))},t.prototype.square=function(t){return this.addNodeAndReturnOutput(new M(this,t))},t.prototype.softmax=function(t){return this.addNodeAndReturnOutput(new _(this,t))},t.prototype.softmaxCrossEntropyCost=function(t,e){return this.addNodeAndReturnOutput(new P(this,t,e))},t.prototype.meanSquaredCost=function(t,e){return this.addNodeAndReturnOutput(new I(this,t,e))},t.prototype.argmax=function(t){return this.addNodeAndReturnOutput(new k(this,t))},t.prototype.argmaxEquals=function(t,e){return this.addNodeAndReturnOutput(new U(this,t,e))},t.prototype.addNodeAndReturnOutput=function(t){return this.nodes.push(t),t.validate(),t.output},t.prototype.getNodes=function(){return this.nodes},t}();exports.Graph=i;var h=function(e){function n(t){var a=e.call(this,[],"float32")||this;return a.shape=t,a.id=n.nextID++,a}return t(n,e),n.nextID=0,n}(a.Tensor);exports.SymbolicTensor=h;var p=function(){function t(e,n,a,r){this.graph=e,this.name=n,this.inputs=a,this.output=r,this.id=t.nextID++,r.node=this}return t.nextID=0,t}();exports.Node=p;var u=function(e){function n(t,n,a){var r=e.call(this,t,n,{},new h(a.shape))||this;return r.data=a,r}return t(n,e),n.prototype.validate=function(){r.assert(null!=this.data,"Error adding variable op: Data for variable '"+this.name+"' is null or undefined")},n}(p);exports.VariableNode=u;var d=function(e){function n(t,n,a){return e.call(this,t,n,{},new h(a))||this}return t(n,e),n.prototype.validate=function(){},n}(p);exports.PlaceholderNode=d;var c=function(e){function n(t,n){var a=e.call(this,t,"Constant",{},new h(n.shape))||this;return a.data=n,a}return t(n,e),n.prototype.validate=function(){r.assert(null!=this.data,"Error adding constant: data for placeholder '"+this.name+"' is null or undefined")},n}(p);exports.ConstantNode=c;var l=function(e){function n(t,n,a,r){var s=e.call(this,t,n,{x:a},new h(r))||this;return s.name=n,s.x=a,s.shape=r,s}return t(n,e),n.prototype.validate=function(){var t=r.sizeFromShape(this.x.shape),e=r.sizeFromShape(this.shape);r.assert(t===e,"Error making reshape operation: input to reshape '"+this.name+"' of shape ("+this.x.shape+") does not match size of requested shape "+this.shape+".")},n.X="x",n}(p);exports.ReshapeNode=l;var f=function(e){function n(t,n,a,r,s){var o=e.call(this,t,"Linear Combination",{t1:n,t2:a,c1:r,c2:s},new h(n.shape))||this;return o.t1=n,o.t2=a,o.c1=r,o.c2=s,o}return t(n,e),n.prototype.validate=function(){if(r.assertShapesMatch(this.t1.shape,this.t2.shape),!r.isScalarShape(this.c1.shape))throw new Error("Error adding fusedLinearCombination: c1 is not a scalar, got shape: "+this.c1.shape);if(!r.isScalarShape(this.c2.shape))throw new Error("Error adding fusedLinearCombination: c2 is not a scalar, got shape: "+this.c2.shape)},n.T1="t1",n.T2="t2",n.C1="c1",n.C2="c2",n}(p);exports.FusedLinearCombinationNode=f;var x=function(e){function n(t,n,a){var s=e.call(this,t,"Add",{t1:n,t2:a},new h(1===r.sizeFromShape(n.shape)?a.shape:n.shape.length<a.shape.length?a.shape:n.shape))||this;return s.t1=n,s.t2=a,s}return t(n,e),n.prototype.validate=function(){r.assert(1===r.sizeFromShape(this.t1.shape)||1===r.sizeFromShape(this.t2.shape)||r.arraysEqual(this.t1.shape,this.t2.shape)||2===this.t1.shape.length&&1===this.t2.shape.length&&this.t1.shape[1]===this.t2.shape[0]||1===this.t1.shape.length&&2===this.t2.shape.length&&this.t1.shape[0]===this.t2.shape[1],"Error adding add operation op: one of inputs must be scalar, shapes "+this.t1.shape+" and "+this.t2.shape+" must match,or one of them can be broadcasted (2D and 1D).")},n.T1="t1",n.T2="t2",n}(p);exports.AddNode=x;var v=function(e){function n(t,n,a){var s=e.call(this,t,"Subtract",{t1:n,t2:a},new h(1===r.sizeFromShape(n.shape)?a.shape:n.shape))||this;return s.t1=n,s.t2=a,s}return t(n,e),n.prototype.validate=function(){r.assert(1===r.sizeFromShape(this.t1.shape)||1===r.sizeFromShape(this.t2.shape)||r.arraysEqual(this.t1.shape,this.t2.shape),"Error adding subtract op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},n.T1="t1",n.T2="t2",n}(p);exports.SubtractNode=v;var m=function(e){function n(t,n,a){var s=e.call(this,t,"Multiply",{t1:n,t2:a},new h(1===r.sizeFromShape(n.shape)?a.shape:n.shape))||this;return s.t1=n,s.t2=a,s}return t(n,e),n.prototype.validate=function(){r.assert(1===r.sizeFromShape(this.t1.shape)||1===r.sizeFromShape(this.t2.shape)||r.arraysEqual(this.t1.shape,this.t2.shape),"Error adding multiply op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},n.T1="t1",n.T2="t2",n}(p);exports.MultiplyNode=m;var y=function(e){function n(t,n,a){var s=e.call(this,t,"Divide",{t1:n,t2:a},new h(1===r.sizeFromShape(n.shape)?a.shape:n.shape))||this;return s.t1=n,s.t2=a,s}return t(n,e),n.prototype.validate=function(){r.assert(1===r.sizeFromShape(this.t1.shape)||1===r.sizeFromShape(this.t2.shape)||r.arraysEqual(this.t1.shape,this.t2.shape),"Error adding divide op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},n.T1="t1",n.T2="t2",n}(p);exports.DivideNode=y;var w=function(e){function n(t,n){return e.call(this,t,"ReduceSum",{x:n},new h([]))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.ReduceSumNode=w;var g=function(n){function a(t,a,r){return n.call(this,t,"Concat1D",{x1:a,x2:r},new h(e.computeOutShape1D(a.shape,r.shape)))||this}return t(a,n),a.prototype.validate=function(){},a.X1="x1",a.X2="x2",a}(p);exports.Concat1DNode=g;var N=function(n){function a(t,a,r,s){var o=n.call(this,t,"Concat2D",{x1:a,x2:r},new h(e.computeOutShape(a.shape,r.shape,s)))||this;return o.x1=a,o.x2=r,o.axis=s,o}return t(a,n),a.prototype.validate=function(){e.assertParams(this.x1.shape,this.x2.shape,this.axis)},a.X1="x1",a.X2="x2",a.AXIS="axis",a}(p);exports.Concat2DNode=N;var S=function(n){function a(t,a,r,s){var o=n.call(this,t,"Concat3D",{x1:a,x2:r},new h(e.computeOutShape(a.shape,r.shape,s)))||this;return o.x1=a,o.x2=r,o.axis=s,o}return t(a,n),a.prototype.validate=function(){e.assertParams(this.x1.shape,this.x2.shape,this.axis)},a.X1="x1",a.X2="x2",a.AXIS="axis",a}(p);exports.Concat3DNode=S;var E=function(n){function a(t,a,r,s){var o=n.call(this,t,"Concat4D",{x1:a,x2:r},new h(e.computeOutShape(a.shape,r.shape,s)))||this;return o.x1=a,o.x2=r,o.axis=s,o}return t(a,n),a.prototype.validate=function(){e.assertParams(this.x1.shape,this.x2.shape,this.axis)},a.X1="x1",a.X2="x2",a.AXIS="axis",a}(p);function b(t,e){return 1===t.length&&1===e.length?[1]:1===t.length&&2===e.length?[e[1]]:2===t.length&&1===e.length?[t[0]]:[t[0],e[1]]}exports.Concat4DNode=E;var A=function(e){function n(t,n,a){var r=e.call(this,t,"MatMul",{x1:n,x2:a},new h(b(n.shape,a.shape)))||this;return r.x1=n,r.x2=a,r}return t(n,e),n.prototype.validate=function(){if(2===this.x1.shape.length&&2===this.x2.shape.length)r.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: inner shapes of matrices with shapes "+this.x1.shape+" and "+this.x2.shape+" must match.");else if(2===this.x1.shape.length&&1===this.x2.shape.length)r.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: second dimension of matrix with shape "+this.x1.shape.toString()+" must match size of vector with shape "+this.x2.shape+".");else{if(1!==this.x1.shape.length||2!==this.x2.shape.length)throw new Error("Error adding matmul op: inputs must be vectors or matrices.");r.assert(this.x1.shape[0]===this.x2.shape[0],"Error adding matmul op: size of vector with shape "+this.x1.shape+" must match first dimension of matrix with shape "+this.x2.shape+".")}},n.X1="x1",n.X2="x2",n}(p);exports.MatMulNode=A;var R=function(e){function a(t,a,r,s,o,i,p,u){void 0===p&&(p=1);var d=e.call(this,t,"Convolution 2D",{x:a,w:r,b:s},new h(n.computeOutputShape3D(a.shape,o,i,p,u)))||this;return d.x=a,d.w=r,d.b=s,d.fieldSize=o,d.outputDepth=i,d.stride=p,d.zeroPad=u,d}return t(a,e),a.prototype.validate=function(){r.assert(3===this.x.shape.length,"Error adding conv2d op: input must be of rank 3, but got shape: "+this.x.shape+"."),r.assert(4===this.w.shape.length,"Error adding conv2d op: weights must be of rank 4, but got shape: "+this.w.shape+"."),r.assert(1===this.b.shape.length,"Error adding conv2d op: biases must be of rank 1, but got shape: "+this.b.shape+"."),r.assert(this.x.shape[2]===this.w.shape[2],"Error adding conv2d op: depth of input ("+this.x.shape[2]+") must match input depth for weights ("+this.w.shape[2]+").")},a.X="x",a.W="w",a.B="b",a}(p);exports.Convolution2DNode=R;var O=function(e){function a(t,a,r,s,o){void 0===s&&(s=1);var i=e.call(this,t,"Max pool",{x:a},new h(n.computeOutputShape3D(a.shape,r,a.shape[2],s,o)))||this;return i.x=a,i.fieldSize=r,i.stride=s,i.zeroPad=o,i}return t(a,e),a.prototype.validate=function(){r.assert(3===this.x.shape.length,"Error adding maxPool op: input must be of rank 3, but got shape: "+this.x.shape+".")},a.X="x",a}(p);exports.MaxPoolNode=O;var C=function(e){function n(t,n){return e.call(this,t,"ReLU",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.ReLUNode=C;var X=function(e){function n(t,n,a){var r=e.call(this,t,"LeakyReLU",{x:n},new h(n.shape))||this;return r.alpha=a,r}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.LeakyReLUNode=X;var z=function(e){function n(t,n,a){var r=e.call(this,t,"PReLU",{x:n,alpha:a},new h(n.shape))||this;return r.x=n,r.alpha=a,r}return t(n,e),n.prototype.validate=function(){r.assert(r.arraysEqual(this.x.shape,this.alpha.shape),"Error adding pRelu op: the shapes x: "+this.x.shape+" and alpha: "+this.alpha.shape+" must match.")},n.X="x",n.ALPHA="alpha",n}(p);exports.PReLUNode=z;var q=function(e){function n(t,n){return e.call(this,t,"Elu",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.EluNode=q;var D=function(e){function n(t,n){return e.call(this,t,"Exp",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.ExpNode=D;var T=function(e){function n(t,n){return e.call(this,t,"Log",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.LogNode=T;var L=function(e){function n(t,n){return e.call(this,t,"TanH",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.TanHNode=L;var F=function(e){function n(t,n){return e.call(this,t,"Sigmoid",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.SigmoidNode=F;var M=function(e){function n(t,n){return e.call(this,t,"Square",{x:n},new h(n.shape))||this}return t(n,e),n.prototype.validate=function(){},n.X="x",n}(p);exports.SquareNode=M;var P=function(e){function n(t,n,a){var r=e.call(this,t,"SoftmaxCrossEntropyCost",{x:n,target:a},new h([]))||this;return r.x=n,r.target=a,r}return t(n,e),n.prototype.validate=function(){r.assert(r.arraysEqual(this.x.shape,this.target.shape),"Error adding softmaxCrossEntropyCost op: x shape ("+this.x.shape+") must match target shape ("+this.target.shape+").")},n.X="x",n.TARGET="target",n}(p);exports.SoftmaxCrossEntropyCostNode=P;var _=function(e){function n(t,n){var a=e.call(this,t,"Softmax",{x:n},new h(n.shape))||this;return a.x=n,a}return t(n,e),n.prototype.validate=function(){r.assert(1===this.x.shape.length,"The input to a softmax must be a 1-D tensor"),r.assert(this.x.shape[0]>=2,"The input to a softmax must have at least 2 values")},n.X="x",n}(p);exports.SoftmaxNode=_;var I=function(e){function n(t,n,a){var r=e.call(this,t,"Mean Squared Cost",{label:n,prediction:a},new h([]))||this;return r.label=n,r.prediction=a,r}return t(n,e),n.prototype.validate=function(){r.assert(r.arraysEqual(this.label.shape,this.prediction.shape),"Error adding meanSquaredCost op: label shape ("+this.label.shape+") must match prediction shape ("+this.prediction.shape+").")},n.LABEL="label",n.PREDICTION="prediction",n}(p);exports.MeanSquaredCostNode=I;var k=function(e){function n(t,n){var a=e.call(this,t,"ArgMax",{x:n},new h([1]))||this;return a.x=n,a}return t(n,e),n.prototype.validate=function(){r.assert(r.sizeFromShape(this.x.shape)>0,"Error adding argmax op: input tensor must have at least one entry.")},n.X="x",n}(p);exports.ArgMaxNode=k;var U=function(e){function n(t,n,a){var r=e.call(this,t,"ArgMaxEquals",{x1:n,x2:a},new h([1]))||this;return r.x1=n,r.x2=a,r}return t(n,e),n.prototype.validate=function(){r.assert(r.arraysEqual(this.x1.shape,this.x2.shape),"Error adding ArgMaxEquals op: x1 shape ("+this.x1.shape+") must match x2 shape ("+this.x2.shape+").")},n.X1="x1",n.X2="x2",n}(p);exports.ArgMaxEqualsNode=U;
},{"../ops/concat_util":68,"../ops/conv_util":21,"../tensor":15,"../util":12,"./initializers":27}],137:[function(require,module,exports) {
"use strict";function t(t,e){return t===e?0:t<e?-1:1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultCompare=t;var e=function(){function t(t,e){this.comparator=t,this.indexObserver=e,this.heap=[]}return t.prototype.enqueue=function(t){this.heap.push(t),this.onIndexChanged(t,this.heap.length-1),this.siftUp(this.heap.length-1)},t.prototype.dequeue=function(){if(this.empty())throw new Error("dequeue called on empty priority queue.");var t=this.heap[0];return this.swap(0,this.heap.length-1),this.heap.pop(),this.siftDown(0),t},t.prototype.update=function(t,e){var i=e===this.heap.length-1;i||this.swap(e,this.heap.length-1),this.heap.pop(),i||(-1!==this.siftUpIndex(e)?this.siftUp(e):-1!==this.siftDownIndex(e)&&this.siftDown(e)),this.enqueue(t)},t.prototype.empty=function(){return 0===this.heap.length},t.prototype.onIndexChanged=function(t,e){this.indexObserver&&this.indexObserver(t,e)},t.prototype.getParentIndex=function(t){return 0===t?-1:Math.floor((t-1)/2)},t.prototype.getLeftChildIndex=function(t){var e=2*t+1;return e<this.heap.length?e:-1},t.prototype.getRightChildIndex=function(t){var e=2*t+2;return e<this.heap.length?e:-1},t.prototype.siftUpIndex=function(t){var e=this.getParentIndex(t);return-1===e?-1:this.compare(e,t)>0?e:-1},t.prototype.siftUp=function(t){for(var e=this.siftUpIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftUpIndex(t)},t.prototype.siftDownIndex=function(t){if(t>=this.heap.length)return-1;var e=t,i=this.getLeftChildIndex(t);-1!==i&&this.compare(i,e)<0&&(e=i);var n=this.getRightChildIndex(t);return-1!==n&&this.compare(n,e)<0&&(e=n),e===t?-1:e},t.prototype.siftDown=function(t){for(var e=this.siftDownIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftDownIndex(t)},t.prototype.compare=function(t,e){return this.comparator(this.heap[t],this.heap[e])},t.prototype.swap=function(t,e){var i=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=i,this.onIndexChanged(this.heap[t],t),this.onIndexChanged(this.heap[e],e)},t}();exports.PriorityQueue=e;
},{}],112:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./graph"),n=require("./priority_queue"),t=require("./priority_queue");function r(e,n){var t={},r={},u=[],o=e.slice();n.forEach(function(e){return t[e.id]=e});for(var i=function(){var e=o.pop();null==r[e.id]&&(null==t[e.id]&&Object.keys(e.inputs).map(function(n){return e.inputs[n]}).forEach(function(e){return o.push(e.node)}),u.push(e),r[e.id]=e)};0!==o.length;)i();return u}function u(e){var r=[],u={},o={},i=new t.PriorityQueue(function(e,t){return n.defaultCompare(o[e.id],o[t.id])},function(e,n){return u[e.id]=n});for(e.forEach(function(e){return o[e.id]=0}),e.forEach(function(n){return Object.keys(n.inputs).map(function(e){return n.inputs[e]}).forEach(function(n){-1!==e.indexOf(n.node)&&o[n.node.id]++})}),e.forEach(function(e){return i.enqueue(e)});!i.empty();)r.unshift(i.dequeue()),Object.keys(r[0].inputs).map(function(e){return r[0].inputs[e]}).forEach(function(n){-1!==e.indexOf(n.node)&&(o[n.node.id]--,i.update(n.node,u[n.node.id]))});return r}function o(e){return 0===Object.keys(e.inputs).length}function i(n){return!(n.node instanceof e.ConstantNode)}function c(e,n){for(var t=Object.keys(e.inputs),r=0;r<t.length;r++){var u=e.inputs[t[r]];if(n.get(u,!0)===n.get(e.output,!0))return!0}return!1}exports.getUnorderedEvaluationSet=r,exports.getOrderedEvaluationSet=u,exports.isInputNode=o,exports.shouldBackProp=i,exports.isPassthroughNode=c;
},{"./graph":25,"./priority_queue":137}],140:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(){}return e.prototype.disposeTransientArrays=function(e,t){},e.prototype.dispose=function(){},e}();exports.Operation=e;
},{}],113:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var r in s)s.hasOwnProperty(r)&&(e[r]=s[r])};return function(s,r){function a(){this.constructor=s}e(s,r),s.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var s=require("../../globals"),r=require("../../util"),a=require("../graph_util"),o=require("./op"),t=function(o){function t(e,s,a){var t=o.call(this)||this;return t.x1Tensor=e,t.x2Tensor=s,t.yTensor=a,r.assert(1===r.sizeFromShape(e.shape)||1===r.sizeFromShape(s.shape)||r.arraysEqual(e.shape,s.shape)||2===e.shape.length&&1===s.shape.length&&e.shape[1]===s.shape[0]||1===e.shape.length&&2===s.shape.length&&e.shape[0]===s.shape[1],"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape, or one of them can be broadcasted (2D and 1D)."),t}return e(t,o),t.prototype.feedForward=function(e,a){var o=this,t=a.get(this.x1Tensor),n=a.get(this.x2Tensor);s.tidy(function(){var p;p=r.isScalarShape(t.shape)?e.scalarPlusArray(t,n):r.isScalarShape(n.shape)?e.scalarPlusArray(n,t):e.add(t,n),a.set(o.yTensor,s.keep(p))})},t.prototype.backProp=function(e,o,t){var n=this,p=t.get(this.yTensor);s.tidy(function(){if(a.shouldBackProp(n.x1Tensor))if(1===n.x1Tensor.shape.length&&2===n.x2Tensor.shape.length&&n.x1Tensor.shape[0]===n.x2Tensor.shape[1]){var s=e.sum(p,0);t.add(n.x1Tensor,s)}else if(r.isScalarShape(n.x1Tensor.shape)){s=e.sum(p);t.add(n.x1Tensor,s)}else t.add(n.x1Tensor,e.clone(p));if(a.shouldBackProp(n.x2Tensor))if(2===n.x1Tensor.shape.length&&1===n.x2Tensor.shape.length&&n.x1Tensor.shape[1]===n.x2Tensor.shape[0]){s=e.sum(p,0);t.add(n.x2Tensor,s)}else if(r.isScalarShape(n.x2Tensor.shape)){s=e.sum(p);t.add(n.x2Tensor,s)}else t.add(n.x2Tensor,e.clone(p))})},t.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},t}(o.Operation);exports.Add=t;
},{"../../globals":19,"../../util":12,"../graph_util":112,"./op":140}],114:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../globals"),e=require("./op"),o=function(e){function o(t,r){var o=e.call(this)||this;return o.xTensor=t,o.yTensor=r,o}return t(o,e),o.prototype.feedForward=function(t,e){var o=this,n=e.get(this.xTensor);r.tidy(function(){e.set(o.yTensor,r.keep(t.argMax(n)))})},o.prototype.backProp=function(t,r,e){throw new Error("ArgMax backprop unimplemented")},o}(e.Operation);exports.ArgMax=o;
},{"../../globals":19,"./op":140}],115:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../globals"),e=require("./op"),o=function(e){function o(t,r,o){var n=e.call(this)||this;return n.x1Tensor=t,n.x2Tensor=r,n.yTensor=o,n}return t(o,e),o.prototype.feedForward=function(t,e){var o=this,n=e.get(this.x1Tensor),s=e.get(this.x2Tensor);r.tidy(function(){e.set(o.yTensor,r.keep(t.argMaxEquals(n,s)))})},o.prototype.backProp=function(t,r,e){throw new Error("ArgMaxEquals backprop unimplemented")},o}(e.Operation);exports.ArgMaxEquals=o;
},{"../../globals":19,"./op":140}],116:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../globals"),r=require("../../ops/concat_util"),o=require("../../util"),n=require("./op"),s=function(r){function o(e,t,o){var n=r.call(this)||this;return n.x1Tensor=e,n.x2Tensor=t,n.yTensor=o,n}return e(o,r),o.prototype.feedForward=function(e,r){var o=this,n=r.get(this.x1Tensor),s=r.get(this.x2Tensor);t.tidy(function(){var i=e.concat1D(n,s);r.set(o.yTensor,t.keep(i))})},o.prototype.backProp=function(e,r,o){var n=this;t.tidy(function(){p(e,n.x1Tensor,n.x2Tensor,n.yTensor,0,o,r)})},o}(n.Operation);exports.Concat1D=s;var i=function(o){function n(e,t,n,s){var i=o.call(this)||this;return i.x1Tensor=e,i.x2Tensor=t,i.axis=n,i.yTensor=s,r.assertParams(e.shape,t.shape,n),i}return e(n,o),n.prototype.feedForward=function(e,r){var o=this,n=r.get(this.x1Tensor),s=r.get(this.x2Tensor);t.tidy(function(){var i=e.concat2D(n,s,o.axis);r.set(o.yTensor,t.keep(i))})},n.prototype.backProp=function(e,r,o){var n=this;t.tidy(function(){p(e,n.x1Tensor,n.x2Tensor,n.yTensor,n.axis,o,r)})},n}(n.Operation);exports.Concat2D=i;var a=function(o){function n(e,t,n,s){var i=o.call(this)||this;return i.x1Tensor=e,i.x2Tensor=t,i.axis=n,i.yTensor=s,r.assertParams(e.shape,t.shape,n),i}return e(n,o),n.prototype.feedForward=function(e,r){var o=this,n=r.get(this.x1Tensor),s=r.get(this.x2Tensor);t.tidy(function(){var i=e.concat3D(n,s,o.axis);r.set(o.yTensor,t.keep(i))})},n.prototype.backProp=function(e,r,o){var n=this;t.tidy(function(){p(e,n.x1Tensor,n.x2Tensor,n.yTensor,n.axis,o,r)})},n}(n.Operation);exports.Concat3D=a;var c=function(o){function n(e,t,n,s){var i=o.call(this)||this;return i.x1Tensor=e,i.x2Tensor=t,i.axis=n,i.yTensor=s,r.assertParams(e.shape,t.shape,n),i}return e(n,o),n.prototype.feedForward=function(e,r){var o=this,n=r.get(this.x1Tensor),s=r.get(this.x2Tensor);t.tidy(function(){var i=e.concat4D(n,s,o.axis);r.set(o.yTensor,t.keep(i))})},n.prototype.backProp=function(e,r,o){var n=this;t.tidy(function(){p(e,n.x1Tensor,n.x2Tensor,n.yTensor,n.axis,o,r)})},n}(n.Operation);function p(e,t,n,s,i,a,c){var p=a.get(s),u=c.get(t),h=c.get(n),x=u.as2D(-1,o.sizeFromShape(u.shape.slice(i))),f=h.as2D(-1,o.sizeFromShape(h.shape.slice(i))),T=r.computeGradientSliceShapes(x.shape,f.shape),y=T.aBegin,v=T.aSize,d=T.bBegin,l=T.bSize,g=p.as2D(-1,x.shape[1]+f.shape[1]),D=e.slice2D(g,y,v).reshapeAs(u),_=e.slice2D(g,d,l).reshapeAs(h);a.add(t,D),a.add(n,_)}exports.Concat4D=c;
},{"../../globals":19,"../../ops/concat_util":68,"../../util":12,"./op":140}],117:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../globals"),r=require("../../ops/conv_util"),o=require("../../util"),s=require("./op"),i=function(s){function i(e,t,i,n,a,p,h,u){void 0===h&&(h=1);var d=s.call(this)||this;return d.wTensor=e,d.xTensor=t,d.bTensor=i,d.yTensor=n,d.fieldSize=a,d.outputDepth=p,d.stride=h,d.assertWeightsShape(e.shape),d.zeroPad=null!=u?u:r.computeDefaultPad(d.xTensor.shape,d.fieldSize,d.stride),o.assert(o.isInt(d.zeroPad),"The zero padding ("+d.zeroPad+") must be an integer. Change the stride and/or zero pad parameters"),d}return e(i,s),i.prototype.feedForward=function(e,r){var o=this,s=r.get(this.wTensor),i=r.get(this.bTensor),n=r.get(this.xTensor);t.tidy(function(){r.set(o.yTensor,t.keep(e.conv2d(n,s,i,o.stride,o.zeroPad)))})},i.prototype.backProp=function(e,r,o){var s=this,i=r.get(this.wTensor),n=r.get(this.xTensor),a=o.get(this.yTensor);t.tidy(function(){var t=e.conv2dDerFilter(n,a,i.shape,s.stride,s.zeroPad),r=e.sum(a,[0,1]),p=e.conv2dDerInput(n.shape,a,i,s.stride,s.zeroPad);o.add(s.wTensor,t),o.add(s.bTensor,r),o.add(s.xTensor,p)})},i.prototype.assertWeightsShape=function(e){o.assert(e[0]===this.fieldSize&&e[1]===this.fieldSize&&e[2]===this.xTensor.shape[2]&&e[3]===this.outputDepth,"weights must be of shape ["+this.fieldSize+","+this.fieldSize+","+this.xTensor.shape[2]+","+this.outputDepth+"] but they are ofshape ["+e+"]")},i}(s.Operation);exports.Convolution2D=i;
},{"../../globals":19,"../../ops/conv_util":21,"../../util":12,"./op":140}],118:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])};return function(r,a){function t(){this.constructor=r}e(r,a),r.prototype=null===a?Object.create(a):(t.prototype=a.prototype,new t)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../globals"),a=require("../../util"),t=require("../graph_util"),s=require("./op"),i=function(s){function i(e,r,t){var i=s.call(this)||this;return i.x1Tensor=e,i.x2Tensor=r,i.yTensor=t,a.assert(1===a.sizeFromShape(e.shape)||1===a.sizeFromShape(r.shape)||a.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),i}return e(i,s),i.prototype.feedForward=function(e,t){var s=this,i=t.get(this.x1Tensor),o=t.get(this.x2Tensor);r.tidy(function(){var n;n=a.isScalarShape(i.shape)?e.scalarDividedByArray(i,o):a.isScalarShape(o.shape)?e.arrayDividedByScalar(i,o):e.divide(i,o),t.set(s.yTensor,r.keep(n))})},i.prototype.backProp=function(e,s,i){var o=this,n=s.get(this.x1Tensor),d=s.get(this.x2Tensor),p=i.get(this.yTensor),u=a.isScalarShape(n.shape),c=a.isScalarShape(d.shape);r.tidy(function(){if(t.shouldBackProp(o.x1Tensor))if(u){var r=e.divide(p,d);i.add(o.x1Tensor,e.sum(r)),r.dispose()}else c?i.add(o.x1Tensor,e.arrayDividedByScalar(p,d)):i.add(o.x1Tensor,e.divide(p,d));if(t.shouldBackProp(o.x2Tensor)){var a=e.elementWiseMul(d,d),s=void 0;s=c?e.arrayDividedByScalar(n,a):u?e.scalarDividedByArray(n,a):e.divide(n,a);var h=e.neg(s),l=e.elementWiseMul(p,h);c?i.add(o.x2Tensor,e.sum(l)):i.add(o.x2Tensor,l)}})},i}(s.Operation);exports.Divide=i;
},{"../../globals":19,"../../util":12,"../graph_util":112,"./op":140}],139:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../globals"),o=require("../tensor"),n=function(){function n(){this.one=o.Scalar.new(1)}return n.prototype.output=function(t,o){return t.tanh(o)},n.prototype.der=function(o,n,r){var e=this;return t.tidy(function(){var t=o.multiplyStrict(r,r);return o.subtract(e.one,t)})},n.prototype.dispose=function(){this.one.dispose()},n}();exports.TanHFunc=n;var r=function(){function t(){}return t.prototype.output=function(t,o){return t.relu(o)},t.prototype.der=function(t,o,n){return t.step(o)},t.prototype.dispose=function(){},t}();exports.ReLUFunc=r;var e=function(){function t(t){this.alpha=t}return t.prototype.output=function(t,o){return t.leakyRelu(o,this.alpha)},t.prototype.der=function(t,o,n){return t.step(o,this.alpha)},t.prototype.dispose=function(){},t}();exports.LeakyReluFunc=e;var u=function(){function o(){}return o.prototype.output=function(t,o){return t.sigmoid(o)},o.prototype.der=function(o,n,r){return t.tidy(function(){var t=o.multiplyStrict(r,r);return o.subStrict(r,t)})},o.prototype.dispose=function(){},o}();exports.SigmoidFunc=u;var i=function(){function t(){this.two=o.Scalar.new(2)}return t.prototype.output=function(t,o){return t.multiplyStrict(o,o)},t.prototype.der=function(t,o,n){return t.multiply(this.two,o)},t.prototype.dispose=function(){this.two.dispose()},t}();exports.SquareFunc=i;var p=function(){function t(){}return t.prototype.output=function(t,o){return t.elu(o)},t.prototype.der=function(t,o,n){throw new Error("Not implemented")},t.prototype.dispose=function(){},t}();exports.EluFunc=p;
},{"../globals":19,"../tensor":15}],119:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../../globals"),e=require("../activation_functions"),r=require("./op"),o=function(e){function r(t,n,r){var o=e.call(this)||this;return o.xTensor=t,o.yTensor=n,o.func=r,o}return t(r,e),r.prototype.feedForward=function(t,e){var r=this,o=e.get(this.xTensor);n.tidy(function(){e.set(r.yTensor,n.keep(r.func.output(t,o)))})},r.prototype.backProp=function(t,e,r){var o=this,i=e.get(this.xTensor),u=e.get(this.yTensor),s=r.get(this.yTensor);n.tidy(function(){var n=o.func.der(t,i,u);r.add(o.xTensor,t.elementWiseMul(s,n)),n.dispose()})},r.prototype.dispose=function(){this.func.dispose()},r}(r.Operation);exports.ElementWiseActivation=o;var i=function(n){function r(t,r){return n.call(this,t,r,new e.ReLUFunc)||this}return t(r,n),r}(o);exports.ReLU=i;var u=function(n){function r(t,r,o){return n.call(this,t,r,new e.LeakyReluFunc(o))||this}return t(r,n),r}(o);exports.LeakyReLU=u;var s=function(n){function r(t,r){return n.call(this,t,r,new e.TanHFunc)||this}return t(r,n),r}(o);exports.TanH=s;var c=function(n){function r(t,r){return n.call(this,t,r,new e.SigmoidFunc)||this}return t(r,n),r}(o);exports.Sigmoid=c;var a=function(n){function r(t,r){return n.call(this,t,r,new e.SquareFunc)||this}return t(r,n),r}(o);exports.Square=a;var p=function(n){function r(t,r){return n.call(this,t,r,new e.EluFunc)||this}return t(r,n),r}(o);exports.Elu=p;var f=function(e){function r(t,n,r){var o=e.call(this)||this;return o.xTensor=t,o.alphaTensor=n,o.yTensor=r,o}return t(r,e),r.prototype.feedForward=function(t,e){var r=this,o=e.get(this.xTensor),i=e.get(this.alphaTensor);n.tidy(function(){e.set(r.yTensor,n.keep(t.prelu(o,i)))})},r.prototype.backProp=function(t,n,e){throw new Error("Not implemented")},r}(r.Operation);exports.PReLU=f;
},{"../../globals":19,"../activation_functions":139,"./op":140}],138:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../globals"),t=require("../ops/ops"),r=function(){function r(){this.halfOne=e.keep(t.scalar(.5))}return r.prototype.cost=function(e,t){var r=e.subStrict(t),s=r.square(),o=this.halfOne.mul(s);return r.dispose(),s.dispose(),o},r.prototype.der=function(e,t){return e.subStrict(t)},r.prototype.dispose=function(){this.halfOne.dispose()},r}();exports.SquareCostFunc=r;
},{"../globals":19,"../ops/ops":40}],120:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../environment"),t=require("../../globals"),o=require("../../tensor"),n=require("../../util"),s=require("../cost_functions"),i=require("../graph_util"),u=require("./op"),a=function(s){function u(e,t,i,u){var a=s.call(this)||this;return a.x1Tensor=e,a.x2Tensor=t,a.yTensor=i,a.func=u,a.oneOverNScalar=r.ENV.math.keep(o.Scalar.new(1/n.sizeFromShape(e.shape))),a}return e(u,s),u.prototype.feedForward=function(e,r){var o=this,n=r.get(this.x1Tensor),s=r.get(this.x2Tensor);t.tidy(function(){var i=o.func.cost(n,s),u=e.sum(i),a=e.scalarTimesArray(o.oneOverNScalar,u);r.set(o.yTensor,t.keep(a))})},u.prototype.backProp=function(e,r,o){var n=this,s=r.get(this.x1Tensor),u=r.get(this.x2Tensor);t.tidy(function(){i.shouldBackProp(n.x1Tensor)&&o.add(n.x1Tensor,n.func.der(s,u)),i.shouldBackProp(n.x2Tensor)&&o.add(n.x2Tensor,n.func.der(u,s))})},u.prototype.dispose=function(){this.func.dispose(),this.oneOverNScalar.dispose()},u}(u.Operation);exports.ElementWiseCost=a;var c=function(r){function t(e,t,o){return r.call(this,e,t,o,new s.SquareCostFunc)||this}return e(t,r),t}(a);exports.MeanSquaredCost=c;
},{"../../environment":10,"../../globals":19,"../../tensor":15,"../../util":12,"../cost_functions":138,"../graph_util":112,"./op":140}],121:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../globals"),r=require("../graph_util"),o=require("./op"),n=function(o){function n(t,e){var r=o.call(this)||this;return r.xTensor=t,r.yTensor=e,r}return t(n,o),n.prototype.feedForward=function(t,r){var o=this,n=r.get(this.xTensor);e.tidy(function(){r.set(o.yTensor,e.keep(t.exp(n)))})},n.prototype.backProp=function(t,o,n){var i=this,s=o.get(this.yTensor),p=n.get(this.yTensor);e.tidy(function(){r.shouldBackProp(i.xTensor)&&n.add(i.xTensor,t.elementWiseMul(s,p))})},n}(o.Operation);exports.Exp=n;
},{"../../globals":19,"../graph_util":112,"./op":140}],122:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../globals"),t=require("../graph_util"),o=require("./op"),s=function(o){function s(e,r,t,s,n){var i=o.call(this)||this;return i.x1Tensor=e,i.x2Tensor=r,i.c1Tensor=t,i.c2Tensor=s,i.outTensor=n,i}return e(s,o),s.prototype.feedForward=function(e,t){var o=this,s=t.get(this.x1Tensor),n=t.get(this.x2Tensor),i=t.get(this.c1Tensor).asScalar(),a=t.get(this.c2Tensor).asScalar();r.tidy(function(){t.set(o.outTensor,r.keep(e.scaledArrayAdd(i,s,a,n)))})},s.prototype.backProp=function(e,o,s){var n=this,i=o.get(this.x1Tensor),a=o.get(this.x2Tensor),c=o.get(this.c1Tensor),u=o.get(this.c2Tensor),p=s.get(this.outTensor);r.tidy(function(){if(t.shouldBackProp(n.x1Tensor)&&s.add(n.x1Tensor,e.scalarTimesArray(c,p)),t.shouldBackProp(n.x2Tensor)&&s.add(n.x2Tensor,e.scalarTimesArray(u,p)),t.shouldBackProp(n.c1Tensor)){var r=e.elementWiseMul(i,p);s.add(n.c1Tensor,e.sum(r))}if(t.shouldBackProp(n.c2Tensor)){var o=e.elementWiseMul(a,p);s.add(n.c2Tensor,e.sum(o))}})},s}(o.Operation);exports.LinearCombination=s;
},{"../../globals":19,"../graph_util":112,"./op":140}],123:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../globals"),e=require("../graph_util"),o=require("./op"),n=function(o){function n(t,r){var e=o.call(this)||this;return e.xTensor=t,e.yTensor=r,e}return t(n,o),n.prototype.feedForward=function(t,e){var o=this,n=e.get(this.xTensor);r.tidy(function(){e.set(o.yTensor,r.keep(t.log(n)))})},n.prototype.backProp=function(t,o,n){var i=this,s=o.get(this.xTensor),u=n.get(this.yTensor);r.tidy(function(){e.shouldBackProp(i.xTensor)&&n.add(i.xTensor,t.divide(u,s))})},n}(o.Operation);exports.Log=n;
},{"../../globals":19,"../graph_util":112,"./op":140}],124:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../globals"),r=require("../graph_util"),s=require("./op"),o=function(s){function o(e,t,r){var o=s.call(this)||this;return o.x1Tensor=e,o.x2Tensor=t,o.yTensor=r,o}return e(o,s),o.prototype.feedForward=function(e,r){var s=this,o=r.get(this.x1Tensor),n=r.get(this.x2Tensor);t.tidy(function(){2===o.shape.length&&2===n.shape.length?r.set(s.yTensor,t.keep(e.matMul(o,n))):2===o.shape.length&&1===n.shape.length?r.set(s.yTensor,t.keep(e.matrixTimesVector(o,n))):1===o.shape.length&&2===n.shape.length&&r.set(s.yTensor,t.keep(e.vectorTimesMatrix(o,n)))})},o.prototype.backProp=function(e,s,o){var n=this,a=s.get(this.x1Tensor),i=s.get(this.x2Tensor),h=o.get(this.yTensor);1===a.shape.length&&(a=a.reshape([1,a.size]),h=h.reshape([1,h.size])),1===i.shape.length&&(i=i.reshape([i.size,1]),h=h.reshape([h.size,1])),t.tidy(function(){if(r.shouldBackProp(n.x1Tensor)){var t=e.matMul(h,i,!1,!0);o.add(n.x1Tensor,1===n.x1Tensor.shape.length?t.as1D():t)}if(r.shouldBackProp(n.x2Tensor)){var s=e.matMul(a,h,!0,!1);o.add(n.x2Tensor,1===n.x2Tensor.shape.length?s.as1D():s)}})},o}(s.Operation);exports.MatMul=o;
},{"../../globals":19,"../graph_util":112,"./op":140}],125:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../globals"),r=require("../../ops/conv_util"),o=require("../../util"),i=require("./op"),n=function(i){function n(e,t,n,s,a){void 0===s&&(s=1);var p=i.call(this)||this;return p.xTensor=e,p.yTensor=t,p.fieldSize=n,p.stride=s,p.pad=null!=a?a:r.computeDefaultPad(e.shape,p.fieldSize,p.stride),o.assert(o.isInt(p.pad),"The zero padding ("+p.pad+") must be an integer. Change the stride and/or zero pad parameters"),p}return e(n,i),n.prototype.feedForward=function(e,r){var o=this,i=r.get(this.xTensor);t.tidy(function(){r.set(o.yTensor,t.keep(e.maxPool(i,o.fieldSize,o.stride,o.pad)))})},n.prototype.backProp=function(e,r,o){var i=this,n=r.get(this.xTensor),s=o.get(this.yTensor);t.tidy(function(){o.add(i.xTensor,e.maxPoolBackprop(s,n,i.fieldSize,i.stride,i.pad))})},n}(i.Operation);exports.MaxPool=n;
},{"../../globals":19,"../../ops/conv_util":21,"../../util":12,"./op":140}],126:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])};return function(r,s){function a(){this.constructor=r}e(r,s),r.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../globals"),s=require("../../util"),a=require("../graph_util"),t=require("./op"),o=function(t){function o(e,r,a){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=r,o.yTensor=a,s.assert(1===s.sizeFromShape(e.shape)||1===s.sizeFromShape(r.shape)||s.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),o}return e(o,t),o.prototype.feedForward=function(e,a){var t=this,o=a.get(this.x1Tensor),n=a.get(this.x2Tensor);r.tidy(function(){var i;i=s.isScalarShape(o.shape)?e.scalarTimesArray(o,n):s.isScalarShape(n.shape)?e.scalarTimesArray(n,o):e.elementWiseMul(o,n),a.set(t.yTensor,r.keep(i))})},o.prototype.backProp=function(e,t,o){var n=this,i=t.get(this.x1Tensor),p=t.get(this.x2Tensor),l=o.get(this.yTensor);r.tidy(function(){if(a.shouldBackProp(n.x1Tensor))if(s.isScalarShape(n.x1Tensor.shape)){var r=e.elementWiseMul(l,p);o.add(n.x1Tensor,e.sum(r))}else s.isScalarShape(p.shape)?o.add(n.x1Tensor,e.scalarTimesArray(p,l)):o.add(n.x1Tensor,e.elementWiseMul(p,l));if(a.shouldBackProp(n.x2Tensor))if(s.isScalarShape(n.x2Tensor.shape)){r=e.elementWiseMul(l,i);o.add(n.x2Tensor,e.sum(r))}else s.isScalarShape(i.shape)?o.add(n.x2Tensor,e.scalarTimesArray(i,l)):o.add(n.x2Tensor,e.elementWiseMul(i,l))})},o}(t.Operation);exports.Multiply=o;
},{"../../globals":19,"../../util":12,"../graph_util":112,"./op":140}],127:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../environment"),r=require("../../globals"),o=require("../../tensor"),n=require("../../util"),s=require("../graph_util"),i=require("./op"),u=function(i){function u(e,r){var s=i.call(this)||this;return s.x=e,s.outTensor=r,n.assertShapesMatch(r.shape,[]),s.ones=t.ENV.math.keep(o.Tensor.ones(e.shape)),s}return e(u,i),u.prototype.feedForward=function(e,t){var o=this,n=t.get(this.x);r.tidy(function(){t.set(o.outTensor,r.keep(e.sum(n)))})},u.prototype.backProp=function(e,t,o){var n=this;s.shouldBackProp(this.x)&&r.tidy(function(){var t=o.get(n.outTensor);o.add(n.x,e.scalarTimesArray(t,n.ones))})},u.prototype.dispose=function(){this.ones.dispose()},u}(i.Operation);exports.ReduceSum=u;
},{"../../environment":10,"../../globals":19,"../../tensor":15,"../../util":12,"../graph_util":112,"./op":140}],128:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../globals"),r=require("../../util"),o=require("./op"),n=function(o){function n(e,t){var n=o.call(this)||this;n.xTensor=e,n.yTensor=t;var s=r.sizeFromShape(e.shape),i=r.sizeFromShape(t.shape);return r.assert(s===i,"The input size ("+s+") and output size ("+i+") must match"),n}return e(n,o),n.prototype.feedForward=function(e,r){var o=this,n=r.get(this.xTensor),s=e.clone(n);t.tidy(function(){r.set(o.yTensor,t.keep(s.reshape(o.yTensor.shape)))})},n.prototype.backProp=function(e,r,o){var n=this,s=o.get(this.yTensor),i=e.clone(s);t.tidy(function(){o.add(n.xTensor,i.reshape(n.xTensor.shape))})},n}(o.Operation);exports.Reshape=n;
},{"../../globals":19,"../../util":12,"./op":140}],129:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../environment"),o=require("../../globals"),r=require("../../tensor"),s=require("../../util"),n=require("../graph"),i=require("../graph_util"),u=require("./op"),a=function(e){function r(t,o){var r=e.call(this)||this;return r.logitsTensor=t,r.output=o,r}return t(r,e),r.prototype.feedForward=function(t,e){var r=this,s=e.get(this.logitsTensor);return o.tidy(function(){e.set(r.output,o.keep(t.softmax(s)))})},r.prototype.backProp=function(t,e,r){var s=this,n=e.get(this.output),u=r.get(this.output);o.tidy(function(){if(i.shouldBackProp(s.logitsTensor)){var e=t.elementWiseMul(t.subtract(u,t.sum(t.elementWiseMul(u,n))),n);r.add(s.logitsTensor,e)}})},r}(u.Operation);exports.Softmax=a;var p=function(s){function i(t,o,i){var u=s.call(this)||this;return u.logitsTensor=t,u.labelTensor=o,u.yTensor=i,u.softmaxTensor=new n.SymbolicTensor(t.shape),u.epsilon=e.ENV.math.keep(r.Scalar.new(1e-5)),u}return t(i,s),i.prototype.feedForward=function(t,e){var r=this,s=e.get(this.logitsTensor),n=e.get(this.labelTensor);o.tidy(function(){var i=t.softmax(s);e.set(r.softmaxTensor,o.keep(i)),e.set(r.yTensor,o.keep(c(t,i,n,r.epsilon)))})},i.prototype.backProp=function(t,e,r){var s=this,n=e.get(this.softmaxTensor),i=e.get(this.labelTensor);o.tidy(function(){r.add(s.logitsTensor,t.subtract(n,i))})},i.prototype.disposeTransientArrays=function(t,e){t.disposeArray(this.softmaxTensor)},i.prototype.dispose=function(){this.epsilon.dispose()},i}(u.Operation);function c(t,e,r,n){return s.assert(e.size===r.size,"The output and target must be the same size"),o.tidy(function(){var o=t.scalarPlusArray(n,e),s=t.log(o),i=t.elementWiseMul(r,s),u=t.neg(i);return t.sum(u)})}exports.SoftmaxCrossEntropyCost=p,exports.crossEntropyCost=c;
},{"../../environment":10,"../../globals":19,"../../tensor":15,"../../util":12,"../graph":25,"../graph_util":112,"./op":140}],130:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../globals"),r=require("../../util"),a=require("../graph_util"),s=require("./op"),o=function(s){function o(t,e,a){var o=s.call(this)||this;return o.t1=t,o.t2=e,o.outTensor=a,r.assert(1===r.sizeFromShape(t.shape)||1===r.sizeFromShape(e.shape)||r.arraysEqual(t.shape,e.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),o}return t(o,s),o.prototype.feedForward=function(t,a){var s=this,o=a.get(this.t1),i=a.get(this.t2);e.tidy(function(){var n;n=r.isScalarShape(o.shape)?t.scalarMinusArray(o,i):r.isScalarShape(i.shape)?t.arrayMinusScalar(o,i):t.subtract(o,i),a.set(s.outTensor,e.keep(n))})},o.prototype.backProp=function(t,s,o){var i=this,n=o.get(this.outTensor);e.tidy(function(){if(a.shouldBackProp(i.t1))if(r.isScalarShape(i.t1.shape)){var e=t.sum(n);o.add(i.t1,e)}else o.add(i.t1,t.clone(n));if(a.shouldBackProp(i.t2))if(r.isScalarShape(i.t2.shape)){e=t.sum(n);var s=t.neg(e);o.add(i.t2,s)}else o.add(i.t2,t.neg(n))})},o.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},o}(s.Operation);exports.Subtract=o;
},{"../../globals":19,"../../util":12,"../graph_util":112,"./op":140}],69:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./graph"),o=require("./graph_util"),t=require("./ops/add"),n=require("./ops/argmax"),u=require("./ops/argmaxequals"),i=require("./ops/concat"),r=require("./ops/convolution"),s=require("./ops/divide"),a=require("./ops/element_wise_activation"),p=require("./ops/element_wise_cost"),d=require("./ops/exp"),N=require("./ops/linear_combination"),f=require("./ops/log"),c=require("./ops/matmul"),l=require("./ops/max_pool"),C=require("./ops/multiply"),m=require("./ops/reduce_sum"),q=require("./ops/reshape"),w=require("./ops/softmax"),x=require("./ops/subtract");function D(e){var o=[];return e.forEach(function(e){return Array.prototype.push.apply(o,X(e))}),o}function X(D){if(D instanceof e.ReshapeNode)return[new q.Reshape(D.inputs[e.ReshapeNode.X],D.output)];if(D instanceof e.MatMulNode){var X=D.inputs[e.MatMulNode.X1],M=D.inputs[e.MatMulNode.X2];return[new c.MatMul(X,M,D.output)]}if(D instanceof e.Convolution2DNode){var S=D.inputs[e.Convolution2DNode.W],L=D.inputs[e.Convolution2DNode.X],v=D.inputs[e.Convolution2DNode.B];return[new r.Convolution2D(S,L,v,D.output,D.fieldSize,D.outputDepth,D.stride,D.zeroPad)]}if(D instanceof e.MaxPoolNode){L=D.inputs[e.MaxPoolNode.X];return[new l.MaxPool(L,D.output,D.fieldSize,D.stride,D.zeroPad)]}if(D instanceof e.ExpNode)return[new d.Exp(D.inputs[e.ExpNode.X],D.output)];if(D instanceof e.LogNode)return[new f.Log(D.inputs[e.LogNode.X],D.output)];if(D instanceof e.ReLUNode)return[new a.ReLU(D.inputs[e.ReLUNode.X],D.output)];if(D instanceof e.LeakyReLUNode)return[new a.LeakyReLU(D.inputs[e.LeakyReLUNode.X],D.output,D.alpha)];if(D instanceof e.PReLUNode)return[new a.PReLU(D.inputs[e.PReLUNode.X],D.inputs[e.PReLUNode.ALPHA],D.output)];if(D instanceof e.EluNode)return[new a.Elu(D.inputs[e.EluNode.X],D.output)];if(D instanceof e.TanHNode)return[new a.TanH(D.inputs[e.TanHNode.X],D.output)];if(D instanceof e.SigmoidNode)return[new a.Sigmoid(D.inputs[e.SigmoidNode.X],D.output)];if(D instanceof e.SoftmaxCrossEntropyCostNode){L=D.inputs[e.SoftmaxCrossEntropyCostNode.X];var E=D.inputs[e.SoftmaxCrossEntropyCostNode.TARGET];return[new w.SoftmaxCrossEntropyCost(L,E,D.output)]}if(D instanceof e.SoftmaxNode)return[new w.Softmax(D.inputs[e.SoftmaxNode.X],D.output)];if(D instanceof e.MeanSquaredCostNode){var R=D.inputs[e.MeanSquaredCostNode.LABEL],g=D.inputs[e.MeanSquaredCostNode.PREDICTION];return[new p.MeanSquaredCost(R,g,D.output)]}if(D instanceof e.ArgMaxEqualsNode)return[new u.ArgMaxEquals(D.inputs[e.ArgMaxEqualsNode.X1],D.inputs[e.ArgMaxEqualsNode.X2],D.output)];if(D instanceof e.ArgMaxNode)return[new n.ArgMax(D.x,D.output)];if(D instanceof e.FusedLinearCombinationNode)return[new N.LinearCombination(D.inputs[e.FusedLinearCombinationNode.T1],D.inputs[e.FusedLinearCombinationNode.T2],D.inputs[e.FusedLinearCombinationNode.C1],D.inputs[e.FusedLinearCombinationNode.C2],D.output)];if(D instanceof e.Concat1DNode)return[new i.Concat1D(D.inputs[e.Concat1DNode.X1],D.inputs[e.Concat1DNode.X2],D.output)];if(D instanceof e.Concat2DNode)return[new i.Concat2D(D.inputs[e.Concat2DNode.X1],D.inputs[e.Concat2DNode.X2],D.axis,D.output)];if(D instanceof e.Concat3DNode)return[new i.Concat3D(D.inputs[e.Concat3DNode.X1],D.inputs[e.Concat3DNode.X2],D.axis,D.output)];if(D instanceof e.Concat4DNode)return[new i.Concat4D(D.inputs[e.Concat4DNode.X1],D.inputs[e.Concat4DNode.X2],D.axis,D.output)];if(D instanceof e.SquareNode)return[new a.Square(D.inputs[e.SquareNode.X],D.output)];if(D instanceof e.AddNode)return[new t.Add(D.inputs[e.AddNode.T1],D.inputs[e.AddNode.T2],D.output)];if(D instanceof e.SubtractNode)return[new x.Subtract(D.inputs[e.SubtractNode.T1],D.inputs[e.SubtractNode.T2],D.output)];if(D instanceof e.MultiplyNode)return[new C.Multiply(D.inputs[e.MultiplyNode.T1],D.inputs[e.MultiplyNode.T2],D.output)];if(D instanceof e.DivideNode)return[new s.Divide(D.inputs[e.DivideNode.T1],D.inputs[e.DivideNode.T2],D.output)];if(D instanceof e.ReduceSumNode)return[new m.ReduceSum(D.inputs[e.ReduceSumNode.X],D.output)];if(o.isInputNode(D))return[];throw Error("Unsupported node type: "+D.constructor.name)}exports.emitFromGraphNodes=D;
},{"./graph":25,"./graph_util":112,"./ops/add":113,"./ops/argmax":114,"./ops/argmaxequals":115,"./ops/concat":116,"./ops/convolution":117,"./ops/divide":118,"./ops/element_wise_activation":119,"./ops/element_wise_cost":120,"./ops/exp":121,"./ops/linear_combination":122,"./ops/log":123,"./ops/matmul":124,"./ops/max_pool":125,"./ops/multiply":126,"./ops/reduce_sum":127,"./ops/reshape":128,"./ops/softmax":129,"./ops/subtract":130}],70:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tensor"),t=require("../util"),r=require("./graph"),o=require("./graph_util");function n(e){return Object.keys(e.dict).map(function(t){return e.dict[+t].tensor.node})}function a(e,t){var r=n(t),a=e.map(function(e){return e.node}),i=o.getUnorderedEvaluationSet(a,r);return o.getOrderedEvaluationSet(i)}function i(e,t){e.forEach(function(e){(e instanceof r.VariableNode||e instanceof r.ConstantNode)&&t.set(e.output,e.data)})}function s(e){var t=[];return e.forEach(function(e){e instanceof r.VariableNode&&t.push(e)}),t}function u(t){Object.keys(t.dict).forEach(function(r){if(t.dict[+r].data instanceof e.Tensor)throw new Error("training requires FeedDictionary entries to be InputProvidersand not NDArrays.")})}function d(r,o,n){Object.keys(r.dict).forEach(function(n){var a,i=r.dict[+n];i.data instanceof e.Tensor?a=i.data:a=i.data.getNextCopy();t.assert(t.arraysEqual(i.tensor.shape,a.shape),"Error loading FeedEntry: feeding NDArray of shape "+a.shape+" does not match Tensor (id: "+i.tensor.id+") shape: "+i.tensor.shape+"."),o.set(i.tensor,a)})}function c(t,r,o){Object.keys(t.dict).forEach(function(o){var n=t.dict[+o];if(!(n.data instanceof e.Tensor)){var a=n.data,i=r.get(n.tensor);a.disposeCopy(i)}r.delete(n.tensor)})}function p(e,t){for(var r=0;r<t.length;){var o=t[r];null!=e.dict[o.output.id]?t.splice(r,1):++r}}function f(e,t){e.forEach(function(e){o.isInputNode(e)||(o.isPassthroughNode(e,t)||t.disposeArray(e.output),t.set(e.output,null))})}function l(e,t){e.forEach(function(e){Object.keys(e.inputs).forEach(function(r){var o=e.inputs[r];t.get(o,!0)!==t.get(e.output,!0)&&t.disposeArray(o),t.nullify(o)})})}function h(e,t,r){e.forEach(function(e){return e.disposeTransientArrays(t,r)})}function y(e){e.forEach(function(e){if(e instanceof r.PlaceholderNode){var t="["+e.output.shape.join(", ")+"]";throw new Error('Placeholder node "'+e.name+'" '+t+" not present in feed dictionary.")}})}exports.getTerminatingNodesFromFeedDictionary=n,exports.getOrderedEvaluationSetFromEvalTensor=a,exports.addPersistentArraysToTensorArrayMap=i,exports.getVariableNodesFromEvaluationSet=s,exports.throwIfFeedDictionaryContainsNDArrays=u,exports.loadInputsFromFeedDictionaryToTensorArrayMap=d,exports.releaseFeedDictionaryInputsFromTensorArrayMap=c,exports.removeFeedDictionaryNodesFromEvaluationSet=p,exports.disposeAndInitializeOperationOutputs=f,exports.disposeAndInitializeOperationInputGradients=l,exports.disposeTransientOperationArrays=h,exports.throwErrorIfEvaluationSetContainsPlaceholderNodes=y;
},{"../tensor":15,"../util":12,"./graph":25,"./graph_util":112}],71:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])};return function(i,r){function o(){this.constructor=i}t(i,r),i.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function t(){this.dict={}}return t.prototype.get=function(t,i){if(void 0===i&&(i=!1),!i&&void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");var r=this.dict[t.id];if(!i&&null===r)throw new Error("tensor "+t.id+" has null array.");return r},t.prototype.delete=function(t){delete this.dict[t.id]},t.prototype.nullify=function(t){this.dict[t.id]=null},t.prototype.disposeArray=function(t){if(void 0!==this.dict[t.id]){var i=this.dict[t.id];null!==i&&(i.dispose(),this.dict[t.id]=null)}},t.prototype.size=function(){return Object.keys(this.dict).length},t.prototype.dispose=function(){var t=this;Object.keys(this.dict).forEach(function(i){var r=t.dict[+i];r&&r.dispose()}),this.dict={}},t.prototype.hasNullArray=function(t){if(void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");return null===this.dict[t.id]},t}();exports.TensorArrayMapBase=i;var r=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return t(r,i),r.prototype.set=function(t,i){this.dict[t.id]=i},r}(i);exports.TensorArrayMap=r;var o=function(i){function r(t){var r=i.call(this)||this;return r.math=t,r}return t(r,i),r.prototype.add=function(t,i){if(null==this.dict[t.id])this.dict[t.id]=this.math.keep(i);else{var r=this.get(t),o=this.math.keep(this.math.addStrict(r,i));this.dict[t.id]=o,r.dispose()}},r}(i);exports.SummedTensorArrayMap=o;
},{}],28:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,r=require("../globals"),e=require("../tensor"),a=require("../util"),i=require("./operation_emitter"),o=require("./session_util"),n=require("./tensor_array_map"),s=function(){return function(t){var r=this;this.dict={},t&&t.forEach(function(t){return r.dict[t.tensor.id]=t})}}();exports.FeedDictionary=s,function(t){t[t.NONE=0]="NONE",t[t.SUM=1]="SUM",t[t.MEAN=2]="MEAN"}(t=exports.CostReduction||(exports.CostReduction={}));var c=function(){function c(t,r){this.math=r,this.activationArrayMap=new n.TensorArrayMap,this.runtimeCache={},this.oneScalar=e.Scalar.new(1),this.gradientArrayMap=new n.SummedTensorArrayMap(this.math)}return c.prototype.dispose=function(){var t=this;this.activationArrayMap.dispose(),Object.keys(this.runtimeCache).forEach(function(r){var e=t.runtimeCache[r];e.operations&&e.operations.forEach(function(t){return t.dispose()})}),this.runtimeCache={},null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.oneScalar.dispose()},c.prototype.evalAll=function(t,e){var a=this;return r.tidy(function(){var r=new s(e),i=a.getOrCreateRuntime(t,r),n=a.activationArrayMap;o.disposeAndInitializeOperationOutputs(i.nodes,n),o.disposeTransientOperationArrays(i.operations,a.activationArrayMap,a.gradientArrayMap),o.addPersistentArraysToTensorArrayMap(i.nodes,n),o.loadInputsFromFeedDictionaryToTensorArrayMap(r,n,a.math),i.operations.forEach(function(t){return t.feedForward(a.math,n)});var c=t.map(function(t){return n.get(t)});return t.forEach(function(t){return n.delete(t)}),o.releaseFeedDictionaryInputsFromTensorArrayMap(r,n,a.math),c})},c.prototype.eval=function(t,r){return this.evalAll([t],r)[0]},c.prototype.train=function(i,n,c,u,p){var h=this;void 0===p&&(p=t.NONE),a.assert(a.isScalarShape(i.shape),"Cost tensor for training must be a scalar value."),this.prevBatchSize!==c&&(this.prevBatchSize=c,null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.batchSizeScalar=this.math.keep(e.Scalar.new(c)));var d=new s(n);o.throwIfFeedDictionaryContainsNDArrays(d);var l=this.getOrCreateRuntime([i],d),m=l.operations,y=l.operations.slice().reverse(),f=this.activationArrayMap,v=this.gradientArrayMap;return v.nullify(i),v.add(i,this.oneScalar),o.addPersistentArraysToTensorArrayMap(l.nodes,f),u.beforeBatch(this.math,c,l,f,v),r.tidy(function(){for(var t=e.Scalar.new(0),r=0;r<c;++r)o.disposeAndInitializeOperationOutputs(l.nodes,f),o.disposeAndInitializeOperationInputGradients(l.nodes,v),o.disposeTransientOperationArrays(l.operations,f,v),o.loadInputsFromFeedDictionaryToTensorArrayMap(d,f,h.math),m.forEach(function(t){return t.feedForward(h.math,f)}),y.forEach(function(t){return t.backProp(h.math,f,v)}),u.afterExample(h.math,l,f,v),o.releaseFeedDictionaryInputsFromTensorArrayMap(d,f,h.math),t=h.updateCostForExample(t,f.get(i),p);return u.afterBatch(h.math,c,l,f,v),h.updateCostForBatch(t,p)})},c.prototype.updateCostForExample=function(r,e,a){return a===t.MEAN||a===t.SUM?this.math.add(r,e):r},c.prototype.updateCostForBatch=function(r,e){return e===t.MEAN?this.math.divide(r,this.batchSizeScalar):r},c.prototype.getOrCreateRuntime=function(t,r){var e=this.makeRuntimeCacheKey(t,r),a=this.runtimeCache[e];if(void 0===a){var n=o.getOrderedEvaluationSetFromEvalTensor(t,r);o.removeFeedDictionaryNodesFromEvaluationSet(r,n),o.throwErrorIfEvaluationSetContainsPlaceholderNodes(n),a={nodes:n,operations:i.emitFromGraphNodes(n)},this.runtimeCache[e]=a}return a},c.prototype.makeRuntimeCacheKey=function(t,r){return t.map(function(t){return t.id}).sort().join("_")+"__"+Object.keys(r.dict).sort().join("_")},c}();exports.Session=c;
},{"../globals":19,"../tensor":15,"../util":12,"./operation_emitter":69,"./session_util":70,"./tensor_array_map":71}],26:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("../globals"),r=require("../tensor"),n=require("./session"),i=1500,s=500,a=3e3;!function(e){e[e.SUM=0]="SUM",e[e.MEAN=1]="MEAN"}(e=exports.MetricReduction||(exports.MetricReduction={}));var o=function(){function o(e,t,n){this.math=e,this.session=t,this.eventObserver=n,this.lastCostTimestamp=0,this.lastEvalTimestamp=0,this.resetStatistics(),this.zeroScalar=r.Scalar.new(0)}return o.prototype.resetStatistics=function(){this.totalBatchesTrained=0},o.prototype.train=function(t,n,a,o,c,l,h,u,p,m,f){void 0===p&&(p=e.MEAN),void 0===m&&(m=i),void 0===f&&(f=s),this.costTensor=t,this.trainFeedEntries=n,this.metricTensor=l,this.metricFeedEntries=h,null!=u&&this.metricBatchSize!==u&&(null!=this.metricBatchSizeScalar&&this.metricBatchSizeScalar.dispose(),this.metricBatchSizeScalar=r.Scalar.new(u)),this.metricBatchSize=u,this.metricReduction=p,this.batchSize=a,this.optimizer=o,this.metricIntervalMs=m,this.costIntervalMs=f,this.currentTrainLoopNumBatches=c,this.batchesTrainedThisRun=0,this.isTraining=!0,this.trainStartTimestamp=performance.now(),this.trainNetwork()},o.prototype.stopTraining=function(){this.isTraining=!1},o.prototype.resumeTraining=function(){this.isTraining=!0,this.trainNetwork()},o.prototype.trainNetwork=function(){var e=this;if(this.batchesTrainedThisRun===this.currentTrainLoopNumBatches&&this.stopTraining(),this.isTraining){var r=performance.now(),i=null!=this.eventObserver.avgCostCallback&&r-this.lastCostTimestamp>this.costIntervalMs;i&&(this.lastCostTimestamp=r);var s=i?n.CostReduction.MEAN:n.CostReduction.NONE;t.tidy(function(){var t=e.session.train(e.costTensor,e.trainFeedEntries,e.batchSize,e.optimizer,s);if(i){var n=performance.now()-r;if(e.eventObserver.avgCostCallback(t),null!=e.eventObserver.trainExamplesPerSecCallback){var a=1e3*e.batchSize/n;e.eventObserver.trainExamplesPerSecCallback(a)}}null!=e.eventObserver.metricCallback&&null!=e.metricFeedEntries&&r-e.lastEvalTimestamp>e.metricIntervalMs&&(e.lastEvalTimestamp=r,null!=e.lastComputedMetric&&e.lastComputedMetric.dispose(),e.lastComputedMetric=e.computeMetric(),e.eventObserver.metricCallback(e.lastComputedMetric)),null!=e.eventObserver.totalTimeCallback&&e.eventObserver.totalTimeCallback((r-e.trainStartTimestamp)/1e3),e.batchesTrainedThisRun++,e.totalBatchesTrained++,null!=e.eventObserver.batchesTrainedCallback&&e.eventObserver.batchesTrainedCallback(e.totalBatchesTrained)}),requestAnimationFrame(function(){return e.trainNetwork()})}else null!=this.eventObserver.doneTrainingCallback&&this.eventObserver.doneTrainingCallback()},o.prototype.infer=function(e,t,n,i,s){var o=this;if(void 0===n&&(n=a),void 0===i&&(i=5),null==this.eventObserver.inferenceExamplesCallback&&null==this.eventObserver.inferenceExamplesPerSecCallback)throw new Error("Cannot start inference loop, no inference example or examples/sec observer provided.");for(var c=0;c<t.length;c++){if(t[c].data instanceof r.Tensor)throw new Error("Cannot start inference on the model runner with feed entries of type NDArray. Please use InputProviders.")}this.inferenceExampleIntervalMs=n,this.inferenceTensor=e,this.inferenceFeedEntries=t,this.inferenceExampleCount=i,this.currentInferenceLoopNumPasses=s,this.isInferring||(this.inferencePassesThisRun=0,requestAnimationFrame(function(){return o.inferNetwork()})),this.isInferring=!0},o.prototype.inferNetwork=function(){var e=this;this.isInferring&&this.inferencePassesThisRun!==this.currentInferenceLoopNumPasses&&(t.tidy(function(){for(var t=[],r=[],n=performance.now(),i=0;i<e.inferenceExampleCount;i++){for(var s=[],a=0;a<e.inferenceFeedEntries.length;a++){var o=e.inferenceFeedEntries[a],c=o.data.getNextCopy();s.push({tensor:o.tensor,data:c})}t.push(s),r.push(e.session.eval(e.inferenceTensor,s))}if(null!=e.eventObserver.inferenceExamplesPerSecCallback){r[r.length-1].dataSync();var l=performance.now()-n,h=1e3*e.inferenceExampleCount/l;e.eventObserver.inferenceExamplesPerSecCallback(h)}null!=e.eventObserver.inferenceExamplesCallback&&e.eventObserver.inferenceExamplesCallback(t,r),e.inferencePassesThisRun++}),this.lastInferTimeoutID=window.setTimeout(function(){return e.inferNetwork()},this.inferenceExampleIntervalMs))},o.prototype.stopInferring=function(){this.isInferring=!1,window.clearTimeout(this.lastInferTimeoutID)},o.prototype.isInferenceRunning=function(){return this.isInferring},o.prototype.computeMetric=function(){var r=this;if(null==this.metricFeedEntries)throw new Error("Cannot compute metric, no metric FeedEntries provided.");var n=this.zeroScalar;return t.tidy(function(){for(var t=0;t<r.metricBatchSize;t++){var i=r.session.eval(r.metricTensor,r.metricFeedEntries);n=r.math.add(n,i.toFloat())}return r.metricReduction===e.MEAN&&(n=r.math.divide(n,r.metricBatchSizeScalar)),n})},o.prototype.getTotalBatchesTrained=function(){return this.totalBatchesTrained},o.prototype.getLastComputedMetric=function(){return this.lastComputedMetric},o.prototype.setMath=function(e){this.math=e},o.prototype.setSession=function(e){this.session=e},o.prototype.setInferenceTensor=function(e){this.inferenceTensor=e},o.prototype.setInferenceExampleCount=function(e){this.inferenceExampleCount=e},o}();exports.GraphRunner=o;
},{"../globals":19,"../tensor":15,"./session":28}],36:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,i,r){var a,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(a=e[n])&&(o=(s<3?a(o):s>3?a(t,i,o):a(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../doc"),i=require("../globals"),r=require("../graph/session_util"),a=require("../graph/tensor_array_map"),s=require("../ops/ops"),o=require("../tensor"),n=function(){function n(e,t){this.learningRate=e,this.variableGradients=new a.TensorArrayMap,null!=t&&(this.specifiedVariableNodes=t)}return n.prototype.minimize=function(e,t,i){void 0===t&&(t=!1);var r=this.computeGradients(e,i),a=r.value,s=r.grads;return this.applyGradients(s),Object.keys(s).forEach(function(e){return s[e].dispose()}),t?a:(a.dispose(),null)},n.prototype.computeGradients=function(e,t){return i.variableGrads(e,t)},n.prototype.beforeBatch=function(e,t,i,a,n){var p=this;this.variableNodes=null==this.specifiedVariableNodes?r.getVariableNodesFromEvaluationSet(i.nodes):this.specifiedVariableNodes,t!==this.prevBatchSize&&(null!=this.cGraph&&this.cGraph.dispose(),this.prevBatchSize=t,this.cGraph=e.keep(s.scalar(-this.learningRate/t))),this.variableNodes.forEach(function(t){return p.variableGradients.set(t.output,e.keep(o.Tensor.zeros(t.output.shape)))})},n.prototype.afterExample=function(e,t,r,a){var s=this;i.tidy(function(){s.variableNodes.forEach(function(t){var r=a.get(t.output),o=s.variableGradients.get(t.output);s.variableGradients.set(t.output,i.keep(e.add(r,o))),o.dispose()})})},n.prototype.dispose=function(){null!=this.cGraph&&this.cGraph.dispose(),null!=this.variableNodes&&this.variableNodes.forEach(function(e){e.data.dispose()}),null!=this.specifiedVariableNodes&&this.specifiedVariableNodes.forEach(function(e){e.data.dispose()})},e([t.doc({heading:"Training",subheading:"Optimizers"})],n.prototype,"minimize",null),n=e([t.doc({heading:"Training",subheading:"Classes",namespace:"train"})],n)}();exports.Optimizer=n;
},{"../doc":44,"../globals":19,"../graph/session_util":70,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15}],32:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../environment"),a=require("../globals"),r=require("../graph/tensor_array_map"),s=require("../ops/ops"),u=require("../tensor"),i=require("./optimizer"),o=function(i){function o(e,t,u,o){void 0===o&&(o=1e-8);var d=i.call(this,e,u)||this;return d.accumulatedGrads={},d.accumulatedUpdates={},d.accumulatedSquaredGradientsGraph=new r.TensorArrayMap,d.accumulatedUpdatesGraph=new r.TensorArrayMap,d.c=a.keep(s.scalar(-e)),d.epsilon=a.keep(s.scalar(o)),d.rho=a.keep(s.scalar(t)),d.oneMinusRho=a.keep(s.scalar(1-t)),d}return e(o,i),o.prototype.applyGradients=function(e){var r=this,u=function(u){var o=t.ENV.engine.registeredVariables[u];if(null==i.accumulatedGrads[u]){a.tidy(function(){r.accumulatedGrads[u]=s.zerosLike(o).variable(!1)})}if(null==i.accumulatedUpdates[u]){a.tidy(function(){r.accumulatedUpdates[u]=s.zerosLike(o).variable(!1)})}var d=e[u],n=i.accumulatedGrads[u],c=i.accumulatedUpdates[u];a.tidy(function(){var e=r.rho.mul(n).add(r.oneMinusRho.mul(d.square())),t=c.add(r.epsilon).sqrt().div(n.add(r.epsilon).sqrt()).mul(d),a=r.rho.mul(c).add(r.oneMinusRho.mul(t.square()));r.accumulatedGrads[u].assign(e),r.accumulatedUpdates[u].assign(a);var s=r.c.mul(t).add(o);o.assign(s)})},i=this;for(var o in e)u(o)},o.prototype.beforeBatch=function(e,t,a,r,s){var o=this;i.prototype.beforeBatch.call(this,e,t,a,r,s),0===this.accumulatedSquaredGradientsGraph.size()&&this.variableNodes.forEach(function(e){o.accumulatedSquaredGradientsGraph.set(e.output,u.Tensor.zeros(e.output.shape)),o.accumulatedUpdatesGraph.set(e.output,u.Tensor.zeros(e.output.shape))})},o.prototype.afterBatch=function(e,t,u,i,o){var d=this;null==this.one&&(this.one=a.keep(s.scalar(1))),a.tidy(function(){d.variableNodes.forEach(function(t){var r=i.get(t.output),s=d.variableGradients.get(t.output),u=d.accumulatedSquaredGradientsGraph.get(t.output),o=d.accumulatedUpdatesGraph.get(t.output),n=e.multiply(s,s),c=e.scaledArrayAdd(d.rho,u,e.subtract(d.one,d.rho),n),p=e.multiply(e.divide(e.sqrt(e.add(o,d.epsilon)),e.sqrt(e.add(u,d.epsilon))),s),l=e.scaledArrayAdd(d.cGraph,p,d.one,r),h=e.multiply(p,p),m=e.scaledArrayAdd(d.rho,o,e.subtract(d.one,d.rho),h);d.accumulatedSquaredGradientsGraph.set(t.output,a.keep(c)),d.accumulatedUpdatesGraph.set(t.output,a.keep(m)),i.set(t.output,a.keep(l)),t.data=l,r.dispose(),u.dispose(),o.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new r.TensorArrayMap},o.prototype.dispose=function(){var e=this;i.prototype.dispose.call(this),this.c.dispose(),this.epsilon.dispose(),this.rho.dispose(),this.oneMinusRho.dispose(),null!=this.one&&this.one.dispose(),null!=this.accumulatedSquaredGradientsGraph&&this.accumulatedSquaredGradientsGraph.dispose(),null!=this.accumulatedUpdatesGraph&&this.accumulatedUpdatesGraph.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(t){return e.accumulatedUpdates[t].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(t){return e.accumulatedGrads[t].dispose()}))},o}(i.Optimizer);exports.AdadeltaOptimizer=o;
},{"../environment":10,"../globals":19,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15,"./optimizer":36}],33:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../environment"),a=require("../globals"),r=require("../graph/tensor_array_map"),i=require("../ops/ops"),s=require("../tensor"),o=require("./optimizer"),u=function(o){function u(e,t,s){void 0===s&&(s=.1);var u=o.call(this,e,t)||this;return u.learningRate=e,u.initialAccumulatorValue=s,u.accumulatedGrads={},u.accumulatedSquaredGradients=new r.TensorArrayMap,u.c=a.keep(i.scalar(-e)),u.epsilon=a.keep(i.scalar(1e-8)),u}return e(u,o),u.prototype.applyGradients=function(e){var r=this,s=function(s){var u=t.ENV.engine.registeredVariables[s];if(null==o.accumulatedGrads[s]){a.tidy(function(){r.accumulatedGrads[s]=i.fill(u.shape,r.initialAccumulatorValue).variable(!1)})}var n=e[s],d=o.accumulatedGrads[s];a.tidy(function(){var e=d.add(n.square());r.accumulatedGrads[s].assign(e);var t=r.c.mul(n.div(e.add(r.epsilon).sqrt())).add(u);u.assign(t)})},o=this;for(var u in e)s(u)},u.prototype.beforeBatch=function(e,t,a,r,i){var u=this;o.prototype.beforeBatch.call(this,e,t,a,r,i),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach(function(e){u.accumulatedSquaredGradients.set(e.output,s.Tensor.zeros(e.output.shape))})},u.prototype.afterBatch=function(e,t,s,o,u){var n=this;null==this.one&&(this.one=a.keep(i.scalar(1))),a.tidy(function(){n.variableNodes.forEach(function(t){var r=o.get(t.output),i=n.variableGradients.get(t.output),s=n.accumulatedSquaredGradients.get(t.output),u=e.multiply(i,i),d=e.add(s,u),c=e.scaledArrayAdd(n.cGraph,e.divide(i,e.add(e.sqrt(d),n.epsilon)),n.one,r);n.accumulatedSquaredGradients.set(t.output,a.keep(d)),o.set(t.output,a.keep(c)),t.data=c,r.dispose(),s.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new r.TensorArrayMap},u.prototype.dispose=function(){var e=this;o.prototype.dispose.call(this),this.epsilon.dispose(),this.c.dispose(),null!=this.one&&this.one.dispose(),null!=this.accumulatedSquaredGradients&&this.accumulatedSquaredGradients.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(t){return e.accumulatedGrads[t].dispose()})},u}(o.Optimizer);exports.AdagradOptimizer=u;
},{"../environment":10,"../globals":19,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15,"./optimizer":36}],34:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../environment"),a=require("../globals"),s=require("../graph/tensor_array_map"),o=require("../ops/ops"),r=require("../tensor"),i=require("./optimizer"),n=function(i){function n(e,t,r,n,c){void 0===n&&(n=1e-8);var u=i.call(this,e,c)||this;return u.learningRate=e,u.accumulatedFirstMoment={},u.accumulatedSecondMoment={},u.firstMomentGraph=new s.TensorArrayMap,u.secondMomentGraph=new s.TensorArrayMap,u.c=a.keep(o.scalar(-e)),u.eps=a.keep(o.scalar(n)),u.beta1=a.keep(o.scalar(t)),u.beta2=a.keep(o.scalar(r)),a.tidy(function(){u.accBeta1=o.scalar(t).variable(),u.accBeta2=o.scalar(r).variable()}),u.oneMinusBeta1=a.keep(o.scalar(1-t)),u.oneMinusBeta2=a.keep(o.scalar(1-r)),u.one=a.keep(o.scalar(1)),u}return e(n,i),n.prototype.applyGradients=function(e){var s=this;a.tidy(function(){var a=s.one.sub(s.accBeta1),r=s.one.sub(s.accBeta2);for(var i in e){var n=t.ENV.engine.registeredVariables[i];if(null==s.accumulatedFirstMoment[i]){var c=!1;s.accumulatedFirstMoment[i]=o.zerosLike(n).variable(c)}if(null==s.accumulatedSecondMoment[i]){c=!1;s.accumulatedSecondMoment[i]=o.zerosLike(n).variable(c)}var u=e[i],p=s.accumulatedFirstMoment[i],d=s.accumulatedSecondMoment[i],l=s.beta1.mul(p).add(s.oneMinusBeta1.mul(u)),h=s.beta2.mul(d).add(s.oneMinusBeta2.mul(u.square())),m=l.div(a),M=h.div(r);s.accumulatedFirstMoment[i].assign(l),s.accumulatedSecondMoment[i].assign(h);var f=s.c.mul(m.div(s.eps.add(M.sqrt()))).add(n);n.assign(f)}s.accBeta1.assign(s.accBeta1.mul(s.beta1)),s.accBeta2.assign(s.accBeta2.mul(s.beta2))})},n.prototype.beforeBatch=function(e,t,a,s,o){var n=this;i.prototype.beforeBatch.call(this,e,t,a,s,o),0===this.firstMomentGraph.size()&&this.variableNodes.forEach(function(e){n.firstMomentGraph.set(e.output,r.Tensor.zeros(e.output.shape))}),0===this.secondMomentGraph.size()&&this.variableNodes.forEach(function(e){n.secondMomentGraph.set(e.output,r.Tensor.zeros(e.output.shape))})},n.prototype.afterBatch=function(e,t,o,r,i){var n=this;a.tidy(function(){var t=n.one.sub(n.accBeta1),s=n.one.sub(n.accBeta2);n.variableNodes.forEach(function(o){var i=r.get(o.output),c=n.variableGradients.get(o.output),u=n.firstMomentGraph.get(o.output),p=n.secondMomentGraph.get(o.output),d=e.scaledArrayAdd(n.beta1,u,n.oneMinusBeta1,c),l=e.scaledArrayAdd(n.beta2,p,n.oneMinusBeta2,c.square()),h=d.div(t),m=l.div(s),M=e.scaledArrayAdd(n.cGraph,h.div(n.eps.add(m.sqrt())),n.one,i);r.set(o.output,a.keep(M)),o.data=M,n.firstMomentGraph.set(o.output,a.keep(d)),n.secondMomentGraph.set(o.output,a.keep(l)),i.dispose(),c.dispose(),u.dispose(),p.dispose()}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.variableGradients.dispose(),this.variableGradients=new s.TensorArrayMap},n.prototype.dispose=function(){var e=this;i.prototype.dispose.call(this),this.c.dispose(),this.eps.dispose(),this.beta1.dispose(),this.beta2.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.firstMomentGraph&&this.firstMomentGraph.dispose(),null!=this.secondMomentGraph&&this.secondMomentGraph.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(t){return e.accumulatedFirstMoment[t].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(t){return e.accumulatedSecondMoment[t].dispose()})},n}(i.Optimizer);exports.AdamOptimizer=n;
},{"../environment":10,"../globals":19,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15,"./optimizer":36}],35:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../environment"),a=require("../globals"),i=require("../graph/tensor_array_map"),r=require("../ops/ops"),s=require("../tensor"),o=require("./optimizer"),n=function(o){function n(e,t,s,n,u,c){void 0===n&&(n=1e-8),void 0===u&&(u=0);var d=o.call(this,e,c)||this;return d.learningRate=e,d.accumulatedFirstMoment={},d.accumulatedWeightedInfNorm={},d.firstMomentGraph=new i.TensorArrayMap,d.weightedInfNormGraph=new i.TensorArrayMap,d.c=a.keep(r.scalar(-e)),d.eps=a.keep(r.scalar(n)),d.beta1=a.keep(r.scalar(t)),d.beta2=a.keep(r.scalar(s)),d.decay=a.keep(r.scalar(u)),a.tidy(function(){d.iteration=r.scalar(0).variable(),d.accBeta1=r.scalar(t).variable()}),d.oneMinusBeta1=a.keep(r.scalar(1-t)),d.one=a.keep(r.scalar(1)),d}return e(n,o),n.prototype.applyGradients=function(e){var i=this;a.tidy(function(){var a=i.one.sub(i.accBeta1),s=i.c.div(i.one.add(i.decay.mul(i.iteration)));for(var o in e){var n=t.ENV.engine.registeredVariables[o];if(null==i.accumulatedFirstMoment[o]){var u=!1;i.accumulatedFirstMoment[o]=r.zerosLike(n).variable(u)}if(null==i.accumulatedWeightedInfNorm[o]){u=!1;i.accumulatedWeightedInfNorm[o]=r.zerosLike(n).variable(u)}var c=e[o],d=i.accumulatedFirstMoment[o],p=i.accumulatedWeightedInfNorm[o],h=i.beta1.mul(d).add(i.oneMinusBeta1.mul(c)),l=i.beta2.mul(p),m=c.abs(),f=l.maximum(m);i.accumulatedFirstMoment[o].assign(h),i.accumulatedWeightedInfNorm[o].assign(f);var v=s.div(a).mul(h.div(i.eps.add(f))).add(n);n.assign(v)}i.iteration.assign(i.iteration.add(i.one)),i.accBeta1.assign(i.accBeta1.mul(i.beta1))})},n.prototype.beforeBatch=function(e,t,a,i,r){var n=this;o.prototype.beforeBatch.call(this,e,t,a,i,r),0===this.firstMomentGraph.size()&&this.variableNodes.forEach(function(e){n.firstMomentGraph.set(e.output,s.Tensor.zeros(e.output.shape))}),0===this.weightedInfNormGraph.size()&&this.variableNodes.forEach(function(e){n.weightedInfNormGraph.set(e.output,s.Tensor.zeros(e.output.shape))})},n.prototype.afterBatch=function(e,t,r,s,o){var n=this;a.tidy(function(){var t=n.cGraph.div(n.one.add(n.decay.mul(n.iteration)));n.variableNodes.forEach(function(i){var r=s.get(i.output),o=n.variableGradients.get(i.output),u=n.firstMomentGraph.get(i.output),c=n.weightedInfNormGraph.get(i.output),d=e.scaledArrayAdd(n.beta1,u,n.oneMinusBeta1,o),p=n.beta2.mul(c),h=o.abs(),l=p.maximum(h),m=e.scaledArrayAdd(n.one,r,t.div(n.one.sub(n.accBeta1)),d.div(n.eps.add(l)));s.set(i.output,a.keep(m)),i.data=m,n.firstMomentGraph.set(i.output,a.keep(d)),n.weightedInfNormGraph.set(i.output,a.keep(l)),r.dispose(),o.dispose(),u.dispose(),c.dispose()}),n.iteration.assign(n.iteration.add(n.one)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.variableGradients.dispose(),this.variableGradients=new i.TensorArrayMap},n.prototype.dispose=function(){var e=this;o.prototype.dispose.call(this),this.c.dispose(),this.eps.dispose(),this.accBeta1.dispose(),this.beta1.dispose(),this.beta2.dispose(),this.oneMinusBeta1.dispose(),this.decay.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.firstMomentGraph&&this.firstMomentGraph.dispose(),null!=this.weightedInfNormGraph&&this.weightedInfNormGraph.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(t){return e.accumulatedFirstMoment[t].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(t){return e.accumulatedWeightedInfNorm[t].dispose()})},n}(o.Optimizer);exports.AdamaxOptimizer=n;
},{"../environment":10,"../globals":19,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15,"./optimizer":36}],39:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../environment"),r=require("../globals"),i=require("../graph/tensor_array_map"),n=require("../ops/ops"),o=require("./optimizer"),s=function(o){function s(t,e){var r=o.call(this,t,e)||this;return r.learningRate=t,r.setLearningRate(t),r}return t(s,o),s.prototype.applyGradients=function(t){var i=this;Object.keys(t).forEach(function(n){var o=t[n],s=e.ENV.engine.registeredVariables[n];r.tidy(function(){var t=i.c.mul(o).add(s);s.assign(t)})})},s.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=e.ENV.math.keep(n.scalar(-t))},s.prototype.dispose=function(){this.c.dispose(),null!=this.one&&this.one.dispose(),o.prototype.dispose.call(this)},s.prototype.afterBatch=function(t,e,o,s,a){var p=this;null==this.one&&(this.one=r.keep(n.scalar(1))),r.tidy(function(){p.variableNodes.forEach(function(e){var i=s.get(e.output),n=p.variableGradients.get(e.output),o=t.scaledArrayAdd(p.cGraph,n,p.one,i);s.set(e.output,r.keep(o)),e.data=o,i.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new i.TensorArrayMap},s}(o.Optimizer);exports.SGDOptimizer=s;
},{"../environment":10,"../globals":19,"../graph/tensor_array_map":71,"../ops/ops":40,"./optimizer":36}],37:[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../environment"),i=require("../globals"),r=require("../graph/tensor_array_map"),a=require("../ops/ops"),o=require("../tensor"),s=require("./sgd_optimizer"),n=function(s){function n(t,e,i,r){void 0===r&&(r=!1);var o=s.call(this,t,i)||this;return o.learningRate=t,o.momentum=e,o.useNesterov=r,o.m=a.scalar(o.momentum),o.accumulations={},o}return t(n,s),n.prototype.applyGradients=function(t){var r=this,o=function(o){var n=e.ENV.engine.registeredVariables[o];if(null==s.accumulations[o]){i.tidy(function(){r.accumulations[o]=a.zerosLike(n).variable(!1)})}var u=s.accumulations[o],p=t[o];i.tidy(function(){var t,e=r.m.mul(u).add(p);t=r.useNesterov?r.c.mul(p.add(e.mul(r.m))).add(n):r.c.mul(e).add(n),r.accumulations[o].assign(e),n.assign(t)})},s=this;for(var n in t)o(n)},n.prototype.beforeBatch=function(t,e,i,a,n){var u=this;null==this.variableVelocitiesGraph&&(this.variableVelocitiesGraph=new r.TensorArrayMap),s.prototype.beforeBatch.call(this,t,e,i,a,n),0===this.variableVelocitiesGraph.size()&&this.variableNodes.forEach(function(t){u.variableVelocitiesGraph.set(t.output,o.Tensor.zeros(t.output.shape))})},n.prototype.afterBatch=function(t,e,a,o,s){var n=this;i.tidy(function(){n.variableNodes.forEach(function(t){var e,r=o.get(t.output),a=n.variableGradients.get(t.output),s=n.variableVelocitiesGraph.get(t.output),u=n.m.mul(s).add(a);e=n.useNesterov?n.cGraph.mul(a.add(u.mul(n.m))).add(r):n.cGraph.mul(u).add(r),n.variableVelocitiesGraph.set(t.output,i.keep(u)),o.set(t.output,i.keep(e)),t.data=e,r.dispose(),s.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new r.TensorArrayMap},n.prototype.dispose=function(){if(s.prototype.dispose.call(this),this.m.dispose(),null!=this.variableVelocitiesGraph&&this.variableVelocitiesGraph.dispose(),null!=this.accumulations)for(var t in this.accumulations)this.accumulations[t].dispose()},n.prototype.setMomentum=function(t){this.momentum=t},n}(s.SGDOptimizer);exports.MomentumOptimizer=n;
},{"../environment":10,"../globals":19,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15,"./sgd_optimizer":39}],38:[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])};return function(a,t){function r(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var a=require("../environment"),t=require("../globals"),r=require("../graph/session_util"),s=require("../graph/tensor_array_map"),u=require("../ops/ops"),i=require("../tensor"),o=require("./optimizer"),n=function(o){function n(e,a,r,i,n){void 0===a&&(a=.9),void 0===r&&(r=0),void 0===n&&(n=1e-8);var c=o.call(this,e,i)||this;return c.learningRate=e,c.accumulatedMeanSquares={},c.accumulatedMoments={},c.accumulatedMeanSquaredGraph=new s.TensorArrayMap,c.accumulatedMomentGraph=new s.TensorArrayMap,c.c=t.keep(u.scalar(e)),c.epsilon=t.keep(u.scalar(n)),c.decay=t.keep(u.scalar(a)),c.momentum=t.keep(u.scalar(r)),c.oneMinusDecay=t.keep(u.scalar(1-a)),c}return e(n,o),n.prototype.applyGradients=function(e){var r=this,s=function(s){var o=a.ENV.engine.registeredVariables[s];if(null==i.accumulatedMeanSquares[s]){t.tidy(function(){r.accumulatedMeanSquares[s]=u.zerosLike(o).variable(!1)})}if(null==i.accumulatedMoments[s]){t.tidy(function(){r.accumulatedMoments[s]=u.zerosLike(o).variable(!1)})}var n=i.accumulatedMeanSquares[s],c=i.accumulatedMoments[s],p=e[s];t.tidy(function(){var e=r.decay.mul(n).add(r.oneMinusDecay.mul(p.square())),a=r.momentum.mul(c).add(r.c.mul(p).div(e.add(r.epsilon).sqrt()));r.accumulatedMeanSquares[s].assign(e),r.accumulatedMoments[s].assign(a);var t=o.sub(a);o.assign(t)})},i=this;for(var o in e)s(o)},n.prototype.beforeBatch=function(e,a,t,s,o){var n=this;this.variableNodes=null==this.specifiedVariableNodes?r.getVariableNodesFromEvaluationSet(t.nodes):this.specifiedVariableNodes,a!==this.prevBatchSize&&(null!=this.cGraph&&this.cGraph.dispose(),this.prevBatchSize=a,this.cGraph=e.keep(u.scalar(this.learningRate/a))),this.variableNodes.forEach(function(a){return n.variableGradients.set(a.output,e.keep(i.Tensor.zeros(a.output.shape)))}),0===this.accumulatedMeanSquaredGraph.size()&&this.variableNodes.forEach(function(e){n.accumulatedMeanSquaredGraph.set(e.output,i.Tensor.zeros(e.output.shape)),n.accumulatedMomentGraph.set(e.output,i.Tensor.zeros(e.output.shape))})},n.prototype.afterBatch=function(e,a,r,u,i){var o=this;t.tidy(function(){o.variableNodes.forEach(function(a){var r=u.get(a.output),s=o.variableGradients.get(a.output),i=o.accumulatedMeanSquaredGraph.get(a.output),n=o.accumulatedMomentGraph.get(a.output),c=e.scaledArrayAdd(o.decay,i,o.oneMinusDecay,s.square()),p=e.scaledArrayAdd(o.momentum,n,o.cGraph,s.div(c.add(o.epsilon).sqrt())),d=r.sub(p);o.accumulatedMeanSquaredGraph.set(a.output,t.keep(c)),o.accumulatedMomentGraph.set(a.output,t.keep(p)),u.set(a.output,t.keep(d)),a.data=d,r.dispose(),i.dispose(),n.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new s.TensorArrayMap},n.prototype.dispose=function(){var e=this;o.prototype.dispose.call(this),this.c.dispose(),this.epsilon.dispose(),this.decay.dispose(),this.momentum.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquaredGraph&&this.accumulatedMeanSquaredGraph.dispose(),null!=this.accumulatedMomentGraph&&this.accumulatedMomentGraph.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(a){return e.accumulatedMeanSquares[a].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(a){return e.accumulatedMoments[a].dispose()})},n}(o.Optimizer);exports.RMSPropOptimizer=n;
},{"../environment":10,"../globals":19,"../graph/session_util":70,"../graph/tensor_array_map":71,"../ops/ops":40,"../tensor":15,"./optimizer":36}],17:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(o,u)}s((r=r.apply(e,n||[])).next())})},n=this&&this.__generator||function(e,n){var t,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[0,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],r=0}finally{t=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./ops/ops"),r=require("./util"),i={float32:4,int32:4};function a(a,o,u){return void 0===o&&(o=""),e(this,void 0,void 0,function(){var e,s,f,c,l,h,p,y,w,m,d;return n(this,function(n){switch(n.label){case 0:if(e=a.map(function(){return!1}),s={},f=null!=u?u.map(function(){return!1}):[],c=[],a.forEach(function(n,t){var a=0;n.weights.forEach(function(n){var o=i[n.dtype]*r.sizeFromShape(n.shape),l=function(){e[t]=!0,null==s[t]&&(s[t]=[]),s[t].push({manifestEntry:n,groupOffset:a,sizeBytes:o})};null!=u?u.forEach(function(e,t){e===n.name&&(l(),f[t]=!0)}):l(),c.push(n.name),a+=o})}),!f.every(function(e){return e}))throw l=u.filter(function(e,n){return!f[n]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+". \nManifest JSON has weights with names: "+c.join(", ")+".");return h=e.reduce(function(e,n,t){return n&&e.push(t),e},[]),p=[],h.forEach(function(e){a[e].paths.forEach(function(e){var n=o+(o.endsWith("/")?"":"/")+e;p.push(fetch(n))})}),[4,Promise.all(p)];case 1:return y=n.sent(),[4,Promise.all(y.map(function(e){return e.arrayBuffer()}))];case 2:return w=n.sent(),m={},d=0,h.forEach(function(e){for(var n=a[e].paths.length,r=0,i=0;i<n;i++)r+=w[d+i].byteLength;for(var o=new ArrayBuffer(r),u=new Uint8Array(o),f=0,c=0;c<n;c++){var l=new Uint8Array(w[d+c]);u.set(l,f),f+=l.byteLength}s[e].forEach(function(e){var n,r=o.slice(e.groupOffset,e.groupOffset+e.sizeBytes);if("float32"===e.manifestEntry.dtype)n=new Float32Array(r);else{if("int32"!==e.manifestEntry.dtype)throw new Error("Weight "+e.manifestEntry.name+" has unknown dtype "+e.manifestEntry.dtype+".");n=new Int32Array(r)}var i=e.manifestEntry.name;if(null!=m[i])throw new Error("Duplicate weight with name "+i+". Please make sure weights names are unique in the manifest JSON.");m[i]=t.tensor(n,e.manifestEntry.shape,e.manifestEntry.dtype)}),d+=n}),[2,m]}})})}exports.loadWeights=a;
},{"./ops/ops":40,"./util":12}],67:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,i,r,n){var a,t=arguments.length,d=t<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,i,r,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(d=(t<3?a(d):t>3?a(i,r,d):a(i,r))||d);return t>3&&d&&Object.defineProperty(i,r,d),d};Object.defineProperty(exports,"__esModule",{value:!0});var i=require("../doc"),r=require("./adadelta_optimizer"),n=require("./adagrad_optimizer"),a=require("./adam_optimizer"),t=require("./adamax_optimizer"),d=require("./momentum_optimizer"),o=require("./rmsprop_optimizer"),m=require("./sgd_optimizer"),u=function(){function u(){}return u.sgd=function(e){return new m.SGDOptimizer(e)},u.momentum=function(e,i,r){return void 0===r&&(r=!1),new d.MomentumOptimizer(e,i,void 0,r)},u.rmsprop=function(e,i,r,n){return void 0===i&&(i=.9),void 0===r&&(r=0),void 0===n&&(n=1e-8),new o.RMSPropOptimizer(e,i,r,void 0,n)},u.adam=function(e,i,r,n){return void 0===e&&(e=.001),void 0===i&&(i=.9),void 0===r&&(r=.999),void 0===n&&(n=1e-8),new a.AdamOptimizer(e,i,r,n,void 0)},u.adadelta=function(e,i,n){return void 0===e&&(e=.001),void 0===i&&(i=.95),void 0===n&&(n=1e-8),new r.AdadeltaOptimizer(e,i,void 0,n)},u.adamax=function(e,i,r,n,a){return void 0===e&&(e=.002),void 0===i&&(i=.9),void 0===r&&(r=.999),void 0===n&&(n=1e-8),void 0===a&&(a=0),new t.AdamaxOptimizer(e,i,r,n,a,void 0)},u.adagrad=function(e,i){return void 0===i&&(i=.1),new n.AdagradOptimizer(e,void 0,i)},e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"sgd",null),e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"momentum",null),e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"rmsprop",null),e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"adam",null),e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"adadelta",null),e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"adamax",null),e([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],u,"adagrad",null),u}();exports.OptimizerConstructors=u;
},{"../doc":44,"./adadelta_optimizer":32,"./adagrad_optimizer":33,"./adam_optimizer":34,"./adamax_optimizer":35,"./momentum_optimizer":37,"./rmsprop_optimizer":38,"./sgd_optimizer":39}],18:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./optimizers/adadelta_optimizer"),i=require("./optimizers/adagrad_optimizer"),e=require("./optimizers/adam_optimizer"),t=require("./optimizers/adamax_optimizer"),m=require("./optimizers/momentum_optimizer"),o=require("./optimizers/optimizer_constructors"),a=require("./optimizers/rmsprop_optimizer"),p=require("./optimizers/sgd_optimizer");m.MomentumOptimizer,p.SGDOptimizer,r.AdadeltaOptimizer,i.AdagradOptimizer,a.RMSPropOptimizer,t.AdamaxOptimizer,e.AdamOptimizer,exports.train={sgd:o.OptimizerConstructors.sgd,momentum:o.OptimizerConstructors.momentum,adadelta:o.OptimizerConstructors.adadelta,adagrad:o.OptimizerConstructors.adagrad,rmsprop:o.OptimizerConstructors.rmsprop,adamax:o.OptimizerConstructors.adamax,adam:o.OptimizerConstructors.adam};
},{"./optimizers/adadelta_optimizer":32,"./optimizers/adagrad_optimizer":33,"./optimizers/adam_optimizer":34,"./optimizers/adamax_optimizer":35,"./optimizers/momentum_optimizer":37,"./optimizers/optimizer_constructors":67,"./optimizers/rmsprop_optimizer":38,"./optimizers/sgd_optimizer":39}],8:[function(require,module,exports) {
"use strict";function r(r){for(var e in r)exports.hasOwnProperty(e)||(exports[e]=r[e])}Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./browser_util"),t=require("./contrib");exports.contrib=t;var i=require("./data/xhr-dataset");exports.xhr_dataset=i;var a=require("./environment");exports.environment=a;var o=require("./environment"),n=require("./kernels/webgl/gpgpu_util");exports.gpgpu_util=n;var s=require("./kernels/webgl/webgl_util");exports.webgl_util=s;var p=require("./ops/conv_util");exports.conv_util=p;var m=require("./test_util");exports.test_util=m;var u=require("./util");exports.util=u;var x=require("./version");exports.version=x.version;var l=require("./data/checkpoint_loader");exports.CheckpointLoader=l.CheckpointLoader;var d=require("./data/dataset");exports.InMemoryDataset=d.InMemoryDataset;var v=require("./data/input_provider");exports.InCPUMemoryShuffledInputProviderBuilder=v.InCPUMemoryShuffledInputProviderBuilder,exports.InGPUMemoryShuffledInputProviderBuilder=v.InGPUMemoryShuffledInputProviderBuilder;var z=require("./data/xhr-dataset");exports.XhrDataset=z.XhrDataset;var c=require("./environment");exports.ENV=c.ENV,exports.Environment=c.Environment;var q=require("./graph/graph");exports.Graph=q.Graph,exports.SymbolicTensor=q.SymbolicTensor;var h=require("./graph/graph_runner");exports.GraphRunner=h.GraphRunner,exports.MetricReduction=h.MetricReduction;var g=require("./graph/initializers");exports.ConstantInitializer=g.ConstantInitializer,exports.OnesInitializer=g.OnesInitializer,exports.RandomNormalInitializer=g.RandomNormalInitializer,exports.RandomTruncatedNormalInitializer=g.RandomTruncatedNormalInitializer,exports.RandomUniformInitializer=g.RandomUniformInitializer,exports.TensorInitializer=g.TensorInitializer,exports.VarianceScalingInitializer=g.VarianceScalingInitializer,exports.ZerosInitializer=g.ZerosInitializer;var D=require("./graph/session");exports.CostReduction=D.CostReduction,exports.Session=D.Session;var y=require("./kernels/backend_cpu");exports.MathBackendCPU=y.MathBackendCPU,exports.NDArrayMathCPU=y.NDArrayMathCPU;var I=require("./kernels/backend_webgl");exports.MathBackendWebGL=I.MathBackendWebGL,exports.NDArrayMathGPU=I.NDArrayMathGPU;var _=require("./kernels/webgl/gpgpu_context");exports.GPGPUContext=_.GPGPUContext;var M=require("./math");exports.NDArrayMath=M.NDArrayMath;var A=require("./ops/matmul");exports.MatrixOrientation=A.MatrixOrientation;var O=require("./optimizers/adadelta_optimizer");exports.AdadeltaOptimizer=O.AdadeltaOptimizer;var P=require("./optimizers/adagrad_optimizer");exports.AdagradOptimizer=P.AdagradOptimizer;var b=require("./optimizers/adam_optimizer");exports.AdamOptimizer=b.AdamOptimizer;var k=require("./optimizers/adamax_optimizer");exports.AdamaxOptimizer=k.AdamaxOptimizer;var G=require("./optimizers/momentum_optimizer");exports.MomentumOptimizer=G.MomentumOptimizer;var R=require("./optimizers/optimizer");exports.Optimizer=R.Optimizer;var S=require("./optimizers/rmsprop_optimizer");exports.RMSPropOptimizer=S.RMSPropOptimizer;var T=require("./optimizers/sgd_optimizer");exports.SGDOptimizer=T.SGDOptimizer;var U=require("./tensor");exports.Array1D=U.Array1D,exports.Array2D=U.Array2D,exports.Array3D=U.Array3D,exports.Array4D=U.Array4D,exports.NDArray=U.NDArray,exports.Scalar=U.Scalar,exports.Tensor=U.Tensor,exports.Tensor1D=U.Tensor1D,exports.Tensor2D=U.Tensor2D,exports.Tensor3D=U.Tensor3D,exports.Tensor4D=U.Tensor4D,exports.variable=U.variable,exports.Variable=U.Variable;var C=require("./types");exports.Rank=C.Rank;var N=require("./weights_loader");exports.loadWeights=N.loadWeights,r(require("./ops/ops")),r(require("./train")),r(require("./globals")),exports.setBackend=o.Environment.setBackend,exports.getBackend=o.Environment.getBackend,exports.memory=o.Environment.memory,exports.nextFrame=e.BrowserUtil.nextFrame;
},{"./browser_util":9,"./contrib":107,"./data/xhr-dataset":20,"./environment":10,"./kernels/webgl/gpgpu_util":41,"./kernels/webgl/webgl_util":42,"./ops/conv_util":21,"./test_util":11,"./util":12,"./version":13,"./data/checkpoint_loader":22,"./data/dataset":23,"./data/input_provider":24,"./graph/graph":25,"./graph/graph_runner":26,"./graph/initializers":27,"./graph/session":28,"./kernels/backend_cpu":29,"./kernels/backend_webgl":30,"./kernels/webgl/gpgpu_context":43,"./math":14,"./ops/matmul":31,"./optimizers/adadelta_optimizer":32,"./optimizers/adagrad_optimizer":33,"./optimizers/adam_optimizer":34,"./optimizers/adamax_optimizer":35,"./optimizers/momentum_optimizer":37,"./optimizers/optimizer":36,"./optimizers/rmsprop_optimizer":38,"./optimizers/sgd_optimizer":39,"./tensor":15,"./types":16,"./weights_loader":17,"./ops/ops":40,"./train":18,"./globals":19}],5:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("deeplearn"),a=e.scalar(127.5),i=e.scalar(1),t=e.ENV.math,o=function(){function o(e){this.variables=e}return o.getInstance=function(a){return new e.CheckpointLoader(a).getAllVariables().then(function(e){return new o(e)})},o.prototype.predict=function(a){var i=this;return e.tidy(function(){var o=i.preprocess(a),n=i.convBlock(o,2),s=i.depthwiseConvBlock(n,1,1),r=i.depthwiseConvBlock(s,2,2),l=i.depthwiseConvBlock(r,1,3),v=i.depthwiseConvBlock(l,2,4),c=i.depthwiseConvBlock(v,1,5),h=i.depthwiseConvBlock(c,2,6),d=i.depthwiseConvBlock(h,1,7),p=i.depthwiseConvBlock(d,1,8),m=i.depthwiseConvBlock(p,1,9),b=i.depthwiseConvBlock(m,1,10),B=i.depthwiseConvBlock(b,1,11),u=i.depthwiseConvBlock(B,2,12),w=i.depthwiseConvBlock(u,1,13).avgPool(7,2,"valid"),g=i.variables["MobilenetV1/Logits/Conv2d_1c_1x1/weights"],_=i.variables["MobilenetV1/Logits/Conv2d_1c_1x1/biases"],C=w.conv2d(g,1,"same").add(_),k=i.variables["final_training_ops/weights/final_weights"],f=i.variables["final_training_ops/biases/final_biases"];return e.softmax(t.add(t.vectorTimesMatrix(C.as1D(),k),f))}).data().then(function(e){return e[2]})},o.prototype.preprocess=function(t){var o=t.data,n=t.width,s=t.height,r=e.Tensor.make([n,s,4],{values:new Float32Array(o)});return e.slice3d(r,[0,0,0],[n,s,3]).div(a).sub(i)},o.prototype.convBlock=function(e,a){var i="MobilenetV1/Conv2d_0";return e.conv2d(this.variables[i+"/weights"],a,"same").batchNormalization(this.variables[i+"/BatchNorm/moving_mean"],this.variables[i+"/BatchNorm/moving_variance"],.001,this.variables[i+"/BatchNorm/gamma"],this.variables[i+"/BatchNorm/beta"]).clipByValue(0,6)},o.prototype.depthwiseConvBlock=function(e,a,i){var t="MobilenetV1/Conv2d_"+String(i)+"_depthwise",o="MobilenetV1/Conv2d_"+String(i)+"_pointwise";return e.depthwiseConv2D(this.variables[t+"/depthwise_weights"],a,"same").batchNormalization(this.variables[t+"/BatchNorm/moving_mean"],this.variables[t+"/BatchNorm/moving_variance"],.001,this.variables[t+"/BatchNorm/gamma"],this.variables[t+"/BatchNorm/beta"]).clipByValue(0,6).conv2d(this.variables[o+"/weights"],[1,1],"same").batchNormalization(this.variables[o+"/BatchNorm/moving_mean"],this.variables[o+"/BatchNorm/moving_variance"],.001,this.variables[o+"/BatchNorm/gamma"],this.variables[o+"/BatchNorm/beta"]).clipByValue(0,6)},o}();exports.DeeplearnModel=o;
},{"deeplearn":8}],3:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("./detectFaces"),n=require("./DeeplearnModel");!function(){e.__awaiter(this,void 0,void 0,function(){var r,i,o,c,a,d,s,u=this;return e.__generator(this,function(l){return r=document.querySelector("canvas"),i=r.getContext("2d"),o=document.querySelector(".message"),c=document.querySelector(".main-contents"),a=document.querySelector(".flip-camera"),d=document.querySelector(".force-landscape"),"FaceDetector"in window?(s=("/konomi/"===location.pathname?"/konomi":"/dist")+"/dl-manifest",Promise.all([navigator.mediaDevices.enumerateDevices().then(function(e){return e.filter(function(e){return"videoinput"===e.kind}).map(function(e){return e.deviceId})}).then(function(e){return 0===e.length?Promise.reject(new Error("No available video input devices")):navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e[0]}}}).then(function(t){return{mediaStream:t,videoInputDevices:e}})}),n.DeeplearnModel.getInstance(s)]).then(function(n){var s=n[0],l=n[1],h=s.mediaStream,v=s.videoInputDevices;o.classList.add("hidden"),c.classList.remove("hidden");var f=document.createElement("video");f.srcObject=h,f.onloadedmetadata=function(){var n=f.srcObject,o=0,c=[];!function a(){return e.__awaiter(this,void 0,void 0,function(){var d,s,u,h,v,m,g,p,w,_;return e.__generator(this,function(e){if(f.srcObject!==n)return[2];for(requestAnimationFrame(a),o+=1,r.width=f.videoWidth,r.height=f.videoHeight,i.clearRect(0,0,r.width,r.height),i.drawImage(f,0,0,f.videoWidth,f.videoHeight,0,0,r.width,r.height),d=0,s=c;d<s.length;d++)u=s[d],h=u.usedBoundingBox,v=u.score,m=u.color,g=h.x,p=h.y,w=h.width,_=h.height,i.strokeStyle=m,i.fillStyle=m,i.font="24px Mononoki",i.lineWidth=5,i.beginPath(),i.rect(g,p,w,_),i.stroke(),i.fillText(v+" / 100",g+5,p+29);return o<30?[2]:(o=0,t.detectFacesImageData(f).then(function(e){return Promise.all(e.map(function(e){var t=e.usedBoundingBox,n=e.imageData;return l.predict(n).then(function(e){var n=(0===e?255:Math.floor(256*(1-e))).toString(16),r="#ff"+(n=1===n.length?"0"+n:n)+"00";return{usedBoundingBox:t,score:(100*e).toFixed(2),color:r}})})).then(function(e){return c=e})}).catch(function(e){return console.error(e)||[]}),[2])})})}()};var m=v.length;if(m>1){var g=!1,p=0;a.addEventListener("click",function(){return e.__awaiter(u,void 0,void 0,function(){return e.__generator(this,function(e){switch(e.label){case 0:return g?[2]:(g=!0,f.srcObject.getTracks().forEach(function(e){return e.stop()}),p=(p+1)%m,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:v[p]}}}).then(function(e){return f.srcObject=e},function(e){return console.error(e)})]);case 1:return e.sent(),g=!1,[2]}})})})}else a.classList.add("hidden");(void 0!==window.orientation&&screen.orientation&&screen.orientation.lock?Promise.resolve(screen.orientation):Promise.reject(null)).then(function(e){return d.addEventListener("click",function(){document.fullscreenElement?(document.exitFullscreen(),e.unlock()):(c.requestFullscreen(),e.lock("landscape").catch(function(e){return console.error(e)}))})},function(){return d.classList.add("hidden")})}).catch(function(e){console.error(e),o.classList.add("error"),o.classList.remove("hidden"),c.classList.add("hidden")})):o.classList.add("error"),[2]})})}();
},{"tslib":7,"./detectFaces":4,"./DeeplearnModel":5}]},{},[3])